<!DOCTYPE html>
<html lang="en">
  <head>
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-593498H');</script>
<!-- End Google Tag Manager -->

    <meta charset="utf-8">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">

    <meta name="msapplication-config" content="/microsoft-tile.xml" />
    <meta name="theme-color" content="#ffffff">

    <meta property="og:url" content="https://bejoycalias.github.io/blogsataws/mgmtblogs1.html" />
    <meta property="og:site_name" content="Bejoy's TechNotes"/>
    <meta property="og:title" content="Bejoy's TechNotes - Kindle Friendly AWS Management Tools Blogs" />
    <meta property="og:image" content="https://bejoycalias.github.io/assets/images/og-image.png"/>
    <meta property="og:image:width" content="1200"/>
    <meta property="og:image:height" content="1200"/>
    <meta property="og:description" content="" />

    <title>Bejoy's TechNotes - Kindle Friendly AWS Management Tools Blogs</title>
    <link href="../assets/stylesheets/application-832aa42c.css" rel="stylesheet" />

    <!--[if lt IE 9]>
      <script src="../assets/javascripts/ie-compat-c141a02d.js"></script>
    <![endif]-->
    <script src="../assets/javascripts/application-ff53d307.js"></script>

    <!-- Typekit script to import Klavika font -->
    <script src="https://use.typekit.net/wxf7mfi.js"></script>
    <script>try{Typekit.load({ async: true });}catch(e){}</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-100043608-1', 'auto');
  ga('send', 'pageview');

</script>

    
  </head>

  <body id="uh-oh-" class="layout-inner page-uh-oh-">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-593498H"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->


    <div id="header" class="navigation navbar-static-top hidden-print">
      <div class="container">
        <div class="row">
          <div class="col-xs-12">
            <div class="navbar-header">
              <div class="navbar-brand">
                <a href="/">
                  <svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="135.000000pt" height="50" viewbox="0 0 135.000000 45.000000" preserveaspectratio="xMidYMid meet" class="logo">

<g transform="translate(0.000000,45.000000) scale(0.100000,-0.100000)" fill="#000000" stroke="none">
<path class="text" fill="#000000" d="M527 384 c-4 -4 -7 -18 -7 -31 0 -21 4 -24 28 -21 21 2 27 8 27 28 0
18 -6 26 -20 28 -12 2 -24 0 -28 -4z"></path>
<path class="text" fill="#000000" d="M1080 335 c0 -48 2 -55 20 -55 18 0 20 7 20 55 0 48 -2 55 -20 55
-18 0 -20 -7 -20 -55z"></path>
<path class="text" fill="#000000" d="M54 357 c-2 -7 -3 -69 -2 -138 l3 -124 65 -3 c90 -3 130 20 130 77 0
29 -6 44 -20 54 -20 14 -20 15 -3 45 14 25 15 34 5 56 -6 15 -23 31 -38 36
-38 15 -134 13 -140 -3z m110 -33 c19 -7 21 -45 4 -62 -7 -7 -22 -12 -35 -12
-20 0 -23 5 -23 40 0 41 13 50 54 34z m20 -130 c19 -18 19 -20 6 -45 -8 -13
-21 -19 -45 -19 -34 0 -35 1 -35 40 0 38 2 40 29 40 16 0 37 -7 45 -16z"></path>
<path class="text" fill="#000000" d="M319 271 c-23 -24 -29 -38 -29 -74 0 -25 3 -53 6 -62 20 -50 164 -64
164 -15 0 15 -7 17 -45 12 -46 -5 -75 8 -75 34 0 11 16 14 65 14 l65 0 0 35
c0 80 -92 114 -151 56z m99 -33 c3 -15 -4 -18 -37 -18 -43 0 -50 7 -29 28 18
18 62 11 66 -10z"></path>
<path class="text" fill="#000000" d="M520 184 c0 -107 -1 -116 -20 -121 -11 -3 -20 -12 -20 -19 0 -21 76
-19 84 2 3 9 6 69 6 135 l0 119 -25 0 -25 0 0 -116z"></path>
<path class="text" fill="#000000" d="M649 271 c-24 -25 -29 -37 -29 -78 1 -70 34 -103 105 -103 55 0 95
44 95 103 0 60 -7 75 -41 92 -47 25 -96 19 -130 -14z m111 -30 c25 -48 2 -111
-40 -111 -45 0 -69 80 -34 114 21 22 61 20 74 -3z"></path>
<path class="text" fill="#000000" d="M850 287 c0 -8 16 -57 36 -110 28 -76 33 -100 25 -116 -16 -28 -14
-31 18 -31 27 0 29 4 70 123 23 67 41 128 41 135 0 6 -11 12 -24 12 -21 0 -26
-8 -41 -65 -10 -36 -21 -68 -25 -70 -3 -2 -16 27 -29 66 -19 60 -25 69 -47 69
-13 0 -24 -6 -24 -13z"></path>
<path class="text" fill="#000000" d="M1192 284 c-17 -12 -22 -24 -20 -47 2 -26 10 -36 45 -52 49 -23 59
-55 17 -55 -14 0 -34 5 -45 10 -16 9 -19 7 -19 -13 0 -17 7 -27 23 -31 69 -18
117 6 117 60 0 32 -4 37 -45 55 -60 26 -62 54 -4 46 37 -5 40 -3 37 16 -2 18
-11 23 -43 25 -25 2 -49 -3 -63 -14z"></path>
</g>
</svg>

                </a>
              </div>
              <button class="navbar-toggle" type="button">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
            </div>
            <div class="buttons hidden-xs">
              <nav class="navigation-links" role="navigation">
                <ul class="main-links nav navbar-nav navbar-right">
                  <li><a href="../aws.html">AWS</a></li>
                  <li><a href="../linux.html">Linux</a></li>
                  <li><a href="../docker.html">Docker</a></li>
                  <li><a href="../ibmpower.html">IBM Power</a></li>
                  <li><a href="blogsataws1.html">Blogs@AWS (Kindle Friendly)</a></li>
                </ul>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="sidebar-overlay"></div>

<aside class="sidebar" role="navigation">
  <div class="sidebar-header">
    <svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="135.000000pt" height="42" viewbox="0 0 135.000000 45.000000" preserveaspectratio="xMidYMid meet">

<g transform="translate(0.000000,45.000000) scale(0.100000,-0.100000)" fill="#000000" stroke="none">
<path class="text" fill="#000000" d="M527 384 c-4 -4 -7 -18 -7 -31 0 -21 4 -24 28 -21 21 2 27 8 27 28 0
18 -6 26 -20 28 -12 2 -24 0 -28 -4z"></path>
<path class="text" fill="#000000" d="M1080 335 c0 -48 2 -55 20 -55 18 0 20 7 20 55 0 48 -2 55 -20 55
-18 0 -20 -7 -20 -55z"></path>
<path class="text" fill="#000000" d="M54 357 c-2 -7 -3 -69 -2 -138 l3 -124 65 -3 c90 -3 130 20 130 77 0
29 -6 44 -20 54 -20 14 -20 15 -3 45 14 25 15 34 5 56 -6 15 -23 31 -38 36
-38 15 -134 13 -140 -3z m110 -33 c19 -7 21 -45 4 -62 -7 -7 -22 -12 -35 -12
-20 0 -23 5 -23 40 0 41 13 50 54 34z m20 -130 c19 -18 19 -20 6 -45 -8 -13
-21 -19 -45 -19 -34 0 -35 1 -35 40 0 38 2 40 29 40 16 0 37 -7 45 -16z"></path>
<path class="text" fill="#000000" d="M319 271 c-23 -24 -29 -38 -29 -74 0 -25 3 -53 6 -62 20 -50 164 -64
164 -15 0 15 -7 17 -45 12 -46 -5 -75 8 -75 34 0 11 16 14 65 14 l65 0 0 35
c0 80 -92 114 -151 56z m99 -33 c3 -15 -4 -18 -37 -18 -43 0 -50 7 -29 28 18
18 62 11 66 -10z"></path>
<path class="text" fill="#000000" d="M520 184 c0 -107 -1 -116 -20 -121 -11 -3 -20 -12 -20 -19 0 -21 76
-19 84 2 3 9 6 69 6 135 l0 119 -25 0 -25 0 0 -116z"></path>
<path class="text" fill="#000000" d="M649 271 c-24 -25 -29 -37 -29 -78 1 -70 34 -103 105 -103 55 0 95
44 95 103 0 60 -7 75 -41 92 -47 25 -96 19 -130 -14z m111 -30 c25 -48 2 -111
-40 -111 -45 0 -69 80 -34 114 21 22 61 20 74 -3z"></path>
<path class="text" fill="#000000" d="M850 287 c0 -8 16 -57 36 -110 28 -76 33 -100 25 -116 -16 -28 -14
-31 18 -31 27 0 29 4 70 123 23 67 41 128 41 135 0 6 -11 12 -24 12 -21 0 -26
-8 -41 -65 -10 -36 -21 -68 -25 -70 -3 -2 -16 27 -29 66 -19 60 -25 69 -47 69
-13 0 -24 -6 -24 -13z"></path>
<path class="text" fill="#000000" d="M1192 284 c-17 -12 -22 -24 -20 -47 2 -26 10 -36 45 -52 49 -23 59
-55 17 -55 -14 0 -34 5 -45 10 -16 9 -19 7 -19 -13 0 -17 7 -27 23 -31 69 -18
117 6 117 60 0 32 -4 37 -45 55 -60 26 -62 54 -4 46 37 -5 40 -3 37 16 -2 18
-11 23 -43 25 -25 2 -49 -3 -63 -14z"></path>
</g>
</svg>

  </div>

  <ul class="nav sidebar-nav">
    <li><a href="../aws.html">AWS</a></li>
    <li><a href="../linux.html">Linux</a></li>
    <li><a href="../docker.html">Docker</a></li>
    <li><a href="../ibmpower.html">IBM Power</a></li>
    <li><a href="blogsataws1.html">Blogs@AWS (Kindle Friendly)</a></li>
  </ul>
</aside>


    <div class="container">
  <div class="row">
    <div id="docs-sidebar" class="col-sm-3 col-md-3 col-xs-12 hidden-print" role="complementary">
      <ul class="nav docs-sidenav">
      <li><a href="blogsataws1.html">Blogs @ AWS</a></li>
      <li><a href="whatsnew1.html">What's New @ AWS</a></li>
      <li class="active"><a href="mgmtblogs1.html">Management Tools Blogs @ AWS</a></li>
      <li><a href="computeblogs1.html">Compute Blogs @ AWS</a></li>
      <li><a href="devopsblogs1.html">DevOps Blogs @ AWS</a></li>
      <li><a href="secblogs1.html">Security Blogs @ AWS</a></li>
      <li><a href="apnblogs1.html">APN Blogs @ AWS</a></li>

    </ul>
    </div>

    <div id="inner" class="col-sm-9 col-md-9 col-xs-12" role="main">
<p></p>
<p><i>Contents of this page is copied directly from AWS blog sites to make it Kindle friendly. Some styles & sections from these pages are removed to render this properly in 'Article Mode' of Kindle e-Reader browser. All the contents of this page is property of AWS.</i></p>
<p><a href="mgmtblogs1.html">Page 1</a>|<a href="mgmtblogs2.html">Page 2</a>|<a href="mgmtblogs3.html">Page 3</a>|<a href="mgmtblogs4.html">Page 4</a></p>
<article class="blog-post" vocab="http://schema.org/" typeof="TechArticle"> 
<meta property="inLanguage" content="en-US" /> 
<meta property="image" content="https://d2908q01vomqb2.cloudfront.net/972a67c48192728a34979d9a35164c1295401b71/2018/01/31/Screen-Shot-2018-01-31-at-12.00.15-PM.png" /> 
<b class="lb-b blog-post-title" property="name headline">AWS CloudFormation: 2017 in Review</b> 
<footer class="blog-post-meta" data-lb-comp="aws-blog:share-dialog">
by 
<span property="author" typeof="Person"><span property="name">Chuck Meyer</span></span> | on 
<time property="datePublished" datetime="2018-02-02T13:35:05+00:00">02 FEB 2018</time> | in 
<span class="blog-post-categories"><a href="https://aws.amazon.com/blogs/mt/category/management-tools/aws-cloudformation/" title="View all posts in AWS CloudFormation*"><span property="articleSection">AWS CloudFormation*</span></a>, <a href="https://aws.amazon.com/blogs/mt/category/management-tools/" title="View all posts in Management Tools*"><span property="articleSection">Management Tools*</span></a></span> | 
<a href="https://aws.amazon.com/blogs/mt/aws-cloudformation-2017-in-review/" property="url">Permalink</a> | 
<a href="#" role="button" data-share-dialog-toggle=""><span class="span icon-share"></span>&nbsp;Share</a> 
</footer> 
<p>In 2017, over 350,000 AWS customers used <a href="https://aws.amazon.com/cloudformation">AWS CloudFormation</a> to manage resources collected across 2.4M stacks. We added coverage for 14 new services and several new features.</p> 
<p>In this post, I’d like to look back at some features and new content that CloudFormation introduced in 2017, including:</p> 
<ul class="incremental"> 
<li>New AWS resources that you can provision with CloudFormation.</li> 
<li>StackSets to centrally manage stacks across accounts and regions.</li> 
<li>Termination protection to protect stacks that contain critical resources.</li> 
<li>Rollback triggers to revert infrastructure changes impacting application performance.</li> 
<li>Integration with <a href="https://aws.amazon.com/systems-manager">AWS Systems Manager</a> Parameter Store.</li> 
<li>Quick-create links to get stacks up and running quickly.</li> 
<li>…and some of our most popular posts and re:Invent sessions.</li> 
<p>I also talk a little about what’s ahead in 2018.<span id="more-2521"></span></p> 
<h3 id="new-aws-resources">New AWS resources</h3> 
<p>I did some digging into the <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-resource-specification.html">AWS CloudFormation Resource Specification</a> and pulled out a few interesting statistics.</p> 
<p>In 2017, we added support for 14 new services and APIs in CloudFormation:</p> 
<table style="height: 203px" width="775"> 
<tbody> 
<tr> 
<td>Amazon Athena</td> 
<td>AWS Glue</td> 
</tr> 
<tr> 
<td>AWS Batch</td> 
<td>Amazon GuardDuty</td> 
</tr> 
<tr> 
<td>AWS Cloud9</td> 
<td>Amazon Inspector</td> 
</tr> 
<tr> 
<td>AWS CodeStar</td> 
<td>Amazon Kinesis Data Analytics</td> 
</tr> 
<tr> 
<td>Amazon Cognito</td> 
<td>Amazon Route 53 Auto Naming API</td> 
</tr> 
<tr> 
<td>AWS Database Migration Service (AWS DMS)</td> 
<td>AWS Step Functions</td> 
</tr> 
<tr> 
<td>Amazon DynamoDB Accelerator (DAX)</td> 
<td>AWS WAF Regional</td> 
</tr> 
</tbody> 
</table> 
<p>As of today, you can use CloudFormation to provision 248 AWS resource types, 71 more than this time last year. For information about supported resources, see the <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-template-resource-type-ref.html">AWS Resource Types Reference</a> in the <em>AWS CloudFormation User Guide</em> or grab the <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-resource-specification.html">AWS CloudFormation Resource Specification</a> yourself for the canonical list.</p> 
<p><img width="100%" src="https://d2908q01vomqb2.cloudfront.net/972a67c48192728a34979d9a35164c1295401b71/2018/01/31/Screen-Shot-2018-01-31-at-12.00.15-PM.png" /></p> 
<p>You can read up on some of these new features and service in a series of coverage posts that my colleague, Luis Colon, has been writing. For instance, here’s one walking you through <a href="https://aws.amazon.com/blogs/mt/aws-cloudformation-features-update-support-for-amazon-athena-coverage-updates-for-s3-rds-kinesis-and-cloudwatch/">creating a named query resource for Amazon Athena</a>.</p> 
<h3 id="stacksets">StackSets</h3> 
<p>With CloudFormation StackSets, you can now define AWS resources in a CloudFormation template and then roll it out across multiple AWS accounts or Regions in an automated and repeatable manner. You can use this to set up a baseline level of AWS functionality that addresses cross-account and cross-region infrastructure management.</p> 
<p>Jeff Barr walked you through <a href="https://aws.amazon.com/blogs/aws/use-cloudformation-stacksets-to-provision-resources-across-multiple-aws-accounts-and-regions/">using StackSets</a> in a post on the AWS Blog.</p> 
<h3 id="termination-protection">Termination protection</h3> 
<p>Enabling termination protection on a stack prevents it from being accidentally deleted. You cannot delete a stack with termination protection enabled. We walked you through turning on this feature in our post on how to <a href="https://aws.amazon.com/blogs/mt/use-aws-cloudformation-stack-termination-protection-and-rollback-triggers-to-maintain-infrastructure-availability/">Use AWS CloudFormation Stack Termination Protection and Rollback Triggers to Maintain Infrastructure Availability</a>. We also discussed incorporating this feature into a strategy for <a href="https://aws.amazon.com/blogs/mt/aws-cloudformation-guardrails-protecting-your-stacks-and-ensuring-safer-updates/">AWS CloudFormation Guardrails: Protecting your Stacks and Ensuring Safer Updates</a>.</p> 
<h3 id="rollback-triggers">Rollback triggers</h3> 
<p>Rollback triggers enable you to have CloudFormation monitor the state of your application during stack creation and updates. CloudFormation rolls back that operation if the application breaches the threshold of any of the alarms that you’ve specified.</p> 
<p>There’s a walkthrough of setting up a rollback trigger in the second half of my post, <a href="https://aws.amazon.com/blogs/mt/use-aws-cloudformation-stack-termination-protection-and-rollback-triggers-to-maintain-infrastructure-availability/">Use AWS CloudFormation Stack Termination Protection and Rollback Triggers to Maintain Infrastructure Availability</a>.</p> 
<h3 id="systems-manager-parameter-store-integration">Systems Manager Parameter Store integration</h3> 
<p>You can now reference Systems Manager parameters in the Parameters section of your CloudFormation templates to simplify stack updates and achieve consistency by using values from Parameter Store.</p> 
<p>We published a post to walk you through the process of <a href="https://aws.amazon.com/blogs/mt/integrating-aws-cloudformation-with-aws-systems-manager-parameter-store/">Integrating AWS CloudFormation with AWS Systems Manager Parameter Store</a>.</p> 
<h3 id="quick-create-links-to-get-stacks-up-and-running-quickly.">Quick-create links to get stacks up and running quickly.</h3> 
<p>Finally, you can now build quick-create links pre-populated with the template URL, stack name, and template parameters. To try it out yourself, check out <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-console-create-stacks-quick-create-links.html">Creating Quick-Create Links for Stacks</a>.</p> 
<h3 id="blog-posts-and-reinvent-sessions">Blog posts and re:Invent sessions</h3> 
<p>The most-read CloudFormation post from the <a href="https://aws.amazon.com/blogs/mt/">AWS Management Tools blog</a> in 2017 was <a href="https://aws.amazon.com/blogs/mt/configuring-serverless-applications-using-aws-cloudformation-custom-resources/">Configuring Serverless applications using CloudFormation Custom Resources</a>. Posts on <a href="https://aws.amazon.com/blogs/mt/use-aws-cloudformation-stack-termination-protection-and-rollback-triggers-to-maintain-infrastructure-availability/">Stack Termination</a> and <a href="https://aws.amazon.com/blogs/mt/integrating-aws-cloudformation-with-aws-systems-manager-parameter-store/">Parameter Store integration</a> were also popular.</p> 
<p>At re:Invent, there were 67 sessions at least partially dealing with CloudFormation. The <a href="https://youtu.be/01hy48R9Kr8">CloudFormation Deep Dive (DEV317)</a> session was popular enough to get a repeat session. Other sessions included:</p> 
<ul class="incremental"> 
<li><a href="https://www.youtube.com/watch?v=vKd7WeCLJaM">Learn How Intuit Built a Frictionless Infrastructure Management (DEV318)</a></li> 
<li><a href="https://www.youtube.com/watch?v=IBvsizhKtFk">AWS re:Invent 2017: How Amazon.com Uses AWS Management Tools (DEV340)</a></li> 
<h3 id="whats-next">What’s next</h3> 
<p>The AWS CloudFormation team looks forward to making more improvements to your CloudFormation experience in 2018, starting with the new Drift Detection feature that we announced at re:Invent and which is currently in beta.</p> 
<p>And remember, you can always go to the documentation <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/ReleaseHistory.html">CloudFormation release history page</a> to see the latest updates.</p> 
<hr /> 
<h3><img width="100%" src="https://d2908q01vomqb2.cloudfront.net/972a67c48192728a34979d9a35164c1295401b71/2017/10/23/BadgePhoto-blog.jpg" />About the Author</h3> 
<p>Chuck Meyer&nbsp;is a Senior Developer Advocate for AWS CloudFormation based in Ohio.&nbsp; He&nbsp;spends his time&nbsp;working with&nbsp;both&nbsp;external and internal development teams to constantly improve the developer experience for CloudFormation users.&nbsp; He’s a live music true believer and spends as much time as possible playing bass and watching bands.</p> 
</article> 
<article class="blog-post" vocab="http://schema.org/" typeof="TechArticle"> 
<meta property="inLanguage" content="en-US" /> 
<b class="lb-b blog-post-title" property="name headline">How to secure infrequently used EC2 instances with AWS Systems Manager</b> 
<footer class="blog-post-meta" data-lb-comp="aws-blog:share-dialog">
by 
<span property="author" typeof="Person"><span property="name">Spencer Glazier</span></span> | on 
<time property="datePublished" datetime="2018-01-31T17:47:06+00:00">31 JAN 2018</time> | in 
<span class="blog-post-categories"><a href="https://aws.amazon.com/blogs/mt/category/management-tools/amazon-ec2-systems-manager/" title="View all posts in Amazon EC2 Systems Manager*"><span property="articleSection">Amazon EC2 Systems Manager*</span></a>, <a href="https://aws.amazon.com/blogs/mt/category/management-tools/aws-cloudformation/" title="View all posts in AWS CloudFormation*"><span property="articleSection">AWS CloudFormation*</span></a>, <a href="https://aws.amazon.com/blogs/mt/category/compute/aws-lambda/" title="View all posts in AWS Lambda*"><span property="articleSection">AWS Lambda*</span></a>, <a href="https://aws.amazon.com/blogs/mt/category/application-services/aws-step-functions/" title="View all posts in AWS Step Functions*"><span property="articleSection">AWS Step Functions*</span></a></span> | 
<a href="https://aws.amazon.com/blogs/mt/how-to-secure-infrequently-used-ec2-instances-with-aws-systems-manager/" property="url">Permalink</a> | 
<a href="#" role="button" data-share-dialog-toggle=""><span class="span icon-share"></span>&nbsp;Share</a> 
</footer> 
<p>Many organizations have predictable spikes in the usage of their applications and services. For example, retailers see large spikes in usage during Black Friday or Cyber Monday. The beauty of Amazon Elastic Compute Cloud (Amazon EC2) is that it allows customers to quickly scale up their compute power to meet these demands. However, some customers might require more time-consuming setup for their software running on EC2 instances. Instead of creating and terminating instances to meet demand, these customers turn off instances and then turn them on again when they are needed. Eventually the patches on those instances become out of date, and they require updates.</p> 
<p>In this blog, I cover how to leverage AWS Step Functions and AWS Systems Manager Maintenance Windows to start an EC2 instance, apply any outstanding patches using Patch Manager, then stop the EC2 instance. I also cover the necessary steps to manage these resources using AWS CloudFormation. A Maintenance Window lets you define a schedule for when to perform potentially disruptive actions on your instances, such as patching an operating system (OS), updating drivers, or installing software. Each Maintenance Window has a schedule, a duration, a set of registered targets, and a set of registered tasks. AWS Step Functions are part of the AWS Serverless Platform. They make it simple to orchestrate AWS Lambda functions for serverless applications. Finally, CloudFormation gives developers and systems administrators an easy way to create and manage a collection of related AWS resources, provisioning and updating them in an orderly and predictable fashion.</p> 
<p><span id="more-2436"></span></p> 
<p><strong>Availability</strong></p> 
<p>Although AWS Systems Manager is currently available in all AWS Regions, CloudFormation support for Systems Manager is only available in some Regions. For a list of available Regions, please check the CloudFormationResourceSpecification.json for a given Region, which can be seen <a title="undefined" href="http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-resource-specification.html" target="_blank" rel="noopener noreferrer">here</a>. Similarly, Step Functions are only available in some Regions as well. The list of available Regions can be seen <a title="undefined" href="https://aws.amazon.com/about-aws/global-infrastructure/regional-product-services/" target="_blank" rel="noopener noreferrer">here</a>.</p> 
<p><strong>Setup</strong></p> 
<p>CloudFormation works on your behalf to manage AWS resources. The CloudFormation template for this post, which outlines the resources that will be provisioned into an AWS CloudFormation stack, can be run as-is, there is no additional setup required to get started. The template creates the following resources:</p> 
<li>An EC2 instance 
<li>The instance we are going to patch</li> 
</ul> </li> 
<li>A Systems Manager Maintenance Window 
<li>A Maintenance Window representing a timeframe in which to run our patching operation</li> 
</ul> </li> 
<li>A Systems Manager Maintenance Window target 
<li>A target on which the task will act, in this case it will be our EC2 instance</li> 
</ul> </li> 
<li>A Systems Manager Maintenance Window task 
<li>The task that we want to execute, in this case an AWS Step Function</li> 
</ul> </li> 
<li>A series of AWS Lambda functions 
<li>One Lambda function for each of the following actions: start, stop, patch, and poll our instance as well as poll the patching activity</li> 
</ul> </li> 
<li>An AWS Step Function 
<li>Manages the workflow of the Lambda Functions</li> 
</ul> </li> 
<li>IAM roles 
<li>Give proper access to all of the above mentioned resources</li> 
</ul> </li> 
<p>Here is a link (<a title="undefined" href="https://s3-us-west-2.amazonaws.com/management-tools-blog-cf-template-storage/InstancePatchingWithSSMTemplate.json" target="_blank" rel="noopener noreferrer">JSON</a>)/(<a title="undefined" href="https://s3-us-west-2.amazonaws.com/management-tools-blog-cf-template-storage/InstancePatchingWithSSMTemplate.yaml" target="_blank" rel="noopener noreferrer">YAML</a>) to the sample template. I will walk through each piece of the template step-by-step. I’ll discuss some of the common issues to look out for when trying to run this template on your own account.</p> 
<h3><strong>CloudFormation template walkthrough</strong></h3> 
<p><strong>IAM roles</strong></p> 
<p>A Maintenance Window executes a set of tasks on a schedule without requiring user interaction through the AWS Management Console or the AWS SDK/CLI. For this blog post, the task will be a Step Function. The Maintenance Window will require an IAM role that grants it the appropriate permissions to execute the Step Function. Also, the Lambda functions and Step Function require their own roles based on the resources they are accessing. These are the IAM roles created for this blog post:</p> 
<li>InstanceStateActionRoleForLambda 
<li>The InstanceStateActionRoleForLambda provides the necessary access to allow the Starter, Stopper, and InstancePoller Lambda functions to call an EC2 instance.</li> 
</ul> </li> 
<li>InstancePatchingRoleForLambda 
<li>The InstancePatchingRoleForLambda provides the necessary access to allow the Patcher and PatchPoller Lambda functions to call Systems Manager.</li> 
</ul> </li> 
<li>StepFunctionRole 
<li>The StepFunctionRole allows your Step Function to call each of the Lambda functions.</li> 
</ul> </li> 
<p><strong>Lambda functions</strong></p> 
<p>Here is a list and short description of the Lambda functions created for this blog post:</p> 
<li>InstancePatcherLambda 
<li>Uses AWS Systems Manager&nbsp;Patch Manager&nbsp;to&nbsp;scan and install any patches based on the Patch Baseline that applies to the instance (the Patch Baseline associated with the instance’s Patch Group, if defined, otherwise the default Patch Baseline for the instance’s operating system).</li> 
</ul> </li> 
<li>InstancePatchPollerLambda 
<li>Polls Systems Manager to verify the status of the patching command.</li> 
</ul> </li> 
<li>InstanceStarterFunction 
<li>Starts the EC2 instance.</li> 
</ul> </li> 
<li>InstanceStopperLambda 
<li>Stops the EC2 instance.</li> 
</ul> </li> 
<li>InstancePollerLambda 
<li>Polls Amazon EC2 to verify whether the instance is running or stopped.</li> 
</ul> </li> 
<p><strong>Step Function</strong></p> 
<p>The Step Function organizes each of the Lambda functions into a workflow. The steps are laid out in a specific order, which reliably coordinates each component and steps through the workflow of the application. Also, in the Step Functions console, you can watch the Step Function operate and see each step as it moves through the workflow.</p> 
<p><strong>Maintenance Window</strong></p> 
<p>To set up a Maintenance Window using CloudFormation, you need three resources, and they must be created in the following order: a Maintenance Window, a Maintenance Window target, and a Maintenance Window task. The DependsOn attribute of CloudFormation allows us to order the creation of our resources. In the provided template, you can see that each of the Maintenance Window resources uses DependsOn to ensure this ordering. See the following excerpt:</p> 
<p><code class="language-yaml">MaintenanceWindow:<br /> Type: 'AWS::SSM::MaintenanceWindow'<br /> Properties:<br /> Name: 'LambdaMW'<br /> AllowUnassociatedTargets: 'true'<br /> Schedule: 'rate(30 minutes)'<br /> Duration: '2'<br /> Cutoff: '1'<br /> DependsOn: TestInstance<br /> </code></p> 
<p><strong>AMIInfo/AMIInfoFunction</strong></p> 
<p>These two resources are used only for convenience, they perform a lookup that generates the AMI-ID for the EC2 instance that we create in the stack. For more information <a title="undefined" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/walkthrough-custom-resources-lambda-lookup-amiids.html" target="_blank" rel="noopener noreferrer">see the documentation</a>.</p> 
<h3><strong>Activity walkthrough</strong></h3> 
<p>&nbsp;</p> 
<p><strong>Create the CloudFormation stack</strong></p> 
<p>Follow these steps to create the CloudFormation stack for this walkthrough.</p> 
<ol> 
<li>Open the <strong>AWS CloudFormation</strong> console at <a title="undefined" href="https://console.aws.amazon.com/cloudformation" target="_blank" rel="noopener noreferrer">https://console.aws.amazon.com/cloudformation</a>.</li> 
<li>Choose <strong>Create Stack</strong>.</li> 
<li>On the <strong>Select Template</strong> page, choose <strong>Specify an Amazon S3 template URL</strong> and give the following S3 URL: https://s3-us-west-2.amazonaws.com/management-tools-blog-cf-template-storage/InstancePatchingWithSSMTemplate.yaml.</li> 
<li>For <strong>Stack Name</strong>, give an appropriate name, choose <strong>Next</strong>.</li> 
<li>On the <strong>Options</strong> page, choose <strong>Next</strong>.</li> 
<li>On the <strong>Review</strong> page, select <strong>I acknowledge that AWS CloudFormation might create IAM resources with custom names</strong> and choose <strong>Create</strong>.</li> 
</ol> 
<p>You can view the progress of CloudFormation progress by selecting your stack and choosing the <strong>Events</strong> tab. Once CloudFormation has built each resource, it will show <em>CREATE_COMPLETE</em> as the Status for the stack.</p> 
<p>Follow these steps to view the Maintenance Window created in this walkthrough.</p> 
<ol> 
<li>Open the <strong>AWS Systems Manager</strong> console at <a title="undefined" href="https://console.aws.amazon.com/systems-manager" target="_blank" rel="noopener noreferrer">https://console.aws.amazon.com/systems-manager</a>.</li> 
<li>Navigate to <strong>Explore Maintenance Windows</strong>.</li> 
<li>Choose the Maintenance Window named <em>SSMStepFunctionDemo</em>.</li> 
<li>Choose the <strong>View Details</strong> button.</li> 
<li>Choose the <strong>History</strong> tab.</li> 
</ol> 
<p>It is possible that on the first Maintenance Window execution you might see a status message stating that there were no tasks to execute. This happens because the Maintenance Window is set to run every 30 minutes. When it gets created, it attempts to run immediately, but since there is no task associated with it, the execution returns Success with the above status. The schedule of a Maintenance Window can be in the form of a <a title="undefined" href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/events/ScheduledEvents.html" target="_blank" rel="noopener noreferrer">cron or rate expression</a> and since our Maintenance Window uses a rate expression, it will not run again for another 30 minutes. This issue also occurs for cron expressions that run in explicit intervals, for example <em>cron(0/15 * * * ? *)</em>. We can restart it by disabling and re-enabling the Maintenance Window.</p> 
<p>Here are the steps for restarting a Maintenance Window created in this walkthrough.</p> 
<ol> 
<li>Choose the Maintenance Window you want to restart.</li> 
<li>Choose <strong>Actions</strong> then choose <strong>Disable maintenance window</strong>.</li> 
<li>Choose <strong>Actions</strong> again then choose <strong>Enable maintenance window</strong>.</li> 
</ol> 
<p>Here are the steps for viewing the Step Function created in this walkthrough.</p> 
<ol> 
<li>Open the <strong>AWS CloudFormation</strong> console at <a title="undefined" href="https://console.aws.amazon.com/cloudformation" target="_blank" rel="noopener noreferrer">https://console.aws.amazon.com/cloudformation</a>.</li> 
<li>Choose the <strong>CloudFormation</strong> stack created previously.</li> 
<li>Select the <strong>Resources</strong> tab, search for the <strong>StateMachine</strong> created by <strong>CloudFormation</strong>. Take note of the name of the StateMachine, it will look something like this <em>SSMStepFunctionDemo-YCIADKH4IGYU</em>.</li> 
<li>Open the <strong>AWS State Machine</strong> console at <a title="undefined" href="https://console.aws.amazon.com/states" target="_blank" rel="noopener noreferrer">https://console.aws.amazon.com/states</a>.</li> 
<li>Choose the <strong>StateMachine</strong> with the name from <strong>step #3</strong>.</li> 
<li>Under the list of executions for the <strong>StateMachine</strong> find the currently running execution, then click on the link for that execution in the <strong>Name</strong> column.</li> 
</ol> 
<p>You can now watch as the Step Function executes each of the Lambda functions created through CloudFormation. Note that the actual updating of the patches can take some time, at least 10 to 15 minutes.</p> 
<p><strong>Viewing patching results</strong></p> 
<p>Now that the execution of the Step Function is complete, we can view the results of the Patching activity.</p> 
<p>Here are the steps to view the Maintenance Window patching results:</p> 
<ol> 
<li>Open the <strong>StateMachine</strong> execution from the previous step.</li> 
<li>Under the <strong>Visual Workflow</strong> tab, Choose the step labeled Patch Instance.</li> 
<li>Under <strong>Execution Details</strong> on the right, Choose the Output tab.</li> 
<li>Copy the value of <strong>commandId</strong>.</li> 
<li>Open the <strong>AWS Systems Manager</strong> console at <a title="undefined" href="https://console.aws.amazon.com/systems-manager" target="_blank" rel="noopener noreferrer">https://console.aws.amazon.com/systems-manager</a>.</li> 
<li>Choose <strong>Explore Run Command</strong>.</li> 
<li>Choose the search bar at the top of the table to add a filter.</li> 
<li>Select <strong>Command Id</strong> as the filter and paste in the Command Id you copied from step #4.</li> 
<li>Select the <strong>Command</strong>.</li> 
<li>In the <strong>Output</strong> tab at the bottom,&nbsp;click <strong>View Output</strong>.</li> 
</ol> 
<p>The output will display various pieces of information including which patches were installed, the snapshot ID for the patching snapshot, and the patch baseline used.</p> 
<p><strong>Verifying that the instance has stopped</strong></p> 
<p>After the execution of the Step Function is complete, it will stop the instance. We can see this by viewing the instance in the EC2 console.</p> 
<ol> 
<li>Open the <strong>EC2</strong> console at <a title="undefined" href="https://console.aws.amazon.com/ec2" target="_blank" rel="noopener noreferrer">https://console.aws.amazon.com/ec2</a>.</li> 
<li>Choose the <strong>Instances</strong> link under the <strong>Instances</strong> tab on the left.</li> 
<li>Find the <strong>EC2 instance</strong> with the Name <em>ssm-stepfunction-demo</em>.</li> 
</ol> 
<h3><strong>Conclusion</strong></h3> 
<p>In this post, I have shown you how to use CloudFormation to create a Maintenance Window that executes a Step Function, which&nbsp;uses Patch Manager to patch&nbsp;long running instances that we don’t want to keep on at all times. You can use CloudFormation to easily deploy Maintenance Windows across multiple Regions to ensure that resources are properly patched and that the states of your resources are as you expect. This also greatly reduces the burden of keeping Maintenance Windows in sync across Regions, guaranteeing that the Maintenance Windows are all operating in the same manner.</p> 
<p>For further information regarding using some of the AWS services in this blog post see the following user guides:</p> 
<p><a title="undefined" href="http://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-maintenance.html" target="_blank" rel="noopener noreferrer">Maintenance Window User Guide</a><br /> <a title="undefined" href="https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-patch.html" target="_blank" rel="noopener noreferrer">Patch Manager User Guide</a><br /> <a title="undefined" href="http://docs.aws.amazon.com/step-functions/latest/dg/welcome.html" target="_blank" rel="noopener noreferrer">Step Functions User Guide</a><br /> <a title="undefined" href="http://docs.aws.amazon.com/lambda/latest/dg/welcome.html" target="_blank" rel="noopener noreferrer">Lambda User Guide</a><br /> <a title="undefined" href="http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/Welcome.html" target="_blank" rel="noopener noreferrer">CloudFormation User Guide</a></p> 
<h3>About the Author</h3> 
<p><img width="100%" src="https://d2908q01vomqb2.cloudfront.net/972a67c48192728a34979d9a35164c1295401b71/2018/01/24/phonetoolicon.jpeg" /></p> 
<p>&nbsp;</p> 
<p>Spencer Glazier is a Software Development Engineer on the AWS Systems Manager team. He’s passionate about delivering products and services that enables customers to do more, faster and cheaper. In his free time he enjoys&nbsp;getting up early to run along the narrow streets of Seattle and spending time with his family.</p> 
</article> 
<article class="blog-post" vocab="http://schema.org/" typeof="TechArticle"> 
<meta property="inLanguage" content="en-US" /> 
<b class="lb-b blog-post-title" property="name headline">Analyzing Bitcoin Data: AWS CloudFormation Support for AWS Glue</b> 
<footer class="blog-post-meta" data-lb-comp="aws-blog:share-dialog">
by 
<span property="author" typeof="Person"><span property="name">Luis Colon</span></span> | on 
<time property="datePublished" datetime="2018-01-30T10:14:22+00:00">30 JAN 2018</time> | in 
<span class="blog-post-categories"><a href="https://aws.amazon.com/blogs/mt/category/analytics/" title="View all posts in Analytics*"><span property="articleSection">Analytics*</span></a>, <a href="https://aws.amazon.com/blogs/mt/category/management-tools/aws-cloudformation/" title="View all posts in AWS CloudFormation*"><span property="articleSection">AWS CloudFormation*</span></a>, <a href="https://aws.amazon.com/blogs/mt/category/analytics/aws-glue/" title="View all posts in AWS Glue*"><span property="articleSection">AWS Glue*</span></a>, <a href="https://aws.amazon.com/blogs/mt/category/management-tools/" title="View all posts in Management Tools*"><span property="articleSection">Management Tools*</span></a></span> | 
<a href="https://aws.amazon.com/blogs/mt/analyzing-bitcoin-data-aws-cloudformation-support-for-aws-glue/" property="url">Permalink</a> | 
<a href="#" role="button" data-share-dialog-toggle=""><span class="span icon-share"></span>&nbsp;Share</a> 
</footer> 
<p>The AWS CloudFormation team has been busy in the last couple of months, adding support for new resource types for recently released AWS services. In this post, I take a deep dive into using AWS Glue with CloudFormation.</p> 
<p><strong>About AWS Glue</strong></p> 
<p><a href="https://aws.amazon.com/glue/">AWS Glue</a> was first announced at re:Invent in 2016, and was made generally available in August 2017. AWS Glue is a serverless extract, transform and load (<a href="https://en.wikipedia.org/wiki/Extract,_transform,_load">ETL</a>) service. ETL is a critical step in operationalizing data analytics, since data cleansing and reformatting is almost always necessary when creating everything from data marts, warehouses, data lakes, machine learning algorithms, metrics dashboards, operational reports, and many other data science projects.</p> 
<p>Data science projects can be very time-consuming from an experimentation and discovery perspective. When a promising candidate project emerges, implementing the necessary production compute and storage resources can cause significant delays. It’s necessary that the business leverage the resources in a repeatable and ongoing basis.</p> 
<p><strong>Analyzing historical price data for bitcoin: Planning</strong></p> 
<p>Your company wants to pursue a new service relating to cryptocurrency analysis, and your IT team gets asked to produce a database with historical price information for bitcoin, to feed other analysis processes. Rather than require a significant upfront investment in building the database and the necessary tooling for ongoing analysis and model development, you can leverage AWS Glue and open source development tools like <a href="https://spark.apache.org/">Apache Spark</a>, Python and <a href="https://zeppelin.apache.org/">Apache Zeppelin</a> to enable quick experimentation and further product development. Further, you want to automate the operationalization of this data analysis platform as quickly as possible, and AWS CloudFormation helps with this automation.</p> 
<p><span id="more-2555"></span></p> 
<p>Start with getting historical bitcoin price data. You can choose to consume the data directly from currency exchanges, or you can find an existing dataset that includes past data. There are many sources of public data sets for such projects, as outlined in 18 places to find data sets for data science projects. One of my favorite sources for such data sets is <a href="https://www.kaggle.com/">Kaggle</a>, where you can also learn from other scientists’ projects and findings, as well as participate in data science competitions sponsored by companies and academic institutions.</p> 
<p>The dataset <a href="https://www.kaggle.com/mczielinski/bitcoin-historical-data">from the Bitcoin Historical Data</a> page will fit our needs (see Figure 1 below); it includes historical data from January 2012 to today, from several exchanges.</p> 
<p>&nbsp;</p> 
<p><img width="100%" src="https://d2908q01vomqb2.cloudfront.net/972a67c48192728a34979d9a35164c1295401b71/2018/01/29/datasample.png" /></p> 
<p><strong>Figure 1. A sample of the CSV data provided for the coinbase exchange.</strong></p> 
<p>&nbsp;</p> 
<p><strong>Setting up our Bitcoin Price Database</strong></p> 
<ol> 
<li>If you’ve never used Kaggle, you are asked to set up a free account.</li> 
<li>Download the data as a zip file from <a href="https://www.kaggle.com/mczielinski/bitcoin-historical-data">Bitcoin Historical Data</a>.</li> 
<li>Expand the zip file locally and locate the file for the coinbase exchange.</li> 
<li>Set up an Amazon S3 bucket and put the file there.</li> 
</ol> 
<p>Armed with this data, now get the data to a point that you can inspect it, query it, and plan for further development and experiments.</p> 
<ol> 
<li>Create a new file in your favorite editor.</li> 
<li>Copy and paste the following CloudFormation template into the file (see Figure 2 below).</li> 
<li>Save it, and create a new stack with the console (I used the US East N. Virginia region), the CLI, or the API.</li> 
</ol> 
<code class="lang-yaml">---
#===============================================================================
# Template: CoinbaseCrawler.yaml
#
# Purpose:  Creates resources to populate bitcoin historical data from
#           the Coinbase exchange into an AWS Glue Catalog
#===============================================================================
AWSTemplateFormatVersion: &quot;2010-09-09&quot;
Description: &quot;Populate Bitcoin historical data from Coinbase into AWS Glue&quot;
Resources:
#=============================================================================
# IAM Role and Policies for AWS Glue. Reusable across other ETL crawlers
#=============================================================================
ETLRole:
Type: AWS::IAM::Role
Properties:
AssumeRolePolicyDocument:
Version: &quot;2012-10-17&quot;
Statement:
-
Effect: &quot;Allow&quot;
Principal:
Service:
- &quot;glue.amazonaws.com&quot;
Action:
- &quot;sts:AssumeRole&quot;
Path: &quot;/&quot;
Policies:
-
PolicyName: &quot;root&quot;
PolicyDocument:
Version: &quot;2012-10-17&quot;
Statement:
-
Effect: &quot;Allow&quot;
Action: &quot;*&quot;
Resource: &quot;*&quot;
#=============================================================================
# BitcoinPriceDB: May reuse it if we want to compare data from other
# exchanges, like bitflyer, coincheck, and bitstamp
#=============================================================================
BitcoinPriceDB:
Type: AWS::Glue::Database
Properties:
CatalogId: !Ref AWS::AccountId
DatabaseInput:
Name: &quot;bitcoin-price-db&quot;
Description: &quot;Historical Bitcoin Price Data&quot;
#=============================================================================
# CoinbaseCrawler: Grab data from the coinbase csv into the BitcoinPriceDB
# NOTE: You MUST change the S3 Targets Path to point to your own bucket and
# folder!!!
#=============================================================================
CoinbaseCrawler:
Type: AWS::Glue::Crawler
Properties:
Name: &quot;coinbase-crawler&quot;
Description: &quot;Populate table with Bitcoin historical data from Coinbase&quot;
Role: !GetAtt ETLRole.Arn
DatabaseName: !Ref BitcoinPriceDB
TablePrefix: &quot;coinbase_&quot;
Targets:
S3Targets:
- Path: s3://cfnda-bitcoin-historical-data/coinbase
SchemaChangePolicy:
UpdateBehavior: &quot;UPDATE_IN_DATABASE&quot;
DeleteBehavior: &quot;DEPRECATE_IN_DATABASE&quot;
Schedule:
ScheduleExpression: &quot;cron(0/5 * ? * MON-FRI *)&quot;
</code> 
<p><strong>Figure 2. The CloudFormation template for the AWS Glue crawler from bitcoin data.</strong></p> 
<p>You set up everything with CloudFormation early in the process, so eventually operationalizing the solution in a production environment becomes fast and repeatable.&nbsp;The template helps you:</p> 
<li>Designate S3 as the storage data lake</li> 
<li>Create an IAM role to use AWS Glue</li> 
<li>Extract the data</li> 
<li>Create a database</li> 
<li>Load the data into a table that you can query with <a href="https://aws.amazon.com/athena/">Amazon Athena</a> or later visualize with <a href="https://aws.amazon.com/quicksight/">Amazon QuickSight</a>.</li> 
<p>Note the following from the template code:</p> 
<li>The template creates the minimal resources for setting up your database. This include the IAM role (<em>ETLRole</em> in the code example), the database itself, which can be used in Athena or QuickSight for further analysis, and the crawler. The crawler does the work of extracting the data from the CSV file that you downloaded and populates the table in the database.</li> 
<li>When creating the database (<em>BitcoinPriceDB</em> in the code example), ensure that you only use lowercase characters in the string for the Database Input/Name attribute (<em>bitcoin-price-db</em>, in the code example).</li> 
<li>For the crawler, specify your bucket in the Targets/S3Targets/Path attribute (<em>s3://cfnda-bitcoin-historical-data/</em>coinbase in the code example). Put your own bucket and folder path where you uploaded your copy of the coinbase file that you got from Kaggle in the previous steps.</li> 
<li>For this example, the template sets up a schedule for the crawler to run every five minutes on weekdays. For your experiment, you may either omit the Schedule/ScheduleExpression stanza and run the crawler manually from the AWS Glue console, or use your own cron expression (see some examples in <a href="https://docs.aws.amazon.com/glue/latest/dg/monitor-data-warehouse-schedule.html">Time-Based Schedules for Jobs and Crawlers</a>,keeping in mind that you are charged per the rates on <a href="https://aws.amazon.com/glue/pricing/">AWS Glue Pricing</a>).</li> 
<li>For this quick example, it makes sense to put everything in one template, with the benefit of quickly deleting all resources by deleting the stack. For a long-term project, you may want to create these resources in separate templates, as you only need to create the role and database one time. To look at the data from the other bitcoin exchanges provided in the Kaggle dataset, reuse the crawler code in separate templates and stacks for biflyer, coincheck, and bit stamp, which are also provided in the same dataset.</li> 
<p>After creating the stack, which should take about 40 seconds, check the AWS Glue console where your database and crawler show up on the respective lists immediately. After the crawler runs (in about 5 minutes, per your scheduled cron expression), the table also shows up. After the table creation is complete, you can view the schema from the AWS Glue console (see Figure 3), or execute SQL queries against it using the Athena console (see Figure 4).</p> 
<p><img width="100%" src="https://d2908q01vomqb2.cloudfront.net/972a67c48192728a34979d9a35164c1295401b71/2018/01/29/glue-coinbase-table-schema-1024x543.png" /></p> 
<p><strong>Figure 3. Schema for the coinbase historical pricing table, created with the AWS Glue crawler.</strong></p> 
<p><img width="100%" src="https://d2908q01vomqb2.cloudfront.net/972a67c48192728a34979d9a35164c1295401b71/2018/01/29/athena-coinbase-table-preview-1024x576.png" /></p> 
<p><strong>Figure 4. Sample query results from the coinbase historical pricing table, using the Athena Query Editor.</strong></p> 
<p>&nbsp;</p> 
<p><strong>Suggested next steps</strong></p> 
<p>Now that you’ve figured out how to ingest the data to a place where you can query it, you can begin to compare the data with other exchanges from the dataset. You can also merge it with other data, reformat the data to make it easier to consume, and further enable data experiments.</p> 
<p>For example, maybe you want to merge the data with other events or logs, but those events lack enough structure to build tables from them and join them with your existing tables.&nbsp;Using AWS Glue <a href="https://docs.aws.amazon.com/glue/latest/dg/add-classifier.html">classifiers</a>, you can use grok expressions to add structure to these additional data sources.</p> 
<p>Another example that considers the current data schema would be transforming the UNIX time format field to a conventional date field.&nbsp;AWS Glue allows for the creation of <a href="https://docs.aws.amazon.com/glue/latest/dg/add-job.html">jobs</a> that can do such transforms on fields.&nbsp;It also allows you to use <a href="http://spark.apache.org/docs/2.2.0/api/python/pyspark.html">PySpark</a> (Python-based <a href="http://spark.apache.org/">Spark</a> scripts) to do such transformations.&nbsp;You can later operationalize those scripts as jobs in AWS Glue, and have them run periodically or based on a trigger, perhaps to get updated data.</p> 
<p>You can write and debug your own scripts, from your local IDE, by creating development endpoints in AWS Glue.&nbsp;Further, you can develop scripts and conduct experiments using <a href="https://zeppelin.apache.org/">Apache Zeppelin</a> notebooks, deploying a server with the Zeppelin software ready to use.&nbsp;Not surprisingly, AWS Glue uses CloudFormation to deploy these Zeppelin servers.&nbsp;For more information about setting up your local IDE, see <a href="https://docs.aws.amazon.com/glue/latest/dg/dev-endpoint-tutorial-pycharm.html">Tutorial: Set Up PyCharm Professional with a Development Endpoint</a> to link your AWS Glue endpoint with JetBrains’ <a href="https://www.jetbrains.com/pycharm/">PyCharm Professional</a>, or see <a href="https://docs.aws.amazon.com/glue/latest/dg/dev-endpoint-tutorial-EC2-notebook.html">Tutorial: Set Up an Apache Zeppelin Notebook on Amazon EC2</a> on how to create a Zeppelin notebook server on an Amazon EC2 instance right from the AWS Glue console, using CloudFormation to deploy the server.</p> 
<p>Visit the <a href="https://aws.amazon.com/cloudformation/">CloudFormation</a> details page and <a href="https://aws.amazon.com/documentation/cloudformation/">CloudFormation documentation</a> for more information, as well as the full list of <a href="http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-supported-resources.html">supported resources</a>.</p> 
<p>&nbsp;</p> 
<h3>About the Author</h3> 
<table style="height: 164px" width="1242"> 
<tbody> 
<tr> 
<td width="63"><img width="100%" src="https://d2908q01vomqb2.cloudfront.net/972a67c48192728a34979d9a35164c1295401b71/2017/10/17/PhoneTool1.jpg" /></td> 
<td width="391"> <p><strong>Luis Colon is a Senior Developer Advocate for the AWS CloudFormation team.</strong>&nbsp;He works with customers and internal development teams to focus on and improve the developer experience for CloudFormation users. In his spare time, he mixes progressive trance music.</p> <p>&nbsp;</p></td> 
</tr> 
</tbody> 
</table> 
<p></p> 
</article> 
<article class="blog-post" vocab="http://schema.org/" typeof="TechArticle"> 
<meta property="inLanguage" content="en-US" /> 
<b class="lb-b blog-post-title" property="name headline">AWS CloudFormation Update: AWS Guard Duty, Amazon Inspector, and Service Discovery, plus 40 resource updates</b> 
<footer class="blog-post-meta" data-lb-comp="aws-blog:share-dialog">
by 
<span property="author" typeof="Person"><span property="name">Luis Colon</span></span> | on 
<time property="datePublished" datetime="2018-01-30T10:14:06+00:00">30 JAN 2018</time> | in 
<span class="blog-post-categories"><a href="https://aws.amazon.com/blogs/mt/category/management-tools/aws-cloudformation/" title="View all posts in AWS CloudFormation*"><span property="articleSection">AWS CloudFormation*</span></a>, <a href="https://aws.amazon.com/blogs/mt/category/management-tools/" title="View all posts in Management Tools*"><span property="articleSection">Management Tools*</span></a></span> | 
<a href="https://aws.amazon.com/blogs/mt/aws-cloudformation-update-aws-guard-duty-amazon-inspector-and-service-discovery-plus-40-resource-updates/" property="url">Permalink</a> | 
<a href="#" role="button" data-share-dialog-toggle=""><span class="span icon-share"></span>&nbsp;Share</a> 
</footer> 
<p>AWS CloudFormation recently added support for these recently released AWS services:</p> 
<li><a href="https://aws.amazon.com/guardduty/"><strong>AWS Guard Duty</strong></a> is an automated threat-detection service that can be quickly enabled, does not require agents to be installed, and monitors unusual account usage using sources like AWS CloudTrail logs, DNS logs, and other sources. With the new AWS CloudFormation resource support, you can create <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-guardduty-detector.html">detectors</a>, whitelisted <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-guardduty-ipset.html">IP sets</a>, and identify known malicious IP addresses via <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-guardduty-threatintelset.html">ThreatIntelSets</a>.</li> 
<li><a href="https://aws.amazon.com/inspector/"><strong>Amazon Inspector</strong></a> is a low-impact, low-cost, agent-based vulnerability scanner.Use it, for example, to automate vulnerability assessments and make them part of your deployment process.&nbsp;With the new AWS CloudFormation resource support, you can take tagged resources and build a <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-inspector-resourcegroup.html">resource group</a>, then use the resource group to create an <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-inspector-assessmenttarget.html">assessment target</a>.&nbsp;Finally, you can create an <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-inspector-assessmenttemplate.html">assessment template</a>, which is similar to a policy document and determines which rules the service uses to analyze the target hosts, as well as a duration for the assessment run.</li> 
<li><a href="https://aws.amazon.com/about-aws/whats-new/2017/12/amazon-route-53-releases-auto-naming-api-name-service-management/"><strong>Amazon Route 53 Auto Naming for Service Discovery</strong></a> and the new AWS::ServiceDiscovery resources in CloudFormation make it easy to consume the recently released Route 53 Auto Naming API calls.It can be used, for example, if you’re creating microservices in Amazon ECS and you want to leverage Route 53 to register new service instances and aid in the management and discovery of service names. This is important for <a href="https://aws.amazon.com/ecs/">Amazon ECS</a> deployments, and it helps enable blue/green deployment patterns.&nbsp;With the new AWS CloudFormation resources, you can create either <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-servicediscovery-publicdnsnamespace.html">public</a> or <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-servicediscovery-privatednsnamespace.html">private</a> DNS namespaces, then create named <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-servicediscovery-service.html">services</a> and <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-servicediscovery-instance.html">service instances</a> for your microservices.&nbsp;If you’re interested in using these new resources, I recommend checking out this <a href="https://www.slideshare.net/AmazonWebServices/introducing-service-discovery-for-amazon-ecs-con403-reinvent-2017">deck</a> from a session at the AWS re:Invent 2017 conference.</li> 
<p>Beyond supporting these new services, 40 of the 248 existing supported resources have been updated recently, adding 50 new property types for these resources. The following list summarizes these recent changes, ordered by service name:</p> 
<p><span id="more-2568"></span></p> 
<p><strong>Amazon API Gateway</strong></p> 
<li>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-apigateway-deployment.html">AWS::ApiGateway::Deployment</a>, a&nbsp;<em>StageName</em> property has been deprecated on the StageDescription property type</li> 
<li>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-apigateway-method.html">AWS::ApiGateway::Method</a>, an&nbsp;<em>OpeationName</em> property was added to assign a friendly name to an API Gateway method; a&nbsp;<em>RequestValidatorId</em> property was added to associate a request validator with a method; a&nbsp;<em>ContentHandling</em> property was added for <em>Integration</em> and <em>IntegrationResponse</em> property types to specify how to handle request payload content type conversions</li> 
<li>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-apigateway-apikey.html">AWS::ApiGateway::ApiKey</a>, a&nbsp;<em>CustomerID</em> property was added to specify an AWS Marketplace customer identifier; a&nbsp;<em>GenerateDistinctID</em> property was added to indicate whether the key identifier is different from the created API key value</li> 
<li>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-apigateway-authorizer.html">AWS::ApiGateway::Authorizer</a>, an&nbsp;<em>AuthType</em> property was added to specify a customer-defined field that is used in Swagger imports and exports without functional impact</li> 
<li>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-apigateway-domainname.html">AWS::ApiGateway::DomainName</a>, an&nbsp;<em>EndpointConfiguration</em> property was added to specify the endpoint types of an API Gateway domain name; a&nbsp;<em>RegionalCertificateArn</em> property was added to reference a certificate for use by the regional endpoint for a domain name</li> 
<li>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-apigateway-restapi.html">AWS::ApiGateway::RestApi</a>, an&nbsp;<em>EndpointConfiguration</em> property was added to specify the endpoint types of a REST API</li> 
<p><strong>AWS Auto Scaling</strong></p> 
<li>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-applicationautoscaling-scalabletarget.html">AWS::ApplicationAutoScaling::ScalableTarget</a>, a&nbsp;<em>ScheduledActions</em> property was added to specify scheduled actions</li> 
<li>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-as-group.html">AWS::AutoScaling::AutoScalingGroup</a>, a&nbsp;<em>LifecycleHookSpecificationList</em> property was added to specify actions to perform when Auto Scaling launches or terminates instances</li> 
<p><strong>AWS Cloud9</strong></p> 
<li><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-cloud9-environmentec2.html">AWS::Cloud9::EnvironmentEC2</a>&nbsp;creates an Amazon EC2 development environment in AWS Cloud9</li> 
<p><strong>AWS CodeBuild</strong></p> 
<li>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-codebuild-project.html">AWS::CodeBuild::Project</a>, a <em>BadgeEnabled</em> property was added to generate a publicly accessible URL for a project’s build badge; a <em>Cache</em> property was added to configure cache settings for build dependencies; a <em>VpcConfig</em> property was added to enable AWS CodeBuild to access resources in an Amazon VPC; a <em>Type</em> property was added in the EnvironmentVariable property type to specify the type of environment variable</li> 
<p><strong>AWS CodeDeploy</strong></p> 
<li>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-codedeploy-application.html">AWS::CodeDeploy::Application</a>, a <em>ComputePlatform</em> property was added to specify an AWS Lambda compute platform for AWS CodeDeploy to deploy an application to</li> 
<li>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-codedeploy-deploymentgroup.html">AWS::CodeDeploy::DeploymentGroup</a>, a <em>TargetGroupInfoList</em> property was added to the <em>LoadBalancerInfo</em> property type to specify information about a target group in Elastic Load Balancing to use in a deployment; a <em>DeploymentType</em> property was added to the <em>DeploymentStyle</em> property type to specify a blue/green deployment on a Lambda compute platform</li> 
<p><strong>Amazon CloudFront</strong></p> 
<li>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-cloudfront-distribution.html">AWS::CloudFront::Distribution</a>, a <em>Tags</em> property was added to specify an arbitrary set of tags (key-value pairs) to associate with an Amazon CloudFront distribution; <em>OriginKeepAliveTimeout</em> and <em>OriginReadTimeout</em> properties were added to the <em>CustomOriginConfig</em> property type to specify a custom keep-alive timeout and a custom origin read timeout respectively; an <em>IPV6Enabled</em> property was added to the <em>DistributionConfig</em> property type to specify whether Amazon CloudFront responds to IPv6 DNS requests an IPv6 address for your distribution</li> 
<li>Use the <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-cloudfront-cloudfrontoriginaccessidentity.html">AWS::CloudFront::CloudFrontOriginAccessIdentity</a> resource to specify the origin access identity to associate with the origin of an Amazon CloudFront distribution</li> 
<li>Use the <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-cloudfront-streamingdistribution.html">AWS::CloudFront::StreamingDistribution</a> resource to specify an Adobe Real-Time Messaging protocol (RTMP) streaming distribution for Amazon CloudFront</li> 
<p><strong>Amazon EC2</strong></p> 
<li>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ec2-security-group.html">AWS::EC2::SecurityGroup</a>, <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ec2-security-group-egress.html">AWS::EC2::SecurityGroupEgress</a> and <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ec2-security-group-ingress.html">AWS::EC2::SecurityGroupIngress</a> resources, a <em>Description</em> property was added to specify the description of security group rules</li> 
<li>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ec2-subnet.html">AWS::EC2::Subnet</a>, an <em>Ipv6CidrBlock</em> property now supports <em>No Interruption</em> updates</li> 
<li>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ec2-vpn-gateway.html">AWS::EC2::VPNGateway</a>, an <em>AmazonSideAsn</em> property was added to specify a private Autonomous System Number (ASN) for the Amazon side of a Border Gateway Protocol (BGP) session</li> 
<li>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ec2-vpn-connection.html">AWS::EC2::VPNConnection</a>, a <em>VpnTunnelOptionsSpecifications</em> property was added to configure tunnel options for a VPN connection</li> 
<li>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ec2-spotfleet.html">AWS::EC2::SpotFleet</a>, the <em>SpotPrice</em> property in <em>SpotFleetRequestConfigData</em> property type is now optional</li> 
<p><strong>Amazon Elastic Container Registry</strong></p> 
<li>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ecr-repository.html">AWS::ECR::Repository</a>, a <em>LifecyclePolicy</em> property was added to specify a lifecycle policy for an Amazon ECR repository</li> 
<p><strong>Amazon Elastic Container Service</strong></p> 
<li>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-taskdefinition.html">AWS::ECS::TaskDefinition</a>, a <em>LinuxParameters</em> property was added to the <em>ContainerDefinition</em> property type to specify Linux-specific options for an Amazon ECS container; a <em>Cpu</em> property was added to specify the number of CPU units needed for the task; an <em>ExecutionRoleArn</em> property was added to specify the Amazon Resource Name (ARN) of the execution role; Memory property was added to specify the amount of memory in MiB needed for the task; and a <em>RequiresCompatibilities</em> property was added to specify the launch type the task requires</li> 
<li>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-service.html">AWS::ECS::Service</a>, a <em>LaunchType</em> property was added to specify the launch type on which to run the service; a <em>NetworkConfiguration</em> property was added to specify the network configuration for the service; a <em>PlatformVersion</em> property was added to specify the platform version on which to run your service</li> 
<p><strong>AWS Elastic Beanstalk</strong></p> 
<li>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-beanstalk-configurationtemplate.html">AWS::ElasticBeanstalk::ConfiguraionTemplate</a>, and <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-beanstalk-environment.html">AWS::ElasticBeanstalk::Environment</a>, a <em>ResourceName</em> property was added to the <em>ConfigurationOptionSetting</em> and <em>OptionSetting</em> property types, to specify a resource name for a time-based scaling configuration option</li> 
<p><strong>Amazon ElastiCache</strong></p> 
<li>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-elasticache-replicationgroup.html">AWS::ElastiCache::ReplicationGroup</a>, an <em>AtRestEncryptionEnabled</em> property was added to enable encryption at rest; an <em>AuthToken</em> property was added to specify a password that is used to access a password-protected server; and a <em>TransitEncryptionEnabled</em> property was added to enable in-transit encryption</li> 
<p><strong>Elastic Load Balancing</strong></p> 
<li>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-elasticloadbalancingv2-targetgroup.html">AWS::ElasticLoadBalancingV2::TargetGroup</a>, use the <em>TargetGroupName</em> attribute with the <em>Fn::GetAtt</em> function to get the name of an Elastic Load Balancing target group</li> 
<p><strong>Amazon ElasticSearch Service</strong></p> 
<li>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-elasticsearch-domain.html">AWS::Elasticsearch::Domain</a>, a <em>VPCOptions</em> property was added to specify a VPC configuration for the domain</li> 
<p><strong>Amazon EMR</strong></p> 
<li>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-emr-cluster.html">AWS::EMR::Cluster</a>, a <em>CustomAmiId</em> property was added to specify a custom Amazon Linux AMI for a cluster; an&nbsp;<em>EbsRootVolumeSize</em> property was added to specify the size of the EBS root volume for an Amazon EMR cluster</li> 
<p><strong>Amazon Kinesis</strong></p> 
<li>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-kinesisanalytics-application.html">AWS::KinesisAnalytics::Application</a>, an <em>InputProcessingConfiguration</em> property was added to the Input property type to transform records as they are received from the stream</li> 
<li>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-kinesisfirehose-deliverystream.html">AWS::KinesisFirehose::DeliveryStream</a>, use the <em>Arn</em> attribute with the <em>Fn:GetAtt</em> function to get the Amazon Resource Name (ARN) of the delivery stream</li> 
<p><strong>AWS Key Management Service</strong></p> 
<li>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-kms-key.html">AWS::KMS::Key</a>, a <em>Tags</em> property was added to specify an arbitrary set of tags (key-value pairs) to associate with a custom master key</li> 
<p><strong>AWS Lambda</strong></p> 
<li>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-lambda-alias.html">AWS::Lambda::Alias</a>, use the <em>CodeDeployLambdaAliasUpdate</em> update policy to perform an AWS CodeDeploy deployment when the version changes on a resource; you can also use the <em>RoutingConfig</em> property to specify two different versions of an AWS Lambda function, allowing you to dictate what percentage of traffic will invoke each version</li> 
<p><strong>AWS OpsWorks</strong></p> 
<li>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-opsworks-layer.html">AWS::Opsworks::Layer</a> and <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-opsworks-stack.html">AWS::OpsWorks::Stack</a>, a <em>Tags</em> property was added to specify an arbitrary set of tags (key-value pairs) to associate with either a layer or stack</li> 
<p><strong>Amazon RDS</strong></p> 
<li>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-rds-optiongroup.html">AWS::RDS::OptionGroup</a>, an <em>OptionVersion</em> property was added to the <em>OptionConfiguration</em> property type to specify a version for the option</li> 
<li>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-rds-database-instance.html">AWS::RDS::DBInstance</a>, <em>SourceRegion</em> and <em>KmsKeyId</em> properties were added to create an encrypted read replica from a cross-region source database instance</li> 
<p><strong>Amazon Route53</strong></p> 
<li>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-route53-hostedzone.html">AWS::Route53::HostedZone</a>, a <em>QueryLoggingConfig</em> property was added to specify a configuration for DNS query logging</li> 
<p><strong>Amazon S3</strong></p> 
<li>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-s3-bucket.html">AWS::S3::Bucket</a>, an <em>AnalyticsConfigurations</em> property was added to configure an analysis filter for an Amazon S3 bucket</li> 
<p><strong>AWS Systems Manager</strong></p> 
<li>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ssm-parameter.html">AWS::SSM::Parameter</a>, an <em>AllowedPattern</em> property was added to specify a regular expression used to validate the parameter value</li> 
<p><strong>AWS Step Functions</strong></p> 
<li>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-stepfunctions-statemachine.html">AWS::StepFunctions::StateMachine</a>, you can specify a <em>StateMachineName</em> when creating a state machine, and both <em>DefinitionString</em> and <em>RoleArn</em> can be updated without replacing the state machine.</li> 
<p>&nbsp;</p> 
<p>Visit the <a href="https://aws.amazon.com/cloudformation/">CloudFormation</a> details page and <a href="https://aws.amazon.com/documentation/cloudformation/">CloudFormation documentation</a> for more information, as well as the full list of <a href="http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-supported-resources.html">supported resources</a>.</p> 
<h3>About the Author</h3> 
<table style="height: 250px" width="1107" cellpadding="8"> 
<tbody> 
<tr> 
<td width="63">&nbsp;<img width="100%" src="https://d2908q01vomqb2.cloudfront.net/972a67c48192728a34979d9a35164c1295401b71/2017/10/17/PhoneTool1.jpg" /></td> 
<td width="391"> <p><strong>Luis Colon is a Senior Developer Advocate for the AWS CloudFormation team.</strong>&nbsp;He works with customers and internal development teams to focus on and improve the developer experience for CloudFormation users. In his spare time, he mixes progressive trance music.</p> <p>&nbsp;</p></td> 
</tr> 
</tbody> 
</table> 
<p>&nbsp;</p> 
</article> 
<article class="blog-post" vocab="http://schema.org/" typeof="TechArticle"> 
<meta property="inLanguage" content="en-US" /> 
<b class="lb-b blog-post-title" property="name headline">Password Rotation for Windows on Amazon EC2 Made Easy with EC2Rescue</b> 
<footer class="blog-post-meta" data-lb-comp="aws-blog:share-dialog">
by 
<span property="author" typeof="Person"><span property="name">Alessandro Martini</span></span> | on 
<time property="datePublished" datetime="2018-01-26T17:41:05+00:00">26 JAN 2018</time> | in 
<span class="blog-post-categories"><a href="https://aws.amazon.com/blogs/mt/category/management-tools/amazon-ec2-systems-manager/" title="View all posts in Amazon EC2 Systems Manager*"><span property="articleSection">Amazon EC2 Systems Manager*</span></a>, <a href="https://aws.amazon.com/blogs/mt/category/compute/" title="View all posts in Compute*"><span property="articleSection">Compute*</span></a>, <a href="https://aws.amazon.com/blogs/mt/category/management-tools/" title="View all posts in Management Tools*"><span property="articleSection">Management Tools*</span></a></span> | 
<a href="https://aws.amazon.com/blogs/mt/password-rotation-for-windows-on-amazon-ec2-made-easy-with-ec2rescue/" property="url">Permalink</a> | 
<a href="#" role="button" data-share-dialog-toggle=""><span class="span icon-share"></span>&nbsp;Share</a> 
</footer> 
<p><a href="https://docs.aws.amazon.com/AWSEC2/latest/WindowsGuide/Windows-Server-EC2Rescue.html">EC2Rescue for Windows</a> is an easy-to-use tool that you run on an <a href="https://aws.amazon.com/ec2">Amazon EC2</a> Windows Server instance to diagnose and troubleshoot possible problems. A common use of the tool is to <a href="https://aws.amazon.com/premiumsupport/knowledge-center/reset-admin-password/">reset the local administrator password</a>.</p> 
<p>Password rotation is an important security task in any organization. In addition, setting strong passwords is necessary to ensure that the password doesn’t get hacked by brute force or dictionary attacks.&nbsp;However, these tasks become very challenging to perform manually, particularly when you are dealing with more than a few servers.</p> 
<p><a href="https://aws.amazon.com/systems-manager">AWS Systems Manager</a> allows you to manage your fleet remotely, and to run commands at scale using Run Command.&nbsp;The Systems Manager Parameter Store feature is integrated with AWS Key Management Service (<a href="https://aws.amazon.com/kms">AWS KMS</a>). Parameter Store allows for string values to be stored encrypted, with granular access controlled by AWS Identity and Access Management (<a href="https://aws.amazon.com/iam">IAM</a>) policies.</p> 
<p>In this post, I show you how to rotate the local administrator password for your Windows instances using EC2Rescue, and store the rotated password in Parameter Store. By using Systems Manager Maintenance Window, you can then schedule this activity to occur automatically at a frequency of your choosing.</p> 
<p><span id="more-2155"></span></p> 
<b><strong>Overview</strong></b> 
<p>EC2Rescue is available as a Run Command document called <a href="https://docs.aws.amazon.com/AWSEC2/latest/WindowsGuide/ec2rw-ssm.html">AWSSupport-RunEC2RescueForWindowsTool</a>. The option to reset the local administrator password allows you to specify which KMS key to use to encrypt the randomly generated password.<br /> If your EC2 Windows instances are already enabled with Systems Manager, then the password reset via EC2Rescue Run Command happens online, with no downtime. You can then configure a Systems Manager maintenance window to run AWSSupport-RunEC2RescueForWindowsTool on a schedule (make sure your EC2 instances are running during the maintenance window!).</p> 
<b><strong>Workflow</strong></b> 
<p>In this post, I provide step-by-step instructions to configure this solution manually. For those of you who want to see the solution in action with minimal effort, I have created a CloudFormation template that configures everything for you, in the us-west-2 (Oregon) region.</p> 
<p><a href="https://us-west-2.console.aws.amazon.com/cloudformation/home?region=us-west-2#/stacks/create/review?filter=active&amp;templateURL=https:%2F%2Fs3.amazonaws.com%2Fec2rescue%2Fsolutions%2FAWS-ResetWindowsPasswordOnASchedule.template&amp;stackName=ResetWindowsPasswordOnASchedule"><img width="100%" src="https://d2908q01vomqb2.cloudfront.net/972a67c48192728a34979d9a35164c1295401b71/2018/01/24/cloudformation-launch-stack-button.png" /></a></p> 
<p>&nbsp;</p> 
<p>Keep reading to learn what is being configured, or jump to the <strong>Deploy the solution</strong> section for a description of the template parameters.</p> 
<h3><strong>Define a KMS key</strong></h3> 
<p>First, you create a KMS key specifically to encrypt Windows passwords. This gives you control over which users and roles can encrypt these passwords, and who can then decrypt them. I recommend that you create a new KMS key dedicated to this task to better manage access.</p> 
<h4><strong>Create a JSON file for the Key policy</strong></h4> 
<p>In a text editor of your choosing, copy and paste the following policy. Replace <span style="color: #ff0000"><strong>ACCOUNTID</strong></span> with your AWS Account ID.&nbsp;<strong>Administrators</strong>&nbsp;is the IAM role name that you want to allow to&nbsp;decrypt the rotated passwords, and&nbsp;<strong>EC2SSMRole&nbsp;</strong>is the IAM role name attached to your EC2 instances. Save the file as&nbsp;<em>RegionalPasswordEncryptionKey-Policy.json</em>.</p> 
{
&quot;Version&quot;: &quot;2012-10-17&quot;,
&quot;Id&quot;: &quot;key-policy&quot;,
&quot;Statement&quot;: [
{
&quot;Sid&quot;: &quot;Allow access for Key Administrators&quot;,
&quot;Effect&quot;: &quot;Allow&quot;,
&quot;Principal&quot;: {
&quot;AWS&quot;: &quot;arn:aws:iam::<span style="color: #ff0000"><strong>ACCOUNTID</strong></span>:role/<strong>Administrators</strong>&quot;
},
&quot;Action&quot;: [
&quot;kms:Create*&quot;,
&quot;kms:Describe*&quot;,
&quot;kms:Enable*&quot;,
&quot;kms:List*&quot;,
&quot;kms:Put*&quot;,
&quot;kms:Update*&quot;,
&quot;kms:Revoke*&quot;,
&quot;kms:Disable*&quot;,
&quot;kms:Get*&quot;,
&quot;kms:Delete*&quot;,
&quot;kms:ScheduleKeyDeletion&quot;,
&quot;kms:CancelKeyDeletion&quot;
],
&quot;Resource&quot;: &quot;*&quot;
},
{
&quot;Sid&quot;: &quot;Allow decryption&quot;,
&quot;Effect&quot;: &quot;Allow&quot;,
&quot;Principal&quot;: {
&quot;AWS&quot;: &quot;arn:aws:iam::<span style="color: #ff0000"><strong>ACCOUNTID</strong></span>:role/<strong>Administrators</strong>&quot;
},
&quot;Action&quot;: &quot;kms:Decrypt&quot;,
&quot;Resource&quot;: &quot;*&quot;
},
{
&quot;Sid&quot;: &quot;Allow encryption&quot;,
&quot;Effect&quot;: &quot;Allow&quot;,
&quot;Principal&quot;: {
&quot;AWS&quot;: &quot;arn:aws:iam::<span style="color: #ff0000"><strong>ACCOUNTID</strong></span>:role/<strong>EC2SSMRole</strong>&quot;
},
&quot;Action&quot;: &quot;kms:Encrypt&quot;,
&quot;Resource&quot;: &quot;*&quot;
}
]
}
 
<p><strong>Create the key and its alias (user-friendly name)</strong><br /> Use the following CLI command to create a KMS key that the IAM role <strong>Administrators</strong> can manage, and that the IAM role <strong>EC2SSMRole</strong> can use for encryption only:</p> 
aws kms create-key \
–-policy file://RegionalPasswordEncryptionKey-Policy.json \
--description &quot;Key used to encrypt local Administrator passwords stored in SSM Parameter Store.&quot;
Output:
{
&quot;KeyMetadata&quot;:
{
&quot;Origin&quot;: &quot;AWS_KMS&quot;,
&quot;KeyId&quot;: &quot;<strong>88eea0b7-0508-4318-a0bc-feee4a5250a3</strong>&quot;,
&quot;Description&quot;: &quot;Key used to encrypt local Administrator passwords stored in SSM Parameter Store.&quot;,
(...)
}
}
 
<p>Use the following CLI command to create an alias for the KMS key:</p> 
aws kms create-alias \
--alias-name alias/WindowsPasswordRotation-EncryptionKey \
--target-key-id <strong>88eea0b7-0508-4318-a0bc-feee4a5250a3
</strong> 
<h3><strong>Define a maintenance window</strong></h3> 
<p>Use a maintenance window to schedule the password reset. Here is the CLI command to schedule such activity every Sunday at 5AM UTC:</p> 
aws ssm create-maintenance-window \
--name &quot;windows-password-rotation&quot; \
--schedule &quot;cron(0 5 ? * SUN *)&quot; \
--duration 2 \
--cutoff 1 \
--no-allow-unassociated-targets
Output:
{ &quot;WindowId&quot;: &quot;<strong>mw-0f2c58266a8c49246</strong>&quot; }
 
<h3><strong>Define a target</strong></h3> 
<p>Use tags to identify which instances to reset the password. For example, you can reset all instances tagged with tag key <strong>Environment</strong> with value <strong>Production</strong>.</p> 
aws ssm register-target-with-maintenance-window \
--window-id &quot;<strong>mw-0f2c58266a8c49246</strong>&quot; \
--targets &quot;Key=tag:<strong>Environment</strong>,Values=<strong>Production</strong>&quot; \
--owner-information &quot;Production Servers&quot; \
--resource-type &quot;INSTANCE&quot;
Output:
{
&quot;WindowTargetId&quot;: &quot;<strong>a5fc445b-a7f1-4591-b528-98440832da41</strong>&quot;
}
 
<h3><strong>Define a maintenance window IAM role</strong></h3> 
<p>These steps are only necessary if you haven’t configured a maintenance window before. Skip this section if you already have your IAM role with the AmazonSSMMaintenanceWindowRole AWS Managed Policy attached.</p> 
<h4><strong>Create a JSON file for the role trust policy</strong></h4> 
<p>In a text editor of your choosing, copy and paste the following trust policy. Save the file as <em>AutomationMWRole-Trust-Policy.json</em>.</p> 
{
&quot;Version&quot;: &quot;2012-10-17&quot;,
&quot;Statement&quot;: [
{
&quot;Effect&quot;: &quot;Allow&quot;,
&quot;Principal&quot;: {
&quot;Service&quot;: &quot;ssm.amazonaws.com&quot;
},
&quot;Action&quot;: &quot;sts:AssumeRole&quot;
}
]
}
 
<h4><strong>Create the IAM role and attach the Amazon managed policy for SSM maintenance window</strong></h4> 
<p>Use the following CLI two commands to create the IAM role&nbsp;<strong>AutomationMWRole&nbsp;</strong>and associate the&nbsp;AmazonSSMMaintenanceWindowRole&nbsp;AWS Managed Policy<strong>.</strong></p> 
aws iam create-role \
--role-name <strong>AutomationMWRole</strong> \
--assume-role-policy-document file://AutomationMWRole-Trust-Policy.json
aws iam attach-role-policy \
--policy-arn arn:aws:iam::aws:policy/service-role/AmazonSSMMaintenanceWindowRole \
--role-name AutomationMWRole
 
<h3><strong>Define a task</strong></h3> 
<p>EC2Rescue is available as a Run Command document called <a href="https://docs.aws.amazon.com/AWSEC2/latest/WindowsGuide/ec2rw-ssm.html">AWSSupport-RunEC2RescueForWindowsTool</a>. This document allows you to run EC2Rescue remotely on your instances. One of the available options is the ability to reset the local administrator password. As the final configuration step, create a Run Command task that runs AWSSupport-RunEC2RescueForWindowsTool with the following parameters:</p> 
<li>Command = ResetAccess</li> 
<li>Parameters = KMS Key ID</li> 
<p>Rotated passwords are saved in Parameter Store encrypted with the KMS key to use. Here is the CLI command using the KMS key, target, maintenance window and role that you previously generated:</p> 
aws ssm register-task-with-maintenance-window \
--targets &quot;Key=WindowTargetIds,Values=<strong>a5fc445b-a7f1-4591-b528-98440832da41</strong>&quot; \
--task-arn &quot;AWSSupport-RunEC2RescueForWindowsTool&quot; \
--service-role-arn &quot;arn:aws:iam::<span style="color: #ff0000"><strong>ACCOUNTID</strong></span>:role/AutomationMWRole&quot; \
--window-id &quot;<strong>mw-0f2c58266a8c49246</strong>&quot; \
--task-type &quot;RUN_COMMAND&quot; \
--task-parameters&nbsp; &quot;{\&quot;Command\&quot;:{ \&quot;Values\&quot;: [\&quot;ResetAccess\&quot;] }, \&quot;Parameters\&quot;:{ \&quot;Values\&quot;: [\&quot;<strong>88eea0b7-0508-4318-a0bc-feee4a5250a3</strong>\&quot;] } }&quot; \
--max-concurrency 5 \
--max-errors 1 \
--priority 1
Output:
{
&quot;WindowTaskId&quot;: &quot;<strong>a3571731-c64c-4e43-be8d-7b543942a179</strong>&quot;
}
 
<p>Your Windows instances need to be enabled for Systems Manager, and to have additional IAM permissions to be able to write to Parameter Store. You can accomplish this by adding the following policy to the existing IAM roles associated with your Windows instances:</p> 
{
&quot;Version&quot;: &quot;2012-10-17&quot;,
&quot;Statement&quot;: [
{
&quot;Effect&quot;: &quot;Allow&quot;,
&quot;Action&quot;: [
&quot;ssm:PutParameter&quot;
],
&quot;Resource&quot;: [
&quot;arn:aws:ssm:*:<span style="color: #ff0000"><strong>ACCOUNTID</strong></span>:parameter/EC2Rescue/Passwords/*&quot;
]
}
]
}
 
<p>Save the policy as&nbsp;<em>EC2Rescue-ResetAccess-Policy.json</em>. Here are the CLI commands to create a new IAM customer managed policy and attach it to an existing Systems Manager IAM role for EC2 (in this example, <strong>EC2SSMRole</strong>).</p> 
aws iam create-policy \
--policy-name EC2Rescue-ResetAccess-Policy \
--policy-document file://EC2Rescue-ResetAccess-Policy.json
aws iam attach-role-policy \
--policy-arn arn:aws:iam::<span style="color: #ff0000"><strong>ACCOUNTID</strong></span>:policy/EC2Rescue-ResetAccess-Policy \
--role-name <strong>EC2SSMRole
</strong> 
<b><strong>Deploy the solution</strong></b> 
<p>To simplify the deployment of this solution, I have created an AWS CloudFormation template that configures all the parts described earlier in this post, and deploys this solution in us-west-2 (Oregon).</p> 
<p><a href="https://us-west-2.console.aws.amazon.com/cloudformation/home?region=us-west-2#/stacks/create/review?filter=active&amp;templateURL=https:%2F%2Fs3.amazonaws.com%2Fec2rescue%2Fsolutions%2FAWS-ResetWindowsPasswordOnASchedule.template&amp;stackName=ResetWindowsPasswordOnASchedule"><img width="100%" src="https://d2908q01vomqb2.cloudfront.net/972a67c48192728a34979d9a35164c1295401b71/2018/01/24/cloudformation-launch-stack-button.png" /></a></p> 
<p>&nbsp;</p> 
<p>These are the parameters that the template requires:</p> 
<li><strong>Target</strong> 
<li>Tag key to filter your instances</li> 
<li>Tag value to filter your instances</li> 
<li>Cron expression for the maintenance window</li> 
</ul> </li> 
<li><strong>Permissions</strong> 
<li>Existing IAM role name you are using for your Systems Manager-enabled EC2 instances, which will be authorized to encrypt the passwords.</li> 
</ul> </li> 
<li><strong>Security</strong> 
<li>Current IAM role name that you are using to deploy this CloudFormation template. The role is authorized to decrypt the passwords and manage the KMS key.</li> 
</ul> </li> 
<p>The following figure shows the CloudFormation console, with the default template parameters and the existing EC2 IAM role named <strong>EC2SSMRole</strong>, as well as the administrative IAM role <strong>Administrators</strong>, which you use to create the CloudFormation stack.</p> 
<p><img width="100%" src="https://d2908q01vomqb2.cloudfront.net/972a67c48192728a34979d9a35164c1295401b71/2018/01/24/cfn-parameters.png" /></p> 
<p>The deployment takes few minutes. Here is a sample maintenance window, which was last executed on October 29th 2017.</p> 
<p><img width="100%" src="https://d2908q01vomqb2.cloudfront.net/972a67c48192728a34979d9a35164c1295401b71/2018/01/24/mw.png" /></p> 
<p>Parameter Store has an encrypted parameter for each production Windows instance. You can decrypt each value from the console if you have kms:decrypt permissions on the key used to encrypt the password.</p> 
<p><img width="100%" src="https://d2908q01vomqb2.cloudfront.net/972a67c48192728a34979d9a35164c1295401b71/2018/01/24/ps.png" /></p> 
<b><strong>Conclusion</strong></b> 
<p>In this post, I showed you how to enhance the security of an EC2 environment by automating secure password rotation. Passwords are rotated on a schedule, and these actions are logged in AWS CloudTrail. Passwords are stored in Parameter Store with a KMS key, so that you have granular control over who has access to the encrypted passwords with IAM policies.<br /> As long as your EC2 Windows instances are running during the maintenance window and are configured to work with Systems Manager, the local administrator password is rotated automatically. Additional maintenance windows can be created for other environments, or new targets added to the existing maintenance window (such as development, staging, or QA environments).</p> 
<p><strong>About the Author</strong><br /> <img width="100%" src="https://d2908q01vomqb2.cloudfront.net/972a67c48192728a34979d9a35164c1295401b71/2017/10/02/AMartini.jpg" />Alessandro Martini is a Senior Cloud Support Engineer in the AWS Support organization. He likes working with customers, understanding and solving problems, and writing blog posts that outline solutions on multiple AWS products. He also loves pizza, especially when there is no pineapple on it.</p> 
</article> 
<article class="blog-post" vocab="http://schema.org/" typeof="TechArticle"> 
<meta property="inLanguage" content="en-US" /> 
<meta property="image" content="https://d2908q01vomqb2.cloudfront.net/972a67c48192728a34979d9a35164c1295401b71/2018/01/02/Screen-Shot-2018-01-02-at-1.27.34-PM-1243x630.png" /> 
<b class="lb-b blog-post-title" property="name headline">Control AWS resources available to your users using AWS Service Catalog</b> 
<footer class="blog-post-meta" data-lb-comp="aws-blog:share-dialog">
by 
<span property="author" typeof="Person"><span property="name">Kanchan Waikar</span></span> | on 
<time property="datePublished" datetime="2018-01-12T09:32:08+00:00">12 JAN 2018</time> | in 
<span class="blog-post-categories"><a href="https://aws.amazon.com/blogs/mt/category/management-tools/aws-service-catalog/" title="View all posts in AWS Service Catalog*"><span property="articleSection">AWS Service Catalog*</span></a>, <a href="https://aws.amazon.com/blogs/mt/category/management-tools/" title="View all posts in Management Tools*"><span property="articleSection">Management Tools*</span></a></span> | 
<a href="https://aws.amazon.com/blogs/mt/control-aws-resources-available-to-your-users-using-aws-service-catalog/" property="url">Permalink</a> | 
<a href="#" role="button" data-share-dialog-toggle=""><span class="span icon-share"></span>&nbsp;Share</a> 
</footer> 
<p>The <a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege" target="_blank" rel="noopener noreferrer">grant least privilege</a> best practice advises you to grant only the permissions that are required to perform a task. To follow this best practice you should determine what your users need to do and then design <a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies.html" target="_blank" rel="noopener noreferrer">IAM policies</a> that let users perform&nbsp;only&nbsp;those tasks. <a href="https://aws.amazon.com/servicecatalog/" target="_blank" rel="noopener noreferrer">AWS Service Catalog</a> extends the very same best practice. If you are an administrator, it lets you specify the AWS CloudFormation template that your users can launch, while restricting the permissions required to create individual services. If you are an end user of the AWS Service Catalog, you don’t need to worry whether you have enough permissions to launch the stack or whether you are following your organization’s tagging strategy correctly.</p> 
<p>In the first part of this two-part series of blog posts, I explain how you can manage the AWS resources your users can create using AWS Service Catalog. In the <a href="https://aws.amazon.com/blogs/mt/using-aws-lambda-to-decommission-products-provisioned-from-an-aws-service-catalog-portfolio/" target="_blank" rel="noopener noreferrer">second blog post</a>, I show how you can use AWS Lambda to decommission all of the resources that have been provisioned from an AWS Service Catalog portfolio.</p> 
<p><span id="more-2373"></span></p> 
<p>Before I get into how it works, let’s first review a few key AWS Service Catalog concepts:</p> 
<li>A <strong><a href="http://docs.aws.amazon.com/servicecatalog/latest/adminguide/what-is_concepts.html#what-is_concepts-product" target="_blank" rel="noopener noreferrer">product</a></strong> is an IT service that you want to make available for deployment on AWS. You create a product by importing a <a href="http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-whatis-concepts.html#w2ab2b5c15b7" target="_blank" rel="noopener noreferrer">CloudFormation template</a>.</li> 
<li>A&nbsp;<strong><a href="http://docs.aws.amazon.com/servicecatalog/latest/adminguide/what-is_concepts.html#what-is_concepts-provprod" target="_blank" rel="noopener noreferrer">provisioned product</a></strong>&nbsp;is a <a href="http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stacks.html" target="_blank" rel="noopener noreferrer">CloudFormation stack</a>. When an <a href="http://docs.aws.amazon.com/servicecatalog/latest/adminguide/what-is_concepts.html#what-is_concepts-users" target="_blank" rel="noopener noreferrer">end user</a> launches a product, the AWS Service Catalog provisions the product in form of a CloudFormation stack.</li> 
<li>A&nbsp;<strong><a href="http://docs.aws.amazon.com/servicecatalog/latest/adminguide/what-is_concepts.html#what-is_concepts-portfolio" target="_blank" rel="noopener noreferrer">portfolio</a></strong>&nbsp;is a collection of&nbsp;<strong>products</strong>, together with the configuration information. You can use portfolios to manage the user access to specific products.</li> 
<li><strong><a href="http://docs.aws.amazon.com/servicecatalog/latest/adminguide/what-is_concepts.html#what-is_concepts-constraints" target="_blank" rel="noopener noreferrer">Constraints</a>&nbsp;</strong>control the way users can deploy a product. With <strong>launch constraints</strong>, you can specify a role that the AWS Service Catalog can assume to launch a product from the portfolio.</li> 
<p>Now I’ll walk you through a use case to show you how you can control the AWS resources your users can create. In this use case, you want to conduct a training of a web-based product, say WordPress, using your training AWS account. (WordPress is an open-source blogging tool and content management system (CMS) based on PHP and MySQL.) On the day of the training, attendees sign into your training AWS account using <a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/introduction_identity-management.html#intro-identity-users" target="_blank" rel="noopener noreferrer">IAM user</a> credentials that you created, and create their own AWS CloudFormation stack using a WordPress CloudFormation template. The stack outputs a WordPress endpoint that they use during the training. Here are two of the many things that could go wrong due to a single malicious attendee:</p> 
<li>The user might tweak the CloudFormation template to do unauthorized actions like: 
<li>Launching a high-end EC2 instance.</li> 
<li>Launching an EC2 instance with a wide-open security group.</li> 
<li>Something else!</li> 
</ul> </li> 
<li>The user might never tag any of the resources they created leaving you a number of unknown resources to manually discover and clean-up after the training.</li> 
<p>A simple solution to mitigate these problems is not to give CloudFormation template creation access to the IAM users. Instead, you will use AWS Service Catalog to manage the resource provisioning.</p> 
<b>Solution</b> 
<p>Here are the steps you need to go through to let attendees launch a stack using your predefined CloudFormation template:</p> 
<ol> 
<li>First, <a href="http://docs.aws.amazon.com/servicecatalog/latest/adminguide/getstarted-portfolio.html" target="_blank" rel="noopener noreferrer">create a portfolio</a>.</li> 
<li>Then, upload WordPress product to the portfolio created. The product contains the WordPress CloudFormation template and configuration information.</li> 
<li>Next, create an AWS Service Catalog IAM role (role) and associate it with the WordPress product, as a launch constraint. Later, when users provision the product, AWS Service Catalog will assume the role created.</li> 
<li>Next, <a href="http://docs.aws.amazon.com/servicecatalog/latest/adminguide/getstarted-iamenduser.html" target="_blank" rel="noopener noreferrer">grant the training attendees access</a> to the portfolio that you created.</li> 
<li>Then verify whether training users can provision the product. During the training, users can use the AWS Service Catalog to provision the WordPress product.</li> 
<li>After the training is over, you terminate all provisioned products from the portfolio.</li> 
</ol> 
<p>The following solution diagram illustrates how you can set up a training using AWS Service Catalog.</p> 
<p><img width="100%" src="https://d2908q01vomqb2.cloudfront.net/972a67c48192728a34979d9a35164c1295401b71/2018/01/02/Screen-Shot-2018-01-02-at-1.27.34-PM.png" /><br /> 
<!--more--></p> 
<p><strong>Note</strong></p> 
<p>Before you begin, you need to do the following:</p> 
<ol> 
<li>Create an IAM user group for the training attendees. To do so, <a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/id_users_create.html" target="_blank" rel="noopener noreferrer">create one or more IAM users</a> (for distributing to training attendees) in your AWS account and assign no permissions to them. Next, <a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/id_groups_create.html" target="_blank" rel="noopener noreferrer">create an IAM User Group</a> with a group name as <code>Training-Users</code> and then <a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/id_groups_manage_add-remove-users.html" target="_blank" rel="noopener noreferrer">add IAM users</a> created to the <code>Training-Users</code> group.</li> 
<li>Verify that <a href="https://aws.amazon.com/about-aws/global-infrastructure/regional-product-services/" target="_blank" rel="noopener noreferrer">AWS Service Catalog is supported in the AWS Region</a>.</li> 
<li>Verify that you have: 
<li><a href="http://docs.aws.amazon.com/servicecatalog/latest/adminguide/getstarted-iamadmin.html" target="_blank" rel="noopener noreferrer">AWS Service Catalog Administrator access</a>.</li> 
<li>IAM Permissions to create a new IAM role.</li> 
</ul> </li> 
</ol> 
<p>Then, you need to create an AWS Service Catalog portfolio. You will use the portfolio to provide training attendees an access to the WordPress product.</p> 
<h3>Step 1. Create a portfolio</h3> 
<p>For this use case, you can create a single portfolio with a Training Portfolio name. You will later grant training attendees access to this portfolio. To create a portfolio:</p> 
<ol> 
<li>Sign in to the AWS Management Console and then open&nbsp;<a href="https://console.aws.amazon.com/servicecatalog/" target="_blank" rel="noopener noreferrer">https://console.aws.amazon.com/servicecatalog/</a>.</li> 
<li>If you are using the AWS Service Catalog administrator console for the first time, choose&nbsp;<strong>Get started</strong>&nbsp;to start the wizard for configuring a portfolio. Otherwise, choose&nbsp;<strong>Create </strong>portfolio.</li> 
<li>Enter the following values: 
<ol> 
<li><strong>Portfolio name&nbsp;</strong>–&nbsp;<code>Training Portfolio</code></li> 
<li><strong>Description</strong>&nbsp;–&nbsp;<code>Portfolio for conducting a WordPress training.</code></li> 
<li><strong>Owner</strong>&nbsp;–&nbsp;<code>Training Team</code></li> 
</ol> </li> 
<li>Choose&nbsp;<strong>Create</strong>.</li> 
</ol> 
<p>Next, associate the <code>Portfolio-Name</code> <a href="http://docs.aws.amazon.com/servicecatalog/latest/adminguide/tagoptions-using.html" target="_blank" rel="noopener noreferrer">tagOption</a> with the portfolio. This will cause AWS Service Catalog to attach <code>Portfolio-Name</code> tag to all resources created during provisioning of the product from the portfolio. If you are a first-time user, ensure that you have <a href="http://docs.aws.amazon.com/servicecatalog/latest/adminguide/tagoptions-migrate.html" target="_blank" rel="noopener noreferrer">migrated to the TagOption Library</a>. To associate a tag:</p> 
<ol> 
<li>Open&nbsp;<a href="https://console.aws.amazon.com/servicecatalog/" target="_blank" rel="noopener noreferrer">https://console.aws.amazon.com/servicecatalog/</a>.</li> 
<li>From the <strong>Service Catalog</strong> drop-down menu, choose&nbsp;<strong>TagOption library</strong>.</li> 
<li>Choose&nbsp;<strong>Create new TagOption</strong>.</li> 
<li>Specify <strong>key</strong> as <code>Portfolio-Name</code>, <strong>value</strong> as <code>Training Portfolio</code>, choose <strong>Save</strong>.</li> 
<li>From the <strong>Service Catalog</strong> drop-down menu, choose <strong>Portfolios list</strong>.</li> 
<li>Select <code>Training Portfolio</code>, expand <strong>TagOptions</strong>, choose <strong>Add TagOption</strong>.</li> 
<li>Select the entry with the <strong>key</strong> as <code>Portfolio-Name</code>, <strong>value</strong> as <code>Training Portfolio</code>, choose <strong>Save</strong>.</li> 
</ol> 
<p>Next, you need to upload the WordPress product to the portfolio created.</p> 
<h3>Step 2. Upload the WordPress product in the portfolio</h3> 
<p>In this step, you upload the CloudFormation Template you want your users to launch, in the form of a product. To upload a product:</p> 
<ol> 
<li>Open&nbsp;<a href="https://console.aws.amazon.com/servicecatalog/" target="_blank" rel="noopener noreferrer">https://console.aws.amazon.com/servicecatalog/</a>.</li> 
<li>Click on <code>Training Portfolio</code> to open the portfolio details page, and then choose&nbsp;<strong>Upload new product</strong>.</li> 
<li>On the&nbsp;<strong>Enter product details</strong>&nbsp;page, type the following and then choose&nbsp;<strong>Next</strong>: 
<li><strong>Product name</strong>&nbsp;–&nbsp;<code>WordPress</code></li> 
<li><strong>Description</strong>&nbsp;–&nbsp;<code>This product launches WordPress CloudFormation Stack.</code></li> 
<li><strong>Provided by</strong>&nbsp;–&nbsp;<code>Training Team</code></li> 
</ul> </li> 
<li>On the&nbsp;<strong>Enter support details</strong>&nbsp;page, choose&nbsp;<strong>Next</strong>.</li> 
<li>On the&nbsp;<strong>Version details</strong>&nbsp;page, choose&nbsp;<strong>Specify a URL location for an Amazon CloudFormation template</strong>, type&nbsp;<a href="https://s3-us-west-2.amazonaws.com/cloudformation-templates-us-west-2/WordPress_Single_Instance.template" target="_blank" rel="noopener noreferrer">https://s3-us-west-2.amazonaws.com/cloudformation-templates-us-west-2/WordPress_Single_Instance.template</a> in the text box. Specify: 
<li><strong>Version title</strong>&nbsp;–&nbsp;<code>v1.0</code></li> 
<li><strong>Description</strong>&nbsp;–&nbsp;<code>Base Version</code></li> 
</ul> </li> 
<li>Choose&nbsp;<strong>Next</strong>.</li> 
<li>On the&nbsp;<strong>Review</strong>&nbsp;page, choose&nbsp;<strong>Create</strong>.</li> 
</ol> 
<p>Next, you’ll create an IAM role that AWS Service Catalog can assume to allow training attendees to launch a product.</p> 
<h3>Step 3. Create a Service Catalog IAM role and associate it with the WordPress product as a launch constraint</h3> 
<p>Create a role that will have permissions to create a CloudFormation stack as well as to create all resources created by the WordPress CloudFormation template. To create the IAM role:</p> 
<ol> 
<li>Open the IAM console at&nbsp;<a href="https://console.aws.amazon.com/iam/" target="_blank" rel="noopener noreferrer">https://console.aws.amazon.com/iam/</a>.</li> 
<li>In the navigation pane, choose&nbsp;<strong>Policies</strong>. Choose&nbsp;<strong>Create policy</strong>&nbsp;and do the following: 
<ol> 
<li>Choose <strong>JSON</strong> Tab.</li> 
<li>Paste the following policy in the editor: <code class="lang-json">{
&quot;Version&quot;: &quot;2012-10-17&quot;,
&quot;Statement&quot;: [
{ 
&quot;Sid&quot;: &quot;LaunchWordPressRole&quot;,
&quot;Effect&quot;: &quot;Allow&quot;,
&quot;Action&quot;: [
&quot;ec2:AuthorizeSecurityGroupEgress&quot;,
&quot;ec2:AuthorizeSecurityGroupIngress&quot;,
&quot;ec2:DeleteSecurityGroup&quot;,
&quot;ec2:TerminateInstances&quot;, 
&quot;ec2:CreateSecurityGroup&quot;, 
&quot;ec2:RunInstances&quot;, 
&quot;ec2:createTags&quot;, 
&quot;catalog-user:*&quot;, 
&quot;cloudformation:CreateStack&quot;, 
&quot;cloudformation:DeleteStack&quot;, 
&quot;cloudformation:DescribeStackEvents&quot;, 
&quot;cloudformation:DescribeStacks&quot;, 
&quot;cloudformation:GetTemplateSummary&quot;, 
&quot;cloudformation:SetStackPolicy&quot;, 
&quot;cloudformation:ValidateTemplate&quot;, 
&quot;cloudformation:UpdateStack&quot;, 
&quot;ec2:describe*&quot;, 
&quot;ec2:get*&quot;, 
&quot;s3:GetObject&quot;, 
&quot;sns:*&quot;
], 
&quot;Resource&quot;: [ 
&quot;*&quot; 
] 
} 
] 
}</code> </li> 
<li>Choose&nbsp;<strong>Review Policy</strong>.</li> 
<li>Provide a name, such as <code>WordPressPolicy</code>, choose <strong>Create Policy</strong>.</li> 
</ol> </li> 
<li>In the navigation pane, choose&nbsp;<strong>Roles</strong>. Choose&nbsp;<strong>Create role</strong>&nbsp;and do the following: 
<ol> 
<li>Choose <strong>AWS service</strong>&nbsp;and then choose&nbsp;<strong>Service Catalog</strong>. Next, choose&nbsp;<strong>Next: Permissions</strong>.</li> 
<li>In Filter panel, type <code>WordPressPolicy</code>.</li> 
<li>Select the check box for the&nbsp;<code>WordPressPolicy</code> policy, and then choose&nbsp;<strong>Next: Review</strong>.</li> 
<li>For&nbsp;<strong>Role name</strong>, type&nbsp;<code>WordPressServiceCatalogLaunchRole</code>.</li> 
<li>Choose&nbsp;<strong>Create role</strong>.</li> 
<li>In the filter panel, type <code>WordPressServiceCatalogLaunchRole</code>.</li> 
<li>Click on the result with <code>WordPressServiceCatalogLaunchRole</code> as the role name.</li> 
<li>Note the <strong>Role ARN</strong> displayed on the summary page.</li> 
</ol> </li> 
</ol> 
<p>Next, you need to associate the IAM role with the product. This allows AWS Service Catalog to assume the role to launch the product. To associate the IAM role with the product:</p> 
<ol> 
<li>Open the AWS Service Catalog console at&nbsp;<a href="https://console.aws.amazon.com/servicecatalog/" target="_blank" rel="noopener noreferrer">https://console.aws.amazon.com/servicecatalog/</a>.</li> 
<li>Choose the <code>Training Portfolio.</code></li> 
<li>On the portfolio details page, expand the&nbsp;<strong>Constraints</strong>&nbsp;section, and then choose&nbsp;<strong>Add constraints</strong>.</li> 
<li>For&nbsp;Product, choose&nbsp;WordPress, and for&nbsp;<strong>Constraint type</strong>, choose&nbsp;<strong>Launch</strong>. Next, choose&nbsp;<strong>Continue</strong>.</li> 
<li>On the&nbsp;<strong>Launch constraint</strong>&nbsp;page, for&nbsp;Enter<strong> role </strong>arn, type the role ARN your noted earlier, and then choose&nbsp;<strong>Submit</strong>.</li> 
</ol> 
<p>Next, you need to allow the <code>Training-Users</code> IAM Group to provision a product.</p> 
<h3>Step 4. Grant the training attendees permission to provision a product from the portfolio</h3> 
<p>Since users will be using AWS Service Catalog to provision a CloudFormation Stack, all they need is access to the AWS Service Catalog and the <strong>Cloudformation:ListStackResources</strong> access. In this step, you give users access:</p> 
<ol> 
<li>Open the IAM console at&nbsp;<a href="https://console.aws.amazon.com/iam/" target="_blank" rel="noopener noreferrer">https://console.aws.amazon.com/iam/</a>.</li> 
<li>In the navigation pane, choose&nbsp;<strong>Groups</strong>.</li> 
<li>In the filter panel, type <code>Training-Users</code>, the search result will display a single result, Choose the result.</li> 
<li>In the summary page, choose <strong>permissions</strong> tab.</li> 
<li>Expand inline policies. Console will display a message stating there are no inline policies associated. Choose <strong>click here</strong>.</li> 
<li>Choose <strong>Custom Policy</strong>, then&nbsp;<strong>Select</strong>. 
<ol> 
<li>For&nbsp;<strong>Policy Name</strong>, type&nbsp;<code>SCProvisionProductAccess</code>.</li> 
<li>Paste the following example policy in&nbsp;<strong>Policy Document</strong>: <code class="lang-json">{ 
&quot;Version&quot;: &quot;2012-10-17&quot;, 
&quot;Statement&quot;: [ 
{ 
&quot;Effect&quot;: &quot;Allow&quot;, 
&quot;Action&quot;: [&quot;cloudformation:ListStackResources&quot;, &quot;servicecatalog:ProvisionProduct&quot;], 
&quot;Resource&quot;: &quot;*&quot; 
} 
] 
}</code> </li> 
</ol> </li> 
<li>Choose <strong>Apply Policy</strong>.</li> 
<li>On the <strong>Summary</strong> page, <strong>Permissions</strong> tab, <strong>Managed Policies</strong> section, choose <strong>Attach Policy</strong>.</li> 
<li>In the Filter panel, type <strong>ServiceCatalogEndUserAccess</strong>, the search result will display a single result, choose the result.</li> 
<li>Choose <strong>Attach Policy</strong>.</li> 
</ol> 
<p>Finally, you need to allow <code>Training-Users</code> IAM Group to access the <code>Training Portfolio</code>. To do so:</p> 
<ol> 
<li>Open <a href="https://console.aws.amazon.com/servicecatalog/" target="_blank" rel="noopener noreferrer">https://console.aws.amazon.com/servicecatalog/</a> and choose the <code>Training Portfolio</code>.</li> 
<li>On the portfolio details page, expand the&nbsp;<strong>Users, groups and roles&nbsp;</strong>section.</li> 
<li>Choose&nbsp;<strong>Add user, group or role</strong>.</li> 
<li>On the&nbsp;<strong>Groups</strong>&nbsp;tab, select the check box for&nbsp;<code>Training-Users</code>.</li> 
<li>Choose&nbsp;<strong>Add Access</strong>.</li> 
</ol> 
<h3>Step 5. Verification</h3> 
<p>Before you give the account credentials to training attendees, verify whether training users can provision the product.</p> 
<h4><strong>Note</strong></h4> 
<p>The WordPress template requires you to have at least one <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-key-pairs.html" target="_blank" rel="noopener noreferrer">EC2 key pair</a> present in your selected AWS Region. For more information about how to create a key pair, see <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-key-pairs.html#having-ec2-create-your-key-pair" target="_blank" rel="noopener noreferrer">Creating a Key Pair Using Amazon EC2</a>.</p> 
<p>To verify that the training attendees can launch the <code>WordPress</code> product:</p> 
<ol> 
<li>Sign in to the AWS Management Console with the credentials of any IAM user you added to the <code>Training-Users</code> IAM group. Next, open the AWS Service Catalog console at&nbsp;<a href="https://console.aws.amazon.com/servicecatalog/" target="_blank" rel="noopener noreferrer">https://console.aws.amazon.com/servicecatalog/</a>.</li> 
<li>In the&nbsp;<strong>Products</strong>&nbsp;section of the console, choose&nbsp;<code>WordPress</code> and then choose&nbsp;<strong>Launch product</strong>.</li> 
<li>On the&nbsp;<strong>Product version</strong>&nbsp;page, for&nbsp;<strong>Name</strong>, type&nbsp;<code>WordPress</code>.</li> 
<li>In the&nbsp;<strong>Version</strong>&nbsp;table, choose&nbsp;<code>v1.0</code></li> 
<li>Choose&nbsp;<strong>Next</strong>.</li> 
<li>On the&nbsp;<strong>Parameters</strong>&nbsp;page, type the following and choose&nbsp;<strong>Next</strong>: 
<li><strong>KeyName</strong> – Select the KeyName you have access to.</li> 
<li><strong>SSHlocation</strong> – Type a valid CIDR range for the IP address from which you will connect to the instance. This can be the default value (0.0.0.0/0) to allow access from any IP address, your IP address followed by&nbsp;/32&nbsp;to restrict access to your IP address only, or something in between.</li> 
<li><strong>DBPassword, DBUser, DBRootPassword</strong> – Provide alphanumeric characters of your choice.</li> 
<li><strong>InstanceType</strong> – <code>t2.micro</code></li> 
</ul> </li> 
<li>On the <strong>TagOptions</strong> page, choose <strong>Next</strong>.</li> 
<li>On the <strong>Notifications</strong> page, choose <strong>Next</strong>.</li> 
<li>On the&nbsp;<strong>Review</strong>&nbsp;page, review the information that you typed, and then choose&nbsp;<strong>Launch</strong>&nbsp;to launch the stack. The initial status of the product is shown as&nbsp;<strong>Under Change</strong>. After the product is launched, the status becomes <strong>Available</strong>.</li> 
</ol> 
<p>Your environment is ready. You can now distribute the user credentials that you created in <strong>step 1</strong> to all training attendees.</p> 
<h3>Training starts</h3> 
<p>Attendees will be able to provision the WordPress website using the AWS Service Catalog console, but they will not be able launch an EC2 instance or execute any other CloudFormation template from the AWS Management Console. After the training is over, you can easily clean up all resources created by attendees. To see how you can clean up all products attendees provisioned during the training, see <a href="https://aws.amazon.com/blogs/mt/using-aws-lambda-to-decommission-products-provisioned-from-an-aws-service-catalog-portfolio/" target="_blank" rel="noopener noreferrer">Part 2</a> of this series of blog posts.</p> 
<b>Summary</b> 
<p>This blog-post is Part one of a two-part series of blog posts. In Part one I show you how you can use AWS Service Catalog to allow users to launch CloudFormation stacks in your environment, in a controlled manner. AWS Service Catalog also allows you to define template constraints if you have a requirement of allowing users to specify only certain CloudFormation input parameters.</p> 
<p>To see how you can clean up all products provisioned during the training, using AWS Lambda, see <a href="https://aws.amazon.com/blogs/mt/using-aws-lambda-to-decommission-products-provisioned-from-an-aws-service-catalog-portfolio/" target="_blank" rel="noopener noreferrer">Part two</a> of this two-part series of blog posts.</p> 
<p>If you have questions about implementing the solution described in this post, start a new thread on the&nbsp;<a href="https://forums.aws.amazon.com/forum.jspa?forumID=198" target="_blank" rel="noopener noreferrer">AWS Service Catalog Forum</a> or <a href="https://console.aws.amazon.com/support/home" target="_blank" rel="noopener noreferrer">contact AWS Support</a>.</p> 
<h3>About the Author</h3> 
<p><img width="100%" src="https://internal-cdn.amazon.com/badgephotos.amazon.com/?uid=kwwaikar" /> Kanchan Waikar is an AWS Marketplace Solutions Architect at Amazon Web Services. She enjoys helping customers build architectures using AWS, AWS Marketplace products, and AWS Service Catalog.</p> 
</article> 
<article class="blog-post" vocab="http://schema.org/" typeof="TechArticle"> 
<meta property="inLanguage" content="en-US" /> 
<b class="lb-b blog-post-title" property="name headline">Using AWS Lambda to decommission products provisioned from an AWS Service Catalog portfolio</b> 
<footer class="blog-post-meta" data-lb-comp="aws-blog:share-dialog">
by 
<span property="author" typeof="Person"><span property="name">Kanchan Waikar</span></span> | on 
<time property="datePublished" datetime="2018-01-12T09:30:11+00:00">12 JAN 2018</time> | in 
<span class="blog-post-categories"><a href="https://aws.amazon.com/blogs/mt/category/management-tools/aws-service-catalog/" title="View all posts in AWS Service Catalog*"><span property="articleSection">AWS Service Catalog*</span></a>, <a href="https://aws.amazon.com/blogs/mt/category/management-tools/" title="View all posts in Management Tools*"><span property="articleSection">Management Tools*</span></a></span> | 
<a href="https://aws.amazon.com/blogs/mt/using-aws-lambda-to-decommission-products-provisioned-from-an-aws-service-catalog-portfolio/" property="url">Permalink</a> | 
<a href="#" role="button" data-share-dialog-toggle=""><span class="span icon-share"></span>&nbsp;Share</a> 
</footer> 
<p>This blog-post is part two in a <a href="https://aws.amazon.com/blogs/mt/control-aws-resources-available-to-your-users-using-aws-service-catalog/" target="_blank" rel="noopener noreferrer">two-part series</a> of blog posts. <a href="https://aws.amazon.com/blogs/mt/control-aws-resources-available-to-your-users-using-aws-service-catalog/" target="_blank" rel="noopener noreferrer">Part one</a> shows you how to use <a href="https://aws.amazon.com/servicecatalog/" target="_blank" rel="noopener noreferrer">AWS Service Catalog</a> to control AWS resources available to your users. Part two shows you how you can use <a href="https://aws.amazon.com/lambda/" target="_blank" rel="noopener noreferrer">AWS Lambda</a> to decommission all products provisioned from any product of a <a href="http://docs.aws.amazon.com/servicecatalog/latest/adminguide/what-is_concepts.html#what-is_concepts-portfolio" target="_blank" rel="noopener noreferrer">Portfolio</a>.</p> 
<p>Sometimes you might have a business need to terminate all <a href="http://docs.aws.amazon.com/servicecatalog/latest/adminguide/what-is_concepts.html#what-is_concepts-provprod" target="_blank" rel="noopener noreferrer">products provisioned</a> in your AWS account from a specific portfolio. For example, you might want to decommission an old portfolio of products or terminate resources provisioned by your temporary users, as described in the <a href="https://aws.amazon.com/blogs/mt/control-aws-resources-available-to-your-users-using-aws-service-catalog/" target="_blank" rel="noopener noreferrer">first blog post</a>. As an <a href="http://docs.aws.amazon.com/servicecatalog/latest/adminguide/what-is_concepts.html#what-is_concepts-users" target="_blank" rel="noopener noreferrer">AWS Service Catalog Administrator</a>, going through the AWS Service Catalog console and figuring out which products to terminate can be a daunting task if you are managing many portfolios. In this blog post, I share a sample Lambda function that you can use to terminate all products provisioned from a specific portfolio.</p> 
<p>The solution explained in this post finds all products of the portfolio, and then for each product, it finds all provisioned products. Finally, it terminates all provisioned products found.</p> 
<p><span id="more-2384"></span></p> 
<p>Before you begin, you need to find out the portfolio-ID of the portfolio where you want to terminate all provisioned products.</p> 
<h3>Find the portfolio ID</h3> 
<ol> 
<li>Open the AWS Service Catalog console at&nbsp;<a href="https://console.aws.amazon.com/servicecatalog/" target="_blank" rel="noopener noreferrer">https://console.aws.amazon.com/servicecatalog/</a>.</li> 
<li>Choose the&nbsp;portfolio you want to decommission provisioned products from. In this <a href="https://aws.amazon.com/blogs/mt/control-aws-resources-available-to-your-users-using-aws-service-catalog/" target="_blank" rel="noopener noreferrer">blog post series</a>, we choose <code>Training Portfolio</code>.</li> 
<li>On the portfolio details page, locate the <strong>Portfolio ID</strong> and make note of it for later use.</li> 
</ol> 
<p>Next, you need to set up the Lambda function which will terminate provisioned products from your portfolio.</p> 
<h3>Deploy the TerminateProvisionedProducts Lambda function</h3> 
<p>To terminate all products provisioned from a portfolio, you need to set up the <code>TerminateProvisionedProducts</code> Lambda function. You can set up the Lambda function by running a CloudFormation template.</p> 
<ol> 
<li>Sign in to the AWS Management Console and go to the AWS CloudFormation console.</li> 
<li>Next, launch the CloudFormation stack by choosing the following <strong>Launch Stack</strong> link.<br /> <a href="https://console.aws.amazon.com/cloudformation/home?#/stacks/new?stackName=TerminateSCProductsProvisioned&amp;templateURL=https://s3-us-west-2.amazonaws.com/management-tools-blog-cf-template-storage/Blog2SetupCFT-ver3.json" target="_blank" rel="noopener noreferrer"><img width="100%" src="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/images/cloudformation-launch-stack-button.png" /></a></li> 
<li>Choose <strong>Next</strong>.</li> 
<li>On the <strong>Specify Details</strong> page, leave Stack Name as <code>TerminateSCProductsProvisioned</code> and&nbsp;type PortfolioID as the <code>Portfolio ID </code>you noted in the preceding section.</li> 
<li>Choose <strong>Next</strong>.</li> 
<li>On the <strong>Options</strong> page, choose <strong>Next</strong>.</li> 
<li>On the <strong>Review</strong> page, <strong>select</strong> the <strong>check-box</strong> displayed next to the following message. 
<li><em><strong>I acknowledge that AWS CloudFormation might create IAM resources.</strong></em></li> 
</ul> </li> 
<li>Choose <strong>Create</strong>. The CloudFormation template creates the Lambda function and an <a href="https://aws.amazon.com/iam/" target="_blank" rel="noopener noreferrer">AWS Identity and Access Management</a> (IAM) role to run the Lambda function.</li> 
<li>On the <strong>Stacks</strong> page, select <code>TerminateSCProductsProvisioned</code> stack.</li> 
<li>In the detail pane, choose <strong>Outputs</strong>&nbsp;to view the output of your stack.</li> 
</ol> 
<p>After CloudFormation successfully creates a stack, the <strong>Outputs</strong> tab displays the following result:</p> 
<li><code>TerminateProvisionedProductsLambdaFunction</code>: Value displays the name of the <code>TerminateProvisionedProducts</code> Lambda function. Note the same.</li> 
<p>You will run the <code>TerminateProvisionedProducts</code> Lambda function to decommission products provisioned from your portfolio.</p> 
<h3>Run the Lambda function</h3> 
<p>Next, run the <code>TerminateProvisionedProducts</code> Lambda function. This Lambda function finds all products of the portfolio, and then for each product, it finds all provisioned products. Finally, it terminates all provisioned products found.</p> 
<h4>Warning</h4> 
<p>Do not run this Lambda function if you are sharing a product between portfolios. For each product in the portfolio, the Lambda function finds and terminates all provisioned products. Running this function on a portfolio that contains a product shared with another portfolio can lead to unexpected results such as inadvertently deleting the product provisioned from other portfolios.</p> 
<p>To run the Lambda function do the following.</p> 
<ol> 
<li>Sign in to the AWS Management Console and select&nbsp;<strong>Lambda</strong> in the&nbsp;<strong>Services</strong>&nbsp;menu.</li> 
<li>Select <strong>Functions</strong> from the navigation pane.</li> 
<li>In the <strong>Functions</strong> pane, choose the name of the <code>TerminateProvisionedProducts</code> Lambda function you noted earlier.</li> 
<li>Choose the <strong>Select a test event</strong> drop-down list then select <strong>Configure test events</strong>.</li> 
<li>On the <strong>Configure test event</strong> page, select <strong>Create new test event</strong>, specify the event name as <code>TerminateSCProducts</code>.</li> 
<li>Leave the text in the editor as it is. The Lambda function does not require any input.</li> 
<li>Choose <strong>Create</strong>.</li> 
<li>Next, choose <strong>Test</strong>.</li> 
</ol> 
<p>After the function executes, you will see the output containing a list of terminated provisioned products.</p> 
<p><img width="100%" src="https://d2908q01vomqb2.cloudfront.net/972a67c48192728a34979d9a35164c1295401b71/2018/01/11/Screen-Shot-2018-01-11-at-9.40.05-AM.png" /></p> 
<p>The AWS Service Catalog uses the role specified in the launch constraint to terminate the provisioned product. The Lambda function may not be able to clean-up resources if launch constraints are not properly configured and you would need to discover all resources that did not get cleaned up.</p> 
<h3>Discover resources that did not get cleaned-up</h3> 
<p>In this step, you will use <a href="http://docs.aws.amazon.com/awsconsolehelpdocs/latest/gsg/resource-groups.html" target="_blank" rel="noopener noreferrer">Resource Groups</a> to discover the resources associated with the portfolio decommissioned in the previous section. In this blog post series (see <a href="https://aws.amazon.com/blogs/mt/control-aws-resources-available-to-your-users-using-aws-service-catalog/" target="_blank" rel="noopener noreferrer">Part 1</a>), we use <code>Portfolio-Name</code> as the <strong>Key</strong> and <code>Training Portfolio</code> as the <strong>Value</strong>. If you are cleaning-up some other portfolio, then use tag-option you created on the portfolio you decommissioned in the previous section.</p> 
<ol> 
<li>Sign in to the AWS Management Console. On the navigation bar, choose&nbsp;<strong>Resource Groups</strong>, and then under Classic groups, choose&nbsp;<strong>Create a classic Group</strong>.</li> 
<li>On the&nbsp;<strong>Create a resource group</strong>&nbsp;page, for&nbsp;<strong>Group name</strong>, type <code>Training Portfolio Resources</code>.</li> 
<li>For&nbsp;<strong>Tags</strong>, choose an appropriate key in the first box. In the box, next to the first box, select an appropriate value.</li> 
<li>Choose <strong>Save</strong>.</li> 
<li>The console will list all the resources associated with the tag you provided. Review the items displayed in the navigation pane.</li> 
</ol> 
<p><img width="100%" src="https://d2908q01vomqb2.cloudfront.net/972a67c48192728a34979d9a35164c1295401b71/2018/01/02/img2-1024x466.png" /></p> 
<p>AWS Service Catalog associated the tag you specified during portfolio creation to all resources provisioned, this means that you can see the resources that did not get cleaned up with the Lambda function in the navigation pane. If you see any resources, clean them up manually.</p> 
<p>Congratulations! You have successfully decommissioned all products provisioned from your portfolio.</p> 
<h3>Summary</h3> 
<p>This blog-post is Part two of a <a href="https://aws.amazon.com/blogs/mt/control-aws-resources-available-to-your-users-using-aws-service-catalog/" target="_blank" rel="noopener noreferrer">two-part series</a> of blog posts. It shows how you can use AWS Lambda to decommission all products provisioned from a portfolio. The series shows how you can use AWS Service Catalog to control what your IAM users can launch, and Part two shares a sample Lambda function that cleans up products provisioned from a portfolio.</p> 
<p>AWS Service Catalog allows you to centrally manage commonly deployed IT services, and helps you achieve consistent governance and meet your compliance requirements, while enabling you to quickly deploy only the approved IT services you need.</p> 
<p>If you have questions about implementing the solution described in this post, start a new thread on the&nbsp;<a href="https://forums.aws.amazon.com/forum.jspa?forumID=198" target="_blank" rel="noopener noreferrer">AWS Service Catalog Forum</a> or <a href="https://console.aws.amazon.com/support/home" target="_blank" rel="noopener noreferrer">contact AWS Support</a>.</p> 
<h3>About the Author</h3> 
<p><img width="100%" src="https://internal-cdn.amazon.com/badgephotos.amazon.com/?uid=kwwaikar" /> Kanchan Waikar is an AWS Marketplace Solutions Architect at Amazon Web Services. She enjoys helping customers build architectures using AWS, AWS Marketplace products, and AWS Service Catalog.</p> 
</article> 
<article class="blog-post" vocab="http://schema.org/" typeof="TechArticle"> 
<meta property="inLanguage" content="en-US" /> 
<meta property="image" content="https://d2908q01vomqb2.cloudfront.net/972a67c48192728a34979d9a35164c1295401b71/2018/01/09/Ha_EC2-Management-tools_SOCIAL.jpg" /> 
<b class="lb-b blog-post-title" property="name headline">Enable Modular and Reusable Configuration Using Composite AWS Systems Manager Documents</b> 
<footer class="blog-post-meta" data-lb-comp="aws-blog:share-dialog">
by 
<span property="author" typeof="Person"><span property="name">Ananth Vaidyanathan</span></span> | on 
<time property="datePublished" datetime="2018-01-11T09:53:33+00:00">11 JAN 2018</time> | in 
<span class="blog-post-categories"><a href="https://aws.amazon.com/blogs/mt/category/management-tools/amazon-ec2-systems-manager/" title="View all posts in Amazon EC2 Systems Manager*"><span property="articleSection">Amazon EC2 Systems Manager*</span></a>, <a href="https://aws.amazon.com/blogs/mt/category/management-tools/" title="View all posts in Management Tools*"><span property="articleSection">Management Tools*</span></a></span> | 
<a href="https://aws.amazon.com/blogs/mt/enable-modular-and-reusable-configuration-using-composite-aws-systems-manager-documents/" property="url">Permalink</a> | 
<a href="#" role="button" data-share-dialog-toggle=""><span class="span icon-share"></span>&nbsp;Share</a> 
</footer> 
<p><em>By Melonia Mendonca, Software Development Engineer at Amazon Web Services</em></p> 
<p>AWS Systems Manager (SSM) documents enable infrastructure as code that allows you to configure, manage, and automate your AWS and on-premises resources using AWS Systems Manager services. These SSM Documents define the actions that you want to perform on managed instances. Systems Manager offers a variety of pre-defined public documents and provides the ability to customize the documents as well.</p> 
<p>Systems Manager lets you <a href="https://aws.amazon.com/about-aws/whats-new/2017/10/amazon-ec2-systems-manager-now-integrates-with-github/">execute composite documents</a> as part of your configurations. Composite documents are SSM documents that perform the task of executing one or more secondary documents. Using composite documents, you can do the following:</p> 
<li><span style="text-decoration: underline">Enable modularity</span> – Documents can be broken into small common tasks, and then they can be called from composite documents.</li> 
<li><span style="text-decoration: underline">Enable reusability</span> – Having the ability to invoke other documents removes the requirement to duplicate the plugin calls within custom documents.</li> 
<li><span style="text-decoration: underline">Store documents in remote locations</span>– GitHub and Amazon S3 can be used to save documents because these documents in remote locations can be invoked using composite documents.</li> 
<li><span style="text-decoration: underline">Use YAML in place of JSON in documents</span> – AWS Systems Manager also allows the use of documents written in YAML format that are stored in remote locations.</li> 
<p>AWS-RunDocument is a new document you can use to execute documents that are stored in Systems Manager, private or public GitHub, or Amazon S3. This is achieved by using <a href="http://docs.aws.amazon.com/systems-manager/latest/userguide/ssm-plugins.html#aws-downloadContent">aws:downloadContent</a> and <a href="http://docs.aws.amazon.com/systems-manager/latest/userguide/ssm-plugins.html#aws-rundocument">aws:runDocument</a> plugins. The aws:runDocument plugin executes documents that reside in Systems Manager or in the local path.</p> 
<p>In this blog post, I’ll show you how to create custom composite documents using the aws:runDocument plugin. I’ll demonstrate how to execute documents created in Systems Manager by invoking them from the composite document. I’ll also walk through the method of executing documents that are in GitHub by using the AWS-RunDocument document.</p> 
<p><span id="more-2450"></span></p> 
<h3>Walkthrough 1 – Compose a custom document using SSM documents</h3> 
<p>In this example, I’ll show you how to compose a document that updates SSM Agent and then runs baseline patch and eventually configures an AWS package. Before the introduction of composite documents, this could be done one of two ways. You could send three separate commands to execute these public documents – AWS-UpdateSSMAgent, AWS-RunPatchBaseline, and AWS-ConfigureAWSPackage. &nbsp;Alternatively, you could add the plugin references in another document, but you would have to duplicate the document and not use the pre-defined, public document provided. With the use of composite documents, these documents are executed by sending a single composite document.</p> 
<p><strong>Step 1: Create the composite document</strong><br /> I’ll use the aws:runDocument plugin to compose plugins in my document. The plugin has the following parameters:</p> 
<li><span style="text-decoration: underline">documentType</span> – This indicates the type of document. The document could be locally available – LocalPath or from SSM – SSMDocument. In this example, this parameter will be SSMDocument.</li> 
<li><span style="text-decoration: underline">documentPath</span> – This is the path to the document. It is either the absolute path to the document on disk, or the name of the document if the type is SSMDocument. In this walkthrough, we will use the path to specify the names of the documents – AWS-UpdateSSMAgent, AWS-RunPatchBaseline, and AWS-ConfigureAWSPackage.</li> 
<li><span style="text-decoration: underline">documentParameters</span> – The parameters for the secondary document. This should be specified as parameter type StringMap with key and value pairs.</li> 
<p>The document appears as follows. I have named it composite-document.json. This document can be executed on Windows.</p> 
<code class="lang-json"><strong>~/tmp/docs/composite-document.json</strong> 
{
&quot;schemaVersion&quot;: &quot;2.2&quot;,
&quot;description&quot;: &quot;Compose SSM documents&quot;,
&quot;parameters&quot;: {},
&quot;mainSteps&quot;: [
{
&quot;action&quot;: &quot;aws:runDocument&quot;,
&quot;name&quot;: &quot;AgentUpdate&quot;,
&quot;inputs&quot;: {
&quot;documentType&quot;: &quot;SSMDocument&quot;,
&quot;documentPath&quot;: &quot;AWS-UpdateSSMAgent&quot;
}
},
{
&quot;action&quot;: &quot;aws:runDocument&quot;,
&quot;name&quot;: &quot;ApplyPatchBaseline&quot;,
&quot;inputs&quot;: {
&quot;documentType&quot;: &quot;SSMDocument&quot;,
&quot;documentPath&quot;: &quot;AWS-RunPatchBaseline&quot;,
&quot;documentParameters&quot;: &quot;{\&quot;Operation\&quot;:\&quot;Install\&quot;}&quot;
}
},
{
&quot;action&quot;:&quot;aws:runDocument&quot;,
&quot;name&quot; : &quot;ConfigureAWSPVDriver&quot;,
&quot;inputs&quot;:{
&quot;documentType&quot;:&quot;SSMDocument&quot;,
&quot;documentPath&quot;:&quot;AWS-ConfigureAWSPackage&quot;,
&quot;documentParameters&quot;: &quot;{\&quot;action\&quot;:\&quot;Install\&quot;, \&quot;name\&quot;:\&quot;AWSPVDriver\&quot;}&quot;
}
}
]
}</code> 
<p>You can navigate to the AWS Systems Manager console and paste this document to create a document. You can also do this using the <a href="http://docs.aws.amazon.com/cli/latest/reference/ssm/create-document.html">create-document</a> command in the AWS CLI:</p> 
<code class="lang-bash">aws ssm create-document --name composite-document --content file://~/tmp/docs/composite-document.json --document-type Command</code> 
<p><strong>Step 2: Run the command and check the output</strong></p> 
<p>After the command is sent, each action will be executed to produce the following output.</p> 
<p><strong><img width="100%" src="https://d2908q01vomqb2.cloudfront.net/972a67c48192728a34979d9a35164c1295401b71/2018/01/09/walkthru1-step2.png" /></strong></p> 
<p>Or you can use the <a href="http://docs.aws.amazon.com/cli/latest/reference/ssm/send-command.html">send-command</a> command from the AWS CLI. I am targeting all my Windows value instances by using tagging. To do this I created a new tag – PlatformType. For more information on using tags when you send commands, see <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/send-commands-multiple.html">Sending Commands to a Fleet</a> in the AWS Systems Manager documentation.</p> 
<code class="lang-bash">aws ssm send-command --document-name &quot;composite-document&quot; --targets Key=tag:PlatformType,Values=Windows</code> 
<h3>Walkthrough 2 – Compose an SSM custom document using documents from GitHub</h3> 
<p>In a <a href="https://aws.amazon.com/blogs/mt/run-scripts-stored-in-private-or-public-github-repositories-using-amazon-ec2-systems-manager/">previous blog post</a>, I reviewed the method of executing scripts from GitHub. Today, I’ll demonstrate how to execute Systems Manager documents from GitHub. This method can be used to execute documents from Amazon S3, too. In this composite document, I will update SSM Agent to the latest version and then install Apache and My SQL. The document to install this software resides in GitHub and is written in YAML.</p> 
<p><img width="100%" src="https://d2908q01vomqb2.cloudfront.net/972a67c48192728a34979d9a35164c1295401b71/2018/01/09/walkthru-github.png" /></p> 
<p><strong>Step 1:&nbsp; Create composite document</strong><br /> To create a document from a remote resource like GitHub, I’ll use the pre-defined AWS-RunDocument document. This document has the following parameters to help us specify the information to download the document.</p> 
<li><span style="text-decoration: underline">Source Type</span>: Location of the script – GitHub or Amazon S3. For this example, the value here is GitHub.</li> 
<li><span style="text-decoration: underline">Source Info</span>: This parameter provides information for accessing the document. The repository mentioned earlier is public and thus, this should be the owner, repository, and the path to the document.</li> 
<li><span style="text-decoration: underline">Document Parameters</span>: If the document to be executed takes parameters, they can be specified here. In this case, it will be left blank.</li> 
<p>You can use the composite document below to install the SSM Agent, Apache and MySQL on the instance.</p> 
<code class="lang-json"><strong>~/tmp/docs/composite-document-mysql.json</strong> 
{
&quot;schemaVersion&quot;: &quot;2.2&quot;,
&quot;description&quot;: &quot;Composite documents from GitHub&quot;,
&quot;parameters&quot;: {
},
&quot;mainSteps&quot;: [
{
&quot;action&quot;: &quot;aws:runDocument&quot;,
&quot;name&quot;: &quot;AgentUpdate&quot;,
&quot;inputs&quot;: {
&quot;documentType&quot;: &quot;SSMDocument&quot;,
&quot;documentPath&quot;: &quot;AWS-UpdateSSMAgent&quot;
}
},
{
&quot;action&quot;: &quot;aws:runDocument&quot;,
&quot;name&quot;: &quot;InstallApacheandMySQL&quot;,
&quot;inputs&quot;: {
&quot;documentType&quot;: &quot;SSMDocument&quot;,
&quot;documentPath&quot;: &quot;AWS-RunDocument&quot;,
&quot;documentParameters&quot; : &quot;{\&quot;sourceType\&quot;:\&quot;GitHub\&quot;, \&quot;sourceInfo\&quot;:\&quot;{\\\&quot;owner\\\&quot;:\\\&quot;mmendonca3\\\&quot;,\\\&quot;repository\\\&quot;:\\\&quot;dummy-test-public\\\&quot;, \\\&quot;path\\\&quot;:\\\&quot;documents/bootstrap/StateManagerBootstrap.yml\\\&quot;}\&quot;}&quot;
}
}
]
}</code> 
<p>You can create it using the AWS Systems Manager console or AWS CLI. The command to create this document would be:</p> 
<code class="lang-bash">aws ssm create-document --name composite-document-mysql --content file://~/tmp/docs/composite-document-mysql.json --document-type Command</code> 
<p><strong>Step 2: Run Command and check the output</strong><br /> On sending a command to execute this document, the agent gets updated to the latest version, downloads the document, and then executes it.</p> 
<p><img width="100%" src="https://d2908q01vomqb2.cloudfront.net/972a67c48192728a34979d9a35164c1295401b71/2018/01/09/walkthru2-output.png" /></p> 
<p>The command to run this is follows:</p> 
<code class="lang-bash">aws ssm send-command --document-name &quot;composite-document-mysql&quot; --targets Key=tag:PlatformType,Values=AmazonLinux</code> 
<h3>Conclusion</h3> 
<p>In this blog post, I have shown you how to enable management as code by using composite documents. You can create composite documents to reuse your documents easily, and enable modularity. Documents created using AWS Systems Manager can be referenced using composite documents. Those documents on GitHub and Amazon S3, written in JSON or YAML, can be executed using the AWS-RunDocument document.</p> 
<h3>About the Author</h3> 
<p><img width="100%" src="https://d2908q01vomqb2.cloudfront.net/972a67c48192728a34979d9a35164c1295401b71/2017/11/02/melonia.jpg" />Melonia Mendonca is a Software Development Engineer with the Amazon EC2 Systems Manager team. She is a passionate engineer who enjoys the ability to innovate encouraged by Amazon. Outside of work, Melonia likes traveling, playing board games and trying different restaurants/cuisines.</p> 
</article> 
<article class="blog-post" vocab="http://schema.org/" typeof="TechArticle"> 
<meta property="inLanguage" content="en-US" /> 
<b class="lb-b blog-post-title" property="name headline">Using AWS OpsWorks for Chef Automate in a federated environment</b> 
<footer class="blog-post-meta" data-lb-comp="aws-blog:share-dialog">
by 
<span property="author" typeof="Person"><span property="name">Darko Meszaros</span></span> | on 
<time property="datePublished" datetime="2017-12-31T14:34:39+00:00">31 DEC 2017</time> | in 
<span class="blog-post-categories"><a href="https://aws.amazon.com/blogs/mt/category/management-tools/aws-ops-works/" title="View all posts in AWS OpsWorks*"><span property="articleSection">AWS OpsWorks*</span></a>, <a href="https://aws.amazon.com/blogs/mt/category/devops/" title="View all posts in DevOps*"><span property="articleSection">DevOps*</span></a>, <a href="https://aws.amazon.com/blogs/mt/category/management-tools/" title="View all posts in Management Tools*"><span property="articleSection">Management Tools*</span></a></span> | 
<a href="https://aws.amazon.com/blogs/mt/using-aws-opsworks-for-chef-automate-in-a-federated-environment/" property="url">Permalink</a> | 
<a href="#" role="button" data-share-dialog-toggle=""><span class="span icon-share"></span>&nbsp;Share</a> 
</footer> 
<p>Many large enterprises operate on a federated model. That is, they are separated into different business units or organizations, with different goals, procedures, and skill sets. These enterprises typically use a system to manage their infrastructure configuration and changes.</p> 
<p>You might ask, “Can we apply a federated model to configuration management? If so, what are the pros and cons and how does AWS OpsWorks for Chef Automate fit into that model?”</p> 
<p>In this blog post we discuss how to approach configuration management in a. federated enterprise. &nbsp;The main focus is on how you can leverage <a href="https://aws.amazon.com/opsworks/chefautomate/">AWS OpsWorks for Chef Automate</a> to achieve this goal.</p> 
<p><span id="more-2257"></span></p> 
<b>Single Chef server to serve all parts of your organization</b> 
<p>Approaching configuration management in a non-federated way involves using a single Chef server across many different business units.</p> 
<p>But, I hear you say, “Different business units have their own Chef nodes, cookbooks, and environments. How do we separate those?”</p> 
<p>The way you can achieve this with Chef is to use the concept of <a href="https://docs.chef.io/server_orgs.html"><strong>Chef Organizations</strong></a>, which is a core part of the Chef Server software.</p> 
<p>Chef Organizations allows you to separate the following items among different business units, but they still reside on a single Chef server:</p> 
<li>Permissions</li> 
<li>Nodes</li> 
<li>Roles</li> 
<li>Environments</li> 
<li>Cookbooks</li> 
<li>Data bags</li> 
<p>The main benefits of this approach is that each business unit can independently manage its own nodes, access permissions, and can perform maintenance/updates on its infrastructure on its own schedule. Having this type of isolation allows the business units/organizations to have access to their own unique environments, roles, data bags, and cookbooks. Additionally, by hosting all of this on a single server you reduce the amount of effort required to set up and maintain a separate Chef server for each business unit.</p> 
<p><img width="100%" src="https://d2908q01vomqb2.cloudfront.net/972a67c48192728a34979d9a35164c1295401b71/2017/12/27/single_chef.png" /></p> 
<p style="text-align: center"><em>Single Chef Server Model</em></p> 
<b>Single Chef server per business unit</b> 
<p>When we speak about a model for a true federated approach to configuration management, we imply that each of the company’s business units/organizations has its own separate Chef server. This brings us the same benefits that we get when we use Chef Organizations, but with even greater isolation between the business units. This brings more benefits when in the cloud.</p> 
<p>“What are these new benefits you speak of?”</p> 
<p>Well, it is very common to have different business units, each with its own respective AWS Account, for all of their resources. This approach is used for billing. It gives us a clear separation of resource usage per business unit. If each business unit uses a Chef server in a centralized AWS account, billing and management of that resource can get out of hand. Another major benefit, which is not strictly cloud related, is that the maintenance of the Chef server and the potential downtime it experiences, does not cause disruptions across all organizations and their infrastructure. By having a Chef server for each business unit you can mitigate the issue of having a single point of failure. If you rely on a single Chef server throughout your enterprise, that server’s failure would cause potential down time across all business units. By using multiple Chef servers you reduce the blast radius of potential Chef server down time.</p> 
<p><img width="100%" src="https://d2908q01vomqb2.cloudfront.net/972a67c48192728a34979d9a35164c1295401b71/2017/12/27/Untitled_Diagram.png" /></p> 
<p style="text-align: center"><em>Federated model/Multi Chef Server</em></p> 
<p>Additionally, the concept of Chef Organizations can be fully utilized even in a federated model. For example, if a certain business unit wants to separate even further, it can split its own Chef Automate server into organizations. The nodes from all organizations will be visible on the Chef Automate dashboard because you can filter nodes based on Chef Organizations.</p> 
<p>“But what happens to our cookbooks? Does each business unit need to write its own?” To answer these questions, let’s take a look at <strong>Centralized Cookbook repositories.</strong></p> 
<b>Centralized Cookbook repositories</b> 
<p>A great way to make all of your configurations as consistent as possible is to have a companywide Cookbook repository. This means that teams/business units can use cookbooks created by other parts of the company to configure their infrastructure – on their respective Chef Servers. This, in turn, reduces the effort required to start using Chef as a configuration management system in a business unit because most of the required code base is already present. So, for example, let’s say that business unit A writes its own cookbook for setting up an application, and business unit B also uses the same application in their own environment. Business unit B does not have to write its own cookbook from scratch, but can use the cookbooks already created by business unit A. The main obstacle to having a shared cookbook system is properly writing cookbooks in the first place. Each cookbook must be as dynamic as possible. When you write a cookbook, leverage attributes, templates, and data-bags as much as possible so you can be flexible and help other teams use the same cookbook for, &nbsp;their use cases.</p> 
<p>“So what kind of Cookbook repos can we use?”</p> 
<h3>Git repo</h3> 
<p>The simplest approach to centrally managing your cookbooks is to use &nbsp;Git repositories. Yes, simple as that. You can use the <a href="https://docs.chef.io/berkshelf.html"><strong>Berkshelf</strong></a> tool to manage the cookbooks, but instead of pulling them from the Chef supermarket, it pulls from the Git repo. With Berkshelf, you can specify a certain cookbook version to be pulled. In addition, because Berkshelf supports specifying a repository branch, you can even select a specific branch of your cookbook repo, for example, a certain testing branch to be used in a Dev environment.</p> 
<p><em>Berksfile example:<br /> </em></p> 
<code class="lang-berks">cookbook &quot;buk-cookbook&quot;, &quot;~&gt;; 0.9.3&quot;, git: &quot;https://github.com/example/buk-cookbook.git&quot;
cookbook &quot;jinar-cookbook&quot;, &quot;~&gt;; 0.2.4&quot;, git: &quot;https://github.com/example/jinar-cookbook.git&quot;, branch: &quot;my-test-branch&quot;</code> 
<p>As mentioned before – you can have centralized Cookbook Git repositories across the entire company. Then each team could create its own repositories and push cookbooks – which could, in turn, be used by everyone in the company.</p> 
<p><img width="100%" src="https://d2908q01vomqb2.cloudfront.net/972a67c48192728a34979d9a35164c1295401b71/2017/12/27/git_mutlichef_cropped.png" /></p> 
<p style="text-align: center"><em>Common GIT repositories for cookbooks</em></p> 
<p>“But–hey – at the beginning of this blog post you mentioned that one of the benefits of using a single Chef server is not needing to configure and maintain each server separately. Doesn’t having too many Chef servers give us a lot of overhead?”</p> 
<p>Enter – <a href="https://aws.amazon.com/opsworks/chefautomate/">OpsWorks for Chef Automate</a></p> 
<b>How does OpsWorks for Chef automate fit into all of this?</b> 
<p>AWS OpsWorks for Chef Automate (OWCA) provides a fully managed Chef server and suite of automation tools, which compose <a href="https://www.chef.io/automate/">Chef Automate</a>. OpsWorks for Chef Automate offers you a consistent Chef server configuration throughout all deployed servers. All servers are deployed and bootstrapped by OpsWorks, so this means that each new server will be configured in the same way. Additionally, OpsWorks takes care of the Chef server maintenance in the form of server patching, minor Chef updates, and backups. That means that you do not have to spend time and effort in order to set-up and configure a Chef Automate server. You can just let OpsWorks handle that for you, and have your business units focus all their energy on writing or using Chef cookbooks in their environments.</p> 
<p>The fact that OpsWorks handles patching means that you don’t need to connect to the Chef server using SSH. You only &nbsp;need to use knife to manage your Chef server software. With backup and restore in place, you can easily revert back to a working version of your server if something goes wrong.</p> 
<p>A 10 000 foot view of setting up OWCA for a business unit would look something like this:</p> 
<li>Launch an OWCA server in the desired Region with the desired instance size.</li> 
<li>Take the starter kit provided with the Chef Automate server to be used on a Chef Workstation.</li> 
<li>Once the server is fully running, dministrators can use the Chef Workstation to create all the required resources: 
<li>Environments</li> 
<li>Roles</li> 
</ul> </li> 
<li>Set Berkshelf to get the needed Cookbooks from a common repository, and have them installed on the Chef Automate server.</li> 
<li>Finally, bootstrap nodes in the appropriate roles. The usage of AWS API can be applied here, as OpsWorks can handle node bootstrapping for you.</li> 
<p>Simple as that! You don’t need to manually configure Chef servers. You &nbsp;just &nbsp;launch an OpsWorks for Chef Automate server, and the rest is just Cookbook and node management.</p> 
<b>Summary</b> 
<p>Here we have discussed how to implement a federated model for configuration management using Chef and OpsWorks. We described how simple it is to set up and maintain a Chef server with OpsWorks. Many of our customers are actually taking this direction when using OpsWorks for Chef Automate because it allows them to separate their teams but still maintain a common set of configuration rules across the entire enterprise. With the assistance of the AWS API to bootstrap nodes this allows you to spend less time worrying about setting up the configuration management infrastructure and more on creating and using Cookbooks and any other Chef resources you need.</p> 
<p><strong>About the Author</strong></p> 
<p><img width="100%" src="https://d2908q01vomqb2.cloudfront.net/972a67c48192728a34979d9a35164c1295401b71/2017/10/24/darko-cropped.jpeg" /><br /> Darko Meszaros is a Cloud Support Engineer who supports customers that use various AWS automation tools, such as AWS OpsWorks, AWS CodeDeploy, and AWS CloudFormation. He is a subject matter expert for OpsWorks and CodeDeploy. Outside of work, he loves collecting video games and old computers.</p> 
<p>&nbsp;</p> 
<p>&nbsp;</p> 
<p><em>The screenshots in this post are Copyright Chef Software Inc., and are available at <a href="https://github.com/chef/chef-web-docs">https://github.com/chef/chef-web-docs</a> under the terms of the CC-BY-3.0 license, available here <a href="https://creativecommons.org/licenses/by/3.0/legalcode">https://creativecommons.org/licenses/by/3.0/legalcode</a>.</em></p> 
</article> 
<article class="blog-post" vocab="http://schema.org/" typeof="TechArticle"> 
<meta property="inLanguage" content="en-US" /> 
<b class="lb-b blog-post-title" property="name headline">2017 Year in Review: AWS OpsWorks for Chef Automate and Puppet Enterprise</b> 
<footer class="blog-post-meta" data-lb-comp="aws-blog:share-dialog">
by 
<span property="author" typeof="Person"><span property="name">Rahul Gulati</span></span> | on 
<time property="datePublished" datetime="2017-12-29T01:12:32+00:00">29 DEC 2017</time> | in 
<span class="blog-post-categories"><a href="https://aws.amazon.com/blogs/mt/category/management-tools/aws-ops-works/" title="View all posts in AWS OpsWorks*"><span property="articleSection">AWS OpsWorks*</span></a>, <a href="https://aws.amazon.com/blogs/mt/category/devops/" title="View all posts in DevOps*"><span property="articleSection">DevOps*</span></a>, <a href="https://aws.amazon.com/blogs/mt/category/management-tools/" title="View all posts in Management Tools*"><span property="articleSection">Management Tools*</span></a></span> | 
<a href="https://aws.amazon.com/blogs/mt/2017-year-in-review-aws-opsworks-for-chef-automate-and-puppet-enterprise/" property="url">Permalink</a> | 
<a href="#" role="button" data-share-dialog-toggle=""><span class="span icon-share"></span>&nbsp;Share</a> 
</footer> 
<p>AWS OpsWorks for Chef Automate and AWS OpsWorks for Puppet Enterprise provide fully managed Chef and Puppet servers with a suite of automation tools for infrastructure and application management. Enterprise customers rely on OpsWorks for easy configuration management and secure maintenance as the service automatically patches, updates, and backs up servers. This blog post gives you a quick recap of this year’s announcements and events for AWS OpsWorks for Chef Automate and AWS OpsWorks for Puppet Enterprise.</p> 
<p><span id="more-2218"></span></p> 
<p><strong>Announcing OpsWorks for Puppet Enterprise</strong></p> 
<p>Puppet Enterprise support has been the most popular request for AWS OpsWorks since AWS launched the service. Using OpsWorks for Puppet Enterprise, customers can easily manage hybrid infrastructure as code, register node instances without signing certificate requests on the Puppet master, and run modules from the Puppet Forge community. AWS OpsWorks for Puppet Enterprise is integrated with AWS CloudTrail and AWS CodeCommit. AWS CloudTrail captures all of the AWS OpsWorks for Puppet Enterprise API calls and delivers log files to an Amazon S3 bucket. AWS CodeCommit hosts R10K remote repositories, which are general purpose toolsets for deploying Puppet environments and modules.</p> 
<p><a href="https://aws.amazon.com/blogs/aws/new-aws-opsworks-for-puppet-enterprise/">Launch announcement</a></p> 
<p><strong>AWS OpsWorks for Chef Automate now supports Chef Compliance</strong></p> 
<p>The release of Chef Automate version 1.6 includes the new Compliance view for the Chef Automate UI. With AWS OpsWorks for Chef Automate integrated with compliance, you can track the compliance of your infrastructure based on a predefined policy. This allows you to frequently audit your applications for vulnerabilities and remediate violations.</p> 
<p><a href="https://aws.amazon.com/blogs/mt/aws-opsworks-for-chef-automate-now-supports-compliance/">Launch announcement</a></p> 
<p><strong>re:Invent – Automate and scale configuration management with AWS OpsWorks</strong></p> 
<p>At re:Invent 2017, we hosted a session on automating and scaling configuration management through AWS OpsWorks. We gave an overview of how using the DevOps model to treat infrastructure environments as code enables you to automate and scale development and production environments.</p> 
<p>We showed re:Invent session attendees how OpsWorks lets you use Chef and Puppet to automate the way servers are configured, deployed, and managed across your Amazon EC2 instances or on-premises compute environments. We walked through how OpsWorks helps you to focus on the core task of configuration management using Puppet and Chef by setting up and maintaining your environment in just a few clicks.</p> 
<p><a href="https://www.slideshare.net/AmazonWebServices/automate-and-scale-configuration-management-with-aws-opsworks-dev331-reinvent-2017">Slides</a></p> 
<p><a href="https://www.youtube.com/watch?v=1Zw4g3o2O0M">Video</a></p> 
<p>Right after re:Invent, we released two more updates.</p> 
<p><strong>Availability in six new Regions</strong></p> 
<p>AWS OpsWorks for Chef Automate and AWS OpsWorks for Puppet Enterprise are available in six new Regions: US East (Ohio), US West (N. California), EU (Frankfurt), Asia Pacific (Singapore), Asia Pacific (Tokyo), and Asia Pacific (Sydney). With this release, this service is available in nine regions, including US East (N. Virginia), US West (Oregon), and EU (Ireland).</p> 
<p>We added these Regions based on customer feedback, adoption of other AWS products, and to provide wider geographical coverage.</p> 
<p><a href="http://docs.aws.amazon.com/general/latest/gr/rande.html#opsworks_region">AWS Regions and Endpoints</a></p> 
<p><strong>Create backups from the console</strong></p> 
<p>With this release, AWS OpsWorks for Chef Automate and Puppet Enterprise customers can also create manual backups through the AWS Management Console. Earlier, manual backups were limited to using a CLI command. A backup – either manual or automated – saves application-level server data, such as cookbooks, modules, users, organizations, and node configurations. Backup excludes any additional files that you store on the server EC2 instance.</p> 
<p><a href="http://docs.aws.amazon.com/opsworks/latest/userguide/opscm-chef-backup.html">Back Up an AWS OpsWorks for Chef Automate Server</a></p> 
<p><a href="http://docs.aws.amazon.com/opsworks/latest/userguide/opspup-backup.html">Back Up an AWS OpsWorks for Puppet Enterprise Server</a></p> 
<p><strong>About the Author</strong></p> 
<p><img width="100%" src="https://d2908q01vomqb2.cloudfront.net/972a67c48192728a34979d9a35164c1295401b71/2017/12/22/ragulati.jpeg" />Rahul Gulati is a Product Manager at AWS OpsWorks. He enjoys working with customers and engineering teams to build software products.</p> 
</article> 
<p>
© 2018 Amazon Web Services, Inc. or its affiliates. All rights reserved.
</p>

    </div>
  </div>
</div>


    <div id="footer" class="navigation hidden-print">
      <div class="container">
        <div class="row">
          <div class="col-xs-12">
            <ul class="footer-links nav navbar-nav">
              <li><a href="../aws.html">AWS</a></li>
              <li><a href="../linux.html">Linux</a></li>
              <li><a href="../docker.html">Docker</a></li>
              <li><a href="../ibmpower.html">IBM Power</a></li>
              <li><a href="blogsataws1.html">Blogs@AWS (Kindle Friendly)</a></li>
            </ul>
            <ul class="footer-links nav navbar-nav navbar-right">
              <li><a href="../comments.html">Comments?</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
