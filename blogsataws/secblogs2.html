<!DOCTYPE html>
<html lang="en">
  <head>
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-593498H');</script>
<!-- End Google Tag Manager -->

    <meta charset="utf-8">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">

    <meta name="msapplication-config" content="/microsoft-tile.xml" />
    <meta name="theme-color" content="#ffffff">

    <meta property="og:url" content="https://bejoycalias.github.io/blogsataws/secblogs1.html" />
    <meta property="og:site_name" content="Bejoy's TechNotes"/>
    <meta property="og:title" content="Bejoy's TechNotes - Kindle Friendly AWS Security Blogs" />
    <meta property="og:image" content="https://bejoycalias.github.io/assets/images/og-image.png"/>
    <meta property="og:image:width" content="1200"/>
    <meta property="og:image:height" content="1200"/>
    <meta property="og:description" content="" />

    <title>Bejoy's TechNotes - Kindle Friendly AWS Security Blogs</title>
    <link href="../assets/stylesheets/application-832aa42c.css" rel="stylesheet" />

    <!--[if lt IE 9]>
      <script src="../assets/javascripts/ie-compat-c141a02d.js"></script>
    <![endif]-->
    <script src="../assets/javascripts/application-ff53d307.js"></script>

    <!-- Typekit script to import Klavika font -->
    <script src="https://use.typekit.net/wxf7mfi.js"></script>
    <script>try{Typekit.load({ async: true });}catch(e){}</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-100043608-1', 'auto');
  ga('send', 'pageview');

</script>

    
  </head>

  <body id="uh-oh-" class="layout-inner page-uh-oh-">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-593498H"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->


    <div id="header" class="navigation navbar-static-top hidden-print">
      <div class="container">
        <div class="row">
          <div class="col-xs-12">
            <div class="navbar-header">
              <div class="navbar-brand">
                <a href="/">
                  <svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="135.000000pt" height="50" viewbox="0 0 135.000000 45.000000" preserveaspectratio="xMidYMid meet" class="logo">

<g transform="translate(0.000000,45.000000) scale(0.100000,-0.100000)" fill="#000000" stroke="none">
<path class="text" fill="#000000" d="M527 384 c-4 -4 -7 -18 -7 -31 0 -21 4 -24 28 -21 21 2 27 8 27 28 0
18 -6 26 -20 28 -12 2 -24 0 -28 -4z"></path>
<path class="text" fill="#000000" d="M1080 335 c0 -48 2 -55 20 -55 18 0 20 7 20 55 0 48 -2 55 -20 55
-18 0 -20 -7 -20 -55z"></path>
<path class="text" fill="#000000" d="M54 357 c-2 -7 -3 -69 -2 -138 l3 -124 65 -3 c90 -3 130 20 130 77 0
29 -6 44 -20 54 -20 14 -20 15 -3 45 14 25 15 34 5 56 -6 15 -23 31 -38 36
-38 15 -134 13 -140 -3z m110 -33 c19 -7 21 -45 4 -62 -7 -7 -22 -12 -35 -12
-20 0 -23 5 -23 40 0 41 13 50 54 34z m20 -130 c19 -18 19 -20 6 -45 -8 -13
-21 -19 -45 -19 -34 0 -35 1 -35 40 0 38 2 40 29 40 16 0 37 -7 45 -16z"></path>
<path class="text" fill="#000000" d="M319 271 c-23 -24 -29 -38 -29 -74 0 -25 3 -53 6 -62 20 -50 164 -64
164 -15 0 15 -7 17 -45 12 -46 -5 -75 8 -75 34 0 11 16 14 65 14 l65 0 0 35
c0 80 -92 114 -151 56z m99 -33 c3 -15 -4 -18 -37 -18 -43 0 -50 7 -29 28 18
18 62 11 66 -10z"></path>
<path class="text" fill="#000000" d="M520 184 c0 -107 -1 -116 -20 -121 -11 -3 -20 -12 -20 -19 0 -21 76
-19 84 2 3 9 6 69 6 135 l0 119 -25 0 -25 0 0 -116z"></path>
<path class="text" fill="#000000" d="M649 271 c-24 -25 -29 -37 -29 -78 1 -70 34 -103 105 -103 55 0 95
44 95 103 0 60 -7 75 -41 92 -47 25 -96 19 -130 -14z m111 -30 c25 -48 2 -111
-40 -111 -45 0 -69 80 -34 114 21 22 61 20 74 -3z"></path>
<path class="text" fill="#000000" d="M850 287 c0 -8 16 -57 36 -110 28 -76 33 -100 25 -116 -16 -28 -14
-31 18 -31 27 0 29 4 70 123 23 67 41 128 41 135 0 6 -11 12 -24 12 -21 0 -26
-8 -41 -65 -10 -36 -21 -68 -25 -70 -3 -2 -16 27 -29 66 -19 60 -25 69 -47 69
-13 0 -24 -6 -24 -13z"></path>
<path class="text" fill="#000000" d="M1192 284 c-17 -12 -22 -24 -20 -47 2 -26 10 -36 45 -52 49 -23 59
-55 17 -55 -14 0 -34 5 -45 10 -16 9 -19 7 -19 -13 0 -17 7 -27 23 -31 69 -18
117 6 117 60 0 32 -4 37 -45 55 -60 26 -62 54 -4 46 37 -5 40 -3 37 16 -2 18
-11 23 -43 25 -25 2 -49 -3 -63 -14z"></path>
</g>
</svg>

                </a>
              </div>
              <button class="navbar-toggle" type="button">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
            </div>
            <div class="buttons hidden-xs">
              <nav class="navigation-links" role="navigation">
                <ul class="main-links nav navbar-nav navbar-right">
                  <li><a href="../aws.html">AWS</a></li>
                  <li><a href="../linux.html">Linux</a></li>
                  <li><a href="../docker.html">Docker</a></li>
                  <li><a href="../ibmpower.html">IBM Power</a></li>
                  <li><a href="blogsataws1.html">Blogs@AWS (Kindle Friendly)</a></li>
                </ul>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="sidebar-overlay"></div>

<aside class="sidebar" role="navigation">
  <div class="sidebar-header">
    <svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="135.000000pt" height="42" viewbox="0 0 135.000000 45.000000" preserveaspectratio="xMidYMid meet">

<g transform="translate(0.000000,45.000000) scale(0.100000,-0.100000)" fill="#000000" stroke="none">
<path class="text" fill="#000000" d="M527 384 c-4 -4 -7 -18 -7 -31 0 -21 4 -24 28 -21 21 2 27 8 27 28 0
18 -6 26 -20 28 -12 2 -24 0 -28 -4z"></path>
<path class="text" fill="#000000" d="M1080 335 c0 -48 2 -55 20 -55 18 0 20 7 20 55 0 48 -2 55 -20 55
-18 0 -20 -7 -20 -55z"></path>
<path class="text" fill="#000000" d="M54 357 c-2 -7 -3 -69 -2 -138 l3 -124 65 -3 c90 -3 130 20 130 77 0
29 -6 44 -20 54 -20 14 -20 15 -3 45 14 25 15 34 5 56 -6 15 -23 31 -38 36
-38 15 -134 13 -140 -3z m110 -33 c19 -7 21 -45 4 -62 -7 -7 -22 -12 -35 -12
-20 0 -23 5 -23 40 0 41 13 50 54 34z m20 -130 c19 -18 19 -20 6 -45 -8 -13
-21 -19 -45 -19 -34 0 -35 1 -35 40 0 38 2 40 29 40 16 0 37 -7 45 -16z"></path>
<path class="text" fill="#000000" d="M319 271 c-23 -24 -29 -38 -29 -74 0 -25 3 -53 6 -62 20 -50 164 -64
164 -15 0 15 -7 17 -45 12 -46 -5 -75 8 -75 34 0 11 16 14 65 14 l65 0 0 35
c0 80 -92 114 -151 56z m99 -33 c3 -15 -4 -18 -37 -18 -43 0 -50 7 -29 28 18
18 62 11 66 -10z"></path>
<path class="text" fill="#000000" d="M520 184 c0 -107 -1 -116 -20 -121 -11 -3 -20 -12 -20 -19 0 -21 76
-19 84 2 3 9 6 69 6 135 l0 119 -25 0 -25 0 0 -116z"></path>
<path class="text" fill="#000000" d="M649 271 c-24 -25 -29 -37 -29 -78 1 -70 34 -103 105 -103 55 0 95
44 95 103 0 60 -7 75 -41 92 -47 25 -96 19 -130 -14z m111 -30 c25 -48 2 -111
-40 -111 -45 0 -69 80 -34 114 21 22 61 20 74 -3z"></path>
<path class="text" fill="#000000" d="M850 287 c0 -8 16 -57 36 -110 28 -76 33 -100 25 -116 -16 -28 -14
-31 18 -31 27 0 29 4 70 123 23 67 41 128 41 135 0 6 -11 12 -24 12 -21 0 -26
-8 -41 -65 -10 -36 -21 -68 -25 -70 -3 -2 -16 27 -29 66 -19 60 -25 69 -47 69
-13 0 -24 -6 -24 -13z"></path>
<path class="text" fill="#000000" d="M1192 284 c-17 -12 -22 -24 -20 -47 2 -26 10 -36 45 -52 49 -23 59
-55 17 -55 -14 0 -34 5 -45 10 -16 9 -19 7 -19 -13 0 -17 7 -27 23 -31 69 -18
117 6 117 60 0 32 -4 37 -45 55 -60 26 -62 54 -4 46 37 -5 40 -3 37 16 -2 18
-11 23 -43 25 -25 2 -49 -3 -63 -14z"></path>
</g>
</svg>

  </div>

  <ul class="nav sidebar-nav">
    <li><a href="../aws.html">AWS</a></li>
    <li><a href="../linux.html">Linux</a></li>
    <li><a href="../docker.html">Docker</a></li>
    <li><a href="../ibmpower.html">IBM Power</a></li>
    <li><a href="blogsataws1.html">Blogs@AWS (Kindle Friendly)</a></li>
  </ul>
</aside>


    <div class="container">
  <div class="row">
    <div id="docs-sidebar" class="col-sm-3 col-md-3 col-xs-12 hidden-print" role="complementary">
      <ul class="nav docs-sidenav">
      <li><a href="blogsataws1.html">Blogs @ AWS</a></li>
      <li><a href="whatsnew1.html">What's New @ AWS</a></li>
      <li class="active"><a href="secblogs1.html">Security Blogs @ AWS</a></li>
      <li><a href="computeblogs1.html">Compute Blogs @ AWS</a></li>
      <li><a href="apnblogs1.html">APN Blogs @ AWS</a></li>
      <li><a href="devopsblogs1.html">DevOps Blogs @ AWS</a></li>
      <li><a href="mgmtblogs1.html">Management Tools Blogs @ AWS</a></li>

    </ul>
    </div>

    <div id="inner" class="col-sm-9 col-md-9 col-xs-12" role="main">
<p></p>
<p><i>Contents of this page is copied directly from AWS blog sites to make it Kindle friendly. Some styles & sections from these pages are removed to render this properly in 'Article Mode' of Kindle e-Reader browser. All the contents of this page is property of AWS.</i></p>
<p><a href="secblogs1.html">Page 1</a>|<a href="secblogs2.html">Page 2</a>|<a href="secblogs3.html">Page 3</a>|<a href="secblogs4.html">Page 4</a</p>
<br>
<article class="post" vocab="http://schema.org/" typeof="TechArticle"> 
<meta property="inLanguage" content="en-US" /> 
<b class="b post-title" property="name headline">How to Automatically Revert and Receive Notifications About Changes to Your Amazon VPC Security Groups</b> 
<footer class="meta">
by 
<span property="author" typeof="Person"><span property="name">Rob Barnes</span></span> | on 
<time property="datePublished" datetime="2017-10-11T06:50:58+00:00">11 OCT 2017</time> | in 
<span class="categories"><a href="https://aws.amazon.com/blogs/security/category/networking-content-delivery/amazon-vpc-networking-content-delivery/" title="View all posts in Amazon VPC*"><span property="articleSection">Amazon VPC*</span></a>, <a href="https://aws.amazon.com/blogs/security/category/how-to/" title="View all posts in How-To*"><span property="articleSection">How-To*</span></a></span> | 
<a href="https://aws.amazon.com/blogs/security/how-to-automatically-revert-and-receive-notifications-about-changes-to-your-amazon-vpc-security-groups/" property="url">Permalink</a> | 
<a id="aws-comment-trigger-5393" href="https://commenting.awsblogs.com/embed.html?disqus_shortname=aws-security-blog&amp;disqus_identifier=5393&amp;disqus_title=How+to+Automatically+Revert+and+Receive+Notifications+About+Changes+to+Your+Amazon+VPC+Security+Groups&amp;disqus_url=https://aws.amazon.com/blogs/security/how-to-automatically-revert-and-receive-notifications-about-changes-to-your-amazon-vpc-security-groups/" data-sandbox-attr="allow-forms allow-scripts allow-popups allow-same-origin" property="discussionUrl"><i class="icon-comment"></i> Comments</a> 
<script>
require(['blog'], function() {
AWS.Blog.commenting('#aws-comment-trigger-5393');
});
</script> | 
<a href="#" role="button" data-share-dialog=""><span class="span icon-share"></span>&nbsp;Share</a> 
<ul> 
</ul> 
</footer> 
<p>In a previous <a href="https://aws.amazon.com/blogs/security/how-to-monitor-aws-account-configuration-changes-and-api-calls-to-amazon-ec2-security-groups/" target="_blank" rel="noopener noreferrer">AWS Security Blog post</a>, Jeff Levine showed how you can monitor changes to your <a href="https://aws.amazon.com/ec2/" target="_blank" rel="noopener noreferrer">Amazon EC2</a> security groups. The methods he describes in that post are examples of <em>detective controls</em>, which can help you determine when changes are made to security controls on your AWS resources.</p> 
<p>In this post, I take that approach a step further by introducing an example of a <em>responsive control</em>, which you can use to automatically respond to a detected security event by applying a chosen security mitigation. I demonstrate a solution that continuously monitors changes made to an <a href="https://aws.amazon.com/vpc/" target="_blank" rel="noopener noreferrer">Amazon VPC</a> <a href="http://docs.aws.amazon.com/AmazonVPC/latest/UserGuide/VPC_SecurityGroups.html" target="_blank" rel="noopener noreferrer">security group</a>, and if a new ingress rule (the same as an inbound rule) is added to that security group, the solution removes the rule and then sends you a notification after the changes have been automatically reverted.</p> 
<h3>The scenario</h3> 
<p>Let’s say you want to reduce your infrastructure complexity by <a href="https://aws.amazon.com/blogs/mt/replacing-a-bastion-host-with-amazon-ec2-systems-manager/" target="_blank" rel="noopener noreferrer">replacing your Secure Shell (SSH) bastion hosts</a> with <a href="https://aws.amazon.com/ec2/systems-manager/" target="_blank" rel="noopener noreferrer">Amazon EC2 Systems Manager</a> (SSM). SSM allows you to run commands on your hosts remotely, removing the need to manage bastion hosts&nbsp;or rely on SSH to execute commands. To support this objective, you must prevent your staff members from opening SSH ports to your web server’s Amazon VPC security group. If one of your staff members does modify the VPC security group to allow SSH access, you want the change to be automatically reverted and then receive a notification that the change to the security group was automatically reverted. If you are not yet familiar with security groups, see <a href="http://docs.aws.amazon.com/AmazonVPC/latest/UserGuide/VPC_SecurityGroups.html" target="_blank" rel="noopener noreferrer">Security Groups for Your VPC</a> before reading the rest of this post.<span id="more-5393"></span></p> 
<h3>Solution overview</h3> 
<p>This solution begins with a <em>directive</em> <em>control</em> to mandate that no web server should be accessible using SSH. The directive control is enforced using a <em>preventive</em> <em>control,</em> which is implemented using a security group rule that prevents ingress from port 22 (typically used for SSH). The detective control is a “listener” that identifies any changes made to your security group. Finally, the responsive control reverts changes made to the security group and then sends a notification of this security mitigation.</p> 
<p>The detective control, in this case, is an <a href="https://aws.amazon.com/cloudwatch/" target="_blank" rel="noopener noreferrer">Amazon CloudWatch</a> event that detects changes to your security group and triggers the responsive control, which in this case is an <a href="https://aws.amazon.com/lambda/" target="_blank" rel="noopener noreferrer">AWS Lambda</a> function. I use <a href="https://aws.amazon.com/cloudformation/" target="_blank" rel="noopener noreferrer">AWS CloudFormation</a> to simplify the deployment.</p> 
<p>The following diagram shows the architecture of this solution.</p> 
<p><img class="alignnone wp-image-5398 size-full" title="Solution architecture diagram" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/10/09/Annotated-Flow-FINAL.png" alt="Solution architecture diagram" width="1028" height="263" /></p> 
<p>Here is how the process works:</p> 
<ol> 
<li>Someone on your staff adds a new ingress rule to your security group.</li> 
<li>A CloudWatch event that continually monitors changes to your security groups detects the new ingress rule and invokes a designated Lambda function (with Lambda, you can run code without provisioning or managing servers).</li> 
<li>The Lambda function evaluates the event to determine whether you are monitoring this security group and reverts the new security group ingress rule.</li> 
<li>Finally, the Lambda function sends you an email to let you know what the change was, who made it, and that the change was reverted.</li> 
</ol> 
<h3>Deploy the solution by using CloudFormation</h3> 
<p>In this section, you will click the <strong>Launch Stack</strong> button shown below to launch the CloudFormation stack and deploy the solution.</p> 
<h4>Prerequisites</h4> 
<ul> 
<li>You must have <a href="https://aws.amazon.com/cloudtrail/" target="_blank" rel="noopener noreferrer">AWS CloudTrail</a> already enabled in the AWS Region where you will be deploying the solution. CloudTrail lets you log, continuously monitor, and retain events related to API calls across your AWS infrastructure. See <a href="http://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-getting-started.html" target="_blank" rel="noopener noreferrer">Getting Started with CloudTrail</a> for more information.</li> 
<li>You must have a default VPC in the region in which you will be deploying the solution. AWS accounts have one default VPC per AWS Region. If you’ve deleted your VPC, see <a href="http://docs.aws.amazon.com/AmazonVPC/latest/UserGuide/default-vpc.html#create-default-vpc" target="_blank" rel="noopener noreferrer">Creating a Default VPC</a> to recreate it.</li> 
</ul> 
<h4>Resources that this solution creates</h4> 
<p>When you launch the CloudFormation stack, it creates the following resources:</p> 
<ul> 
<li>A sample VPC security group in your default VPC, which is used as the target for reverting ingress rule changes.</li> 
<li>A CloudWatch event rule that monitors changes to your AWS infrastructure.</li> 
<li>A Lambda function that reverts changes to the security group and sends you email notifications.</li> 
<li>A permission that allows CloudWatch to invoke your Lambda function.</li> 
<li>An <a href="https://aws.amazon.com/iam/" target="_blank" rel="noopener noreferrer">AWS Identity and Access Management</a> (IAM) role with limited privileges that the Lambda function assumes when it is executed.</li> 
<li>An <a href="http://aws.amazon.com/sns/" target="_blank" rel="noopener noreferrer">Amazon SNS</a> topic to which the Lambda function publishes notifications.</li> 
</ul> 
<h4>Launch the CloudFormation stack</h4> 
<p>The link in this section uses the <span style="font-family: courier">us-east-1</span> Region (the US East [N. Virginia] Region). Change the region if you want to use this solution in a different region. See <a href="http://docs.aws.amazon.com/awsconsolehelpdocs/latest/gsg/getting-started.html#select-region" target="_blank" rel="noopener noreferrer">Selecting a Region</a> for more information about changing the region.</p> 
<p>To deploy the solution, click the following <strong>Launch Stack</strong> button to launch the stack.&nbsp;After you click the button, you must sign in to the AWS Management Console if you have not already done so.</p> 
<p><a href="https://console.aws.amazon.com/cloudformation/home?region=us-east-1#/stacks/new?stackName=security-group-change-auto-response&amp;templateURL=https://s3.amazonaws.com/awsiammedia/public/sample/revertsecuritygroupchanges/security-group-change-auto-response.yaml" target="_blank" rel="noopener noreferrer"><img class="alignnone wp-image-5399 size-full" title="Click this &quot;Launch Stack&quot; button" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/10/09/Launch-Stack.png" alt="Click this &quot;Launch Stack&quot; button" width="107" height="20" /></a></p> 
<p>Then:</p> 
<ol> 
<li>Choose <strong>Next</strong> to proceed to the <strong>Specify Details</strong> page.</li> 
<li>On the <strong>Specify Details</strong> page, type your email address in the <strong>Send notifications to</strong>&nbsp;box. This is the email address to which change notifications will be sent. (After the stack is launched, you will receive a confirmation email that you must accept before you can receive notifications.)</li> 
<li>Choose <strong>Next</strong> until you get to the <strong>Review</strong> page, and then choose the <strong>I acknowledge that AWS CloudFormation might create IAM resources</strong> check box. This confirms that you are aware that the CloudFormation template includes an IAM resource.</li> 
<li>Choose <strong>Create</strong>. CloudFormation displays the stack status, <strong>CREATE_COMPLETE</strong>, when the stack has launched completely, which should take less than two minutes.<img class="alignnone wp-image-5460 size-full" title="Screenshot showing that the stack has launched completely" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/10/10/createcomplete_RB101017-a.png" alt="Screenshot showing that the stack has launched completely" width="792" height="156" /></li> 
</ol> 
<h3>Testing the solution</h3> 
<ol> 
<li>Check your email for the SNS confirmation email. You must confirm this subscription to receive future notification emails. If you don’t confirm the subscription, your security group ingress rules still will be automatically reverted, but you will not receive notification emails.</li> 
<li>Navigate to the <a href="https://console.aws.amazon.com/ec2/v2/home" target="_blank" rel="noopener noreferrer">EC2 console</a> and choose <strong>Security Groups</strong> in the navigation pane.</li> 
<li>Choose the security group created by CloudFormation. Its name is <strong>Web Server Security Group</strong>.</li> 
<li>Choose the <strong>Inbound</strong> tab in the bottom pane of the page. Note that only one rule allows HTTPS ingress on port 443 from <span style="font-family: courier">0.0.0.0/0</span> (from anywhere).<img class="alignnone wp-image-5447 size-full" title="Screenshot showing the &quot;Inbound&quot; tab in the bottom pane of the page" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/10/10/edit-inboundtab_RB101017.png" alt="Screenshot showing the &quot;Inbound&quot; tab in the bottom pane of the page" width="912" height="549" /></li> 
</ol> 
<ol start="5"> 
<li>Choose <strong>Edit</strong> to display the <strong>Edit inbound rules</strong> dialog box (again, an inbound rule and an ingress rule are the same thing).</li> 
<li>Choose <strong>Add Rule</strong>.</li> 
<li>Choose <strong>SSH</strong> from the <strong>Type</strong> drop-down list.</li> 
<li>Choose <strong>My IP</strong> from the <strong>Source</strong> drop-down list. Your IP address is populated for you. By adding this rule, you are simulating one of your staff members violating your organization’s policy (in this blog post’s hypothetical example) against allowing SSH access to your EC2 servers. You are testing the solution created when you launched the CloudFormation stack in the previous section. The solution should remove this newly created SSH rule automatically.<br /> <img class="alignnone wp-image-5456 size-full" title="Screenshot of editing inbound rules" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/10/10/editinboundrules_RB101017-c.png" alt="Screenshot of editing inbound rules" width="1087" height="332" /></li> 
<li>Choose <strong>Save</strong>.</li> 
</ol> 
<p>Adding this rule creates an EC2 <span style="font-family: courier">AuthorizeSecurityGroupIngress</span> service event, which triggers the Lambda function created in the CloudFormation stack. After a few moments, choose the refresh button (&nbsp;<img class="alignnone wp-image-5406" title="The &quot;refresh&quot; icon" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/10/09/refresh.png" alt="The &quot;refresh&quot; icon" width="10" height="10" />&nbsp;) to see that the new SSH ingress rule that you just created has been removed by the solution you deployed earlier with the CloudFormation stack. If the rule is still there, wait a few more moments and choose the refresh button again.</p> 
<p><img class="alignnone wp-image-5450 size-full" title="Screenshot of refreshing the page to see that the SSH ingress rule has been removed" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/10/10/refreshbutton_RB101017.png" alt="Screenshot of refreshing the page to see that the SSH ingress rule has been removed" width="900" height="404" /></p> 
<p>You should also receive an email to notify you that the ingress rule was added and subsequently reverted.</p> 
<p><img class="alignnone wp-image-5455 size-full" title="Screenshot of the notification email" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/10/10/Notification-Email-a.png" alt="Screenshot of the notification email" width="769" height="550" /></p> 
<h3>Cleaning up</h3> 
<p>If you want to remove the resources created by this CloudFormation stack, you can delete the CloudFormation stack:</p> 
<ol> 
<li>Navigate to the <a href="https://console.aws.amazon.com/cloudformation/home" target="_blank" rel="noopener noreferrer">CloudFormation console</a>.</li> 
<li>Choose the stack that you created earlier.</li> 
<li>Choose the <strong>Actions</strong> drop-down list.</li> 
<li>Choose <strong>Delete Stack</strong>, and then choose <strong>Yes, Delete</strong>.</li> 
<li>CloudFormation will display a status of <strong>DELETE_IN_PROGRESS</strong> while it deletes the resources created with the stack. After a few moments, the stack should no longer appear in the list of completed stacks.<br /> <img class="alignnone wp-image-5458 size-full" title="Screenshot of stack &quot;DELETE_IN_PROGRESS&quot;" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/10/10/deleteinprogress_RB101017-a.png" alt="Screenshot of stack &quot;DELETE_IN_PROGRESS&quot;" width="795" height="157" /></li> 
</ol> 
<h3>Other applications of this solution</h3> 
<p>I have shown one way to use multiple AWS services to help continuously ensure that your security controls haven’t deviated from your security baseline. However, you also could use the <a href="https://github.com/awslabs/aws-security-benchmark" target="_blank" rel="noopener noreferrer">CIS Amazon Web Services Foundations Benchmarks</a>, for example, to establish a governance baseline across your AWS accounts and then use the principles in this blog post to automatically mitigate changes to that baseline.</p> 
<p>To scale this solution, you can create a framework that uses <a href="https://aws.amazon.com/answers/account-management/aws-tagging-strategies/" target="_blank" rel="noopener noreferrer">resource tags</a> to identify particular resources for monitoring. You also can use a consolidated monitoring approach by using cross-account event delivery. See <a href="http://docs.aws.amazon.com/AmazonCloudWatch/latest/events/CloudWatchEvents-CrossAccountEventDelivery.html" target="_blank" rel="noopener noreferrer">Sending and Receiving Events Between AWS Accounts</a> for more information. You also can extend the principle of automatic mitigation to detect and revert changes to other resources such as IAM policies and <a href="https://aws.amazon.com/s3/" target="_blank" rel="noopener noreferrer">Amazon S3</a> bucket policies.</p> 
<h3>Summary</h3> 
<p>In this blog post, I demonstrated how you can automatically revert changes to a VPC security group and have a notification sent about the changes. You can use this solution in your own AWS accounts to enforce your security requirements continuously.</p> 
<p>If you have comments about this blog post or other ideas for ways to use this solution, submit a comment in the “Comments” section below. If you have implementation questions, start a new thread in the <a href="https://forums.aws.amazon.com/forum.jspa?forumID=30" target="_blank" rel="noopener noreferrer">EC2 forum</a> or <a href="https://console.aws.amazon.com/support/home" target="_blank" rel="noopener noreferrer">contact AWS Support</a>.</p> 
<p>– Rob</p> 
<footer> 
TAGS: 
<span property="keywords"><a href="https://aws.amazon.com/blogs/security/tag/amazon-vpc-vpc-security-groups-amazon-ec2-amazon-ec2-systems-manager-secure-shell-ssh-bastion-hosts-aws-cloudformation-aws-lambda-amazon-cloudwatch-detective-controls/" rel="tag">Amazon VPC | VPC security groups | Amazon EC2 | Amazon EC2 Systems Manager | Secure Shell | SSH | bastion hosts | AWS CloudFormation | AWS Lambda | Amazon CloudWatch | detective controls</a>, <a href="https://aws.amazon.com/blogs/security/tag/responsive-controls/" rel="tag">responsive controls</a></span> 
</footer> 
<script>
require(['blog'], function() {
AWS.Blog.commenting('#aws-comment-trigger-5393');
});
</script> 
</article> 
<article class="post" vocab="http://schema.org/" typeof="TechArticle"> 
<meta property="inLanguage" content="en-US" /> 
<b><a href="https://aws.amazon.com/blogs/security/join-us-for-aws-iam-day-on-monday-october-16-in-new-york-city/" property="url" rel="bookmark"><span property="name headline">Join Us for AWS IAM Day on Monday, October 16, in New York City</span></a></b> 
<footer class="meta">
by 
<span property="author" typeof="Person"><a href="https://aws.amazon.com/blogs/security/author/clieb/" title="Posts by Craig Liebendorfer" property="name">Craig Liebendorfer</a></span> | on 
<time property="datePublished" datetime="2017-10-10T08:01:51+00:00">10 OCT 2017</time> | in 
<span class="categories"><a href="https://aws.amazon.com/blogs/security/category/security-identity-compliance/aws-identity-and-access-management-iam/" title="View all posts in AWS Identity and Access Management (IAM)*"><span property="articleSection">AWS Identity and Access Management (IAM)*</span></a>, <a href="https://aws.amazon.com/blogs/security/category/events/" title="View all posts in Events*"><span property="articleSection">Events*</span></a></span> | 
<a href="https://aws.amazon.com/blogs/security/join-us-for-aws-iam-day-on-monday-october-16-in-new-york-city/" property="url">Permalink</a> | 
<a id="aws-comment-trigger-5373" href="https://commenting.awsblogs.com/embed.html?disqus_shortname=aws-security-blog&amp;disqus_identifier=5373&amp;disqus_title=Join+Us+for+AWS+IAM+Day+on+Monday%2C+October+16%2C+in+New+York+City&amp;disqus_url=https://aws.amazon.com/blogs/security/join-us-for-aws-iam-day-on-monday-october-16-in-new-york-city/" data-sandbox-attr="allow-forms allow-scripts allow-popups allow-same-origin" property="discussionUrl"><i class="icon-comment"></i> Comments</a> 
<script>
require(['blog'], function() {
AWS.Blog.commenting('#aws-comment-trigger-5373');
});
</script> | 
<a href="#" role="button" data-share-dialog=""><span class="span icon-share"></span>&nbsp;Share</a> 
<ul> 
</ul> 
</footer> 
<p><img class="alignnone wp-image-5374 size-full" title="AWS IAM Day image" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/10/05/Marketo_1200x350_NYC_1200x2501.png" alt="" width="1201" height="250" /></p> 
<p>Join us in&nbsp;New York City at the AWS Pop-up Loft for AWS IAM Day on Monday,<strong>&nbsp;</strong>October 16, from 9:30 A.M.–4:15 P.M. Eastern Time. At this free technical event,&nbsp;you will learn&nbsp;<a href="https://aws.amazon.com/iam/" target="_blank" rel="noopener noreferrer">AWS Identity and Access Management</a> (IAM) concepts from IAM product managers, as well as tools and strategies you can use for controlling access to your AWS environment, such as&nbsp;the IAM policy language and IAM best practices.&nbsp;You also will take an IAM policy ninja dive deep into permissions and how to use IAM roles to delegate access to your AWS resources. Last, you will learn how to integrate Active Directory with AWS workloads.</p> 
<p>You can attend one session or stay for the full day.</p> 
<p>Learn more about the available sessions and <a href="https://pages.awscloud.com/namer_ny-IAMDay_October_2017_RegistrationPage.html" target="_blank" rel="noopener noreferrer">register</a>!</p> 
<p>– Craig</p> 
</article> 
<article class="post" vocab="http://schema.org/" typeof="TechArticle"> 
<meta property="inLanguage" content="en-US" /> 
<b><a href="https://aws.amazon.com/blogs/security/join-us-for-aws-iam-day-on-monday-october-9-in-san-francisco/" property="url" rel="bookmark"><span property="name headline">Join Us for AWS IAM Day on Monday, October 9, in San Francisco</span></a></b> 
<footer class="meta">
by 
<span property="author" typeof="Person"><a href="https://aws.amazon.com/blogs/security/author/clieb/" title="Posts by Craig Liebendorfer" property="name">Craig Liebendorfer</a></span> | on 
<time property="datePublished" datetime="2017-10-05T08:48:41+00:00">05 OCT 2017</time> | in 
<span class="categories"><a href="https://aws.amazon.com/blogs/security/category/security-identity-compliance/aws-identity-and-access-management-iam/" title="View all posts in AWS Identity and Access Management (IAM)*"><span property="articleSection">AWS Identity and Access Management (IAM)*</span></a>, <a href="https://aws.amazon.com/blogs/security/category/events/" title="View all posts in Events*"><span property="articleSection">Events*</span></a></span> | 
<a href="https://aws.amazon.com/blogs/security/join-us-for-aws-iam-day-on-monday-october-9-in-san-francisco/" property="url">Permalink</a> | 
<a id="aws-comment-trigger-5365" href="https://commenting.awsblogs.com/embed.html?disqus_shortname=aws-security-blog&amp;disqus_identifier=5365&amp;disqus_title=Join+Us+for+AWS+IAM+Day+on+Monday%2C+October+9%2C+in+San+Francisco&amp;disqus_url=https://aws.amazon.com/blogs/security/join-us-for-aws-iam-day-on-monday-october-9-in-san-francisco/" data-sandbox-attr="allow-forms allow-scripts allow-popups allow-same-origin" property="discussionUrl"><i class="icon-comment"></i> Comments</a> 
<script>
require(['blog'], function() {
AWS.Blog.commenting('#aws-comment-trigger-5365');
});
</script> | 
<a href="#" role="button" data-share-dialog=""><span class="span icon-share"></span>&nbsp;Share</a> 
<ul> 
</ul> 
</footer> 
<p><img class="alignnone wp-image-5366 size-full" title="AWS IAM Day image" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/10/05/Marketo_1200x350_SF_1200x2501.png" alt="" width="1201" height="251" /></p> 
<p>Join us in San Francisco at the AWS Pop-up Loft for AWS IAM Day on Monday,<strong>&nbsp;</strong>October 9, from 9:30 A.M.–4:15 P.M. Pacific Time. At this free technical event,&nbsp;you will learn&nbsp;<a href="https://aws.amazon.com/iam/" target="_blank" rel="noopener noreferrer">AWS Identity and Access Management</a> (IAM) concepts from IAM product managers, as well as tools and strategies you can use for controlling access to your AWS environment, such as&nbsp;the IAM policy language and IAM best practices.&nbsp;You also will take an IAM policy ninja dive deep into permissions and how to use IAM roles to delegate access to your AWS resources. Last, you will learn how to integrate Active Directory with AWS workloads.</p> 
<p>You can attend one session or stay for the full day.</p> 
<p>Learn more about the available sessions and <a href="https://pages.awscloud.com/namer_sf-IAMDay_October_2017_RegistrationPage.html" target="_blank" rel="noopener noreferrer">register</a>!</p> 
<p>– Craig</p> 
</article> 
<article class="post" vocab="http://schema.org/" typeof="TechArticle"> 
<meta property="inLanguage" content="en-US" /> 
<b><a href="https://aws.amazon.com/blogs/security/join-aws-security-for-a-night-of-trivia-at-grace-hopper-2017/" property="url" rel="bookmark"><span property="name headline">Join AWS Security on October 4 for a Night of Trivia at Grace Hopper Celebration 2017</span></a></b> 
<footer class="meta">
by 
<span property="author" typeof="Person"><span property="name">Sara Duffer</span></span> | on 
<time property="datePublished" datetime="2017-10-02T10:44:12+00:00">02 OCT 2017</time> | in 
<span class="categories"><a href="https://aws.amazon.com/blogs/security/category/events/" title="View all posts in Events*"><span property="articleSection">Events*</span></a>, <a href="https://aws.amazon.com/blogs/security/category/security-identity-compliance/" title="View all posts in Security, Identity &amp; Compliance*"><span property="articleSection">Security, Identity &amp; Compliance*</span></a></span> | 
<a href="https://aws.amazon.com/blogs/security/join-aws-security-for-a-night-of-trivia-at-grace-hopper-2017/" property="url">Permalink</a> | 
<a id="aws-comment-trigger-5349" href="https://commenting.awsblogs.com/embed.html?disqus_shortname=aws-security-blog&amp;disqus_identifier=5349&amp;disqus_title=Join+AWS+Security+on+October+4+for+a+Night+of+Trivia+at+Grace+Hopper+Celebration+2017&amp;disqus_url=https://aws.amazon.com/blogs/security/join-aws-security-for-a-night-of-trivia-at-grace-hopper-2017/" data-sandbox-attr="allow-forms allow-scripts allow-popups allow-same-origin" property="discussionUrl"><i class="icon-comment"></i> Comments</a> 
<script>
require(['blog'], function() {
AWS.Blog.commenting('#aws-comment-trigger-5349');
});
</script> | 
<a href="#" role="button" data-share-dialog=""><span class="span icon-share"></span>&nbsp;Share</a> 
<ul> 
</ul> 
</footer> 
<p><img class="alignnone wp-image-5357 size-full" title="AWS Security Jam image" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/10/02/EV_security-jam-2017-hero-bannerv3_1200x325_Oct-20171.jpg" alt="AWS Security Jam image" width="1200" height="325" /></p> 
<p>If you’re attending this year’s&nbsp;<a href="http://ghc.anitaborg.org/" target="_blank" rel="noopener noreferrer">Grace Hopper Celebration</a>&nbsp;in Orlando, AWS is&nbsp;<a href="https://pages.awscloud.com/event_NAMER_Security-Jam-Grace-Hopper.html" target="_blank" rel="noopener noreferrer">inviting all attendees</a> to join us for a free evening of learning and networking. This AWS Security Jam will feature an opportunity to learn more about the AWS Security team (and about AWS security), socialize with peers, and engage in a night of trivia with your fellow conference friends. We will provide light appetizers and drinks.&nbsp;<a href="https://pages.awscloud.com/event_NAMER_Security-Jam-Grace-Hopper.html" target="_blank" rel="noopener noreferrer">RSVP today</a>.</p> 
<ul> 
<li><strong>Day:</strong> Wednesday, October 4, 2017</li> 
<li><strong>Time:</strong>&nbsp;5:30–8:00&nbsp;P.M.&nbsp;Eastern Time</li> 
<li><strong>Location:</strong>&nbsp;Rosen Centre Hotel Executive Ballroom, 9840 International Drive, Orlando, FL 32819 (next to the Orange County Convention Center)</li> 
</ul> 
<p>The first 150 attendees will win a door prize, and we will give additional prizes as part of a raffle at the end of the event. Follow us on Twitter <a href="https://twitter.com/awssecurityinfo" target="_blank" rel="noopener noreferrer">@AWSSecurityInfo</a> for more information and updates about all things AWS Security and Compliance.</p> 
<p>– Sara</p> 
</article> 
<article class="post" vocab="http://schema.org/" typeof="TechArticle"> 
<meta property="inLanguage" content="en-US" /> 
<b><a href="https://aws.amazon.com/blogs/security/the-top-20-aws-iam-documentation-pages-so-far-in-2017/" property="url" rel="bookmark"><span property="name headline">The Top 20 AWS IAM Documentation Pages so Far in 2017</span></a></b> 
<footer class="meta">
by 
<span property="author" typeof="Person"><span property="name">Stephenie Swope</span></span> | on 
<time property="datePublished" datetime="2017-10-02T08:34:25+00:00">02 OCT 2017</time> | in 
<span class="categories"><a href="https://aws.amazon.com/blogs/security/category/security-identity-compliance/aws-identity-and-access-management-iam/" title="View all posts in AWS Identity and Access Management (IAM)*"><span property="articleSection">AWS Identity and Access Management (IAM)*</span></a></span> | 
<a href="https://aws.amazon.com/blogs/security/the-top-20-aws-iam-documentation-pages-so-far-in-2017/" property="url">Permalink</a> | 
<a id="aws-comment-trigger-5325" href="https://commenting.awsblogs.com/embed.html?disqus_shortname=aws-security-blog&amp;disqus_identifier=5325&amp;disqus_title=The+Top+20+AWS+IAM+Documentation+Pages+so+Far+in+2017&amp;disqus_url=https://aws.amazon.com/blogs/security/the-top-20-aws-iam-documentation-pages-so-far-in-2017/" data-sandbox-attr="allow-forms allow-scripts allow-popups allow-same-origin" property="discussionUrl"><i class="icon-comment"></i> Comments</a> 
<script>
require(['blog'], function() {
AWS.Blog.commenting('#aws-comment-trigger-5325');
});
</script> | 
<a href="#" role="button" data-share-dialog=""><span class="span icon-share"></span>&nbsp;Share</a> 
<ul> 
</ul> 
</footer> 
<p style="text-align: center"><img class="alignnone wp-image-5332 size-full" title="AWS IAM image" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/29/4990-IDAS_IAM_bhv3_IAM_email.png" alt="AWS IAM image" width="600" height="300" /></p> 
<p>The following 20 pages have been the most viewed AWS Identity and Access Management (IAM) documentation pages so far this year. I have included a brief description with each link to explain what each page covers. Use this list to see what other AWS customers have been viewing and perhaps to pique your own interest about a topic you’ve been meaning to learn about.</p> 
<ol> 
<li><a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/introduction.html" target="_blank" rel="noopener noreferrer">What Is IAM?</a><br /> Learn more about IAM, a web service that helps you securely control access to AWS resources for your users. You use IAM to control who can use your AWS resources (authentication) and how they can use resources (authorization).</li> 
<li><a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/id_users_create.html" target="_blank" rel="noopener noreferrer">Creating an IAM User in Your AWS Account</a><br /> You can create one or more IAM users in your AWS account. You might create an IAM user when someone joins your organization, or when you have a new application that needs to make API calls to AWS.</li> 
<li><a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements.html" target="_blank" rel="noopener noreferrer">IAM Policy Elements Reference</a><br /> Learn more about the elements that you can use when you create a policy. View additional policy examples and learn about conditions, supported data types, and how they are used in various services.</li> 
<li><a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html" target="_blank" rel="noopener noreferrer">Managing Access Keys for IAM Users</a><br /> Users need their own access keys to make programmatic calls to AWS from the AWS Command Line Interface (AWS CLI), Tools for Windows PowerShell, the AWS SDKs, or direct HTTP calls using the APIs for individual AWS services. To fill this need, you can create, modify, view, or rotate access keys (access key IDs and secret access keys) for IAM users.</li> 
<li><a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html" target="_blank" rel="noopener noreferrer">IAM Best Practices</a><br /> To help secure your AWS resources, follow these best practices for IAM.</li> 
<li><a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/tutorial_billing.html" target="_blank" rel="noopener noreferrer">Tutorial: Delegate Access to the Billing Console</a><br /> Learn how to&nbsp;delegate access to specific IAM users who need to view or manage AWS Billing and Cost Management data for an AWS account.</li> 
<li><a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/console.html" target="_blank" rel="noopener noreferrer">The IAM Console and the Sign-in Page</a><br /> Learn about the IAM-enabled AWS Management Console sign-in page and how to sign in as an AWS account root user or as an IAM user. To help your users sign in easily, create a unique sign-in URL for your account.</li> 
<li><a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/getting-started_how-users-sign-in.html" target="_blank" rel="noopener noreferrer">How Users Sign In to Your Account</a><br /> After you create IAM users and passwords for each, your users can sign in to the AWS Management Console for your AWS account using your account ID or alias, or from a special URL that includes your account ID.</li> 
<li><a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa.html" target="_blank" rel="noopener noreferrer">Using Multi-Factor Authentication (MFA) in AWS</a><br /> For increased security, AWS recommends that you configure MFA to help protect your AWS resources. MFA adds extra security because it requires users to enter a unique authentication code from an approved authentication device or SMS text message when they access AWS websites or services.</li> 
<li><a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_server-certs.html" target="_blank" rel="noopener noreferrer">Working with Server Certificates</a><br /> Some AWS services can use server certificates that you manage with IAM or AWS Certificate Manager (ACM).&nbsp;ACM is the preferred tool to provision, manage, and deploy your server certificates. Use IAM as a certificate manager only when you must support HTTPS connections in a region that is not supported by ACM.</li> 
<li><a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa_enable_virtual.html" target="_blank" rel="noopener noreferrer">Enabling a Virtual MFA Device</a><br /> Learn how to enable and manage virtual MFA devices from the AWS Management Console.</li> 
<li><a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies.html" target="_blank" rel="noopener noreferrer">Overview of IAM Policies</a><br /> Read an overview of IAM policies, which&nbsp;define permissions.</li> 
<li><a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/console_account-alias.html" target="_blank" rel="noopener noreferrer">Your AWS Account ID and Its Alias</a><br /> Learn how to find your AWS account ID and its alias.</li> 
<li><a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles.html" target="_blank" rel="noopener noreferrer">IAM Roles</a><br /> You can delegate access to AWS resources using an IAM role.&nbsp;A role is similar to a user because it is an AWS identity with permission policies that determine what the identity can and cannot do in AWS. However, instead of being uniquely associated with one person, a role is intended to be assumable by anyone who needs it.</li> 
<li><a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_examples.html" target="_blank" rel="noopener noreferrer">Example Policies</a><br /> This collection of policies can help you define permissions for your IAM identities.</li> 
<li><a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-ec2.html" target="_blank" rel="noopener noreferrer">Using an IAM Role to Grant Permissions to Applications Running on Amazon EC2 Instances</a><br /> Use an IAM role to manage temporary credentials for applications that run on an EC2 instance. When you use a role, you do not have to distribute long-term credentials to an EC2 instance. Instead, the role supplies temporary permissions that applications can use when they make calls to other AWS resources.</li> 
<li><a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html" target="_blank" rel="noopener noreferrer">Tutorial: Delegate Access Across AWS Accounts Using IAM Roles</a><br /> Learn how to use an IAM role to delegate access to resources that are in different AWS accounts that you own.</li> 
<li><a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/getting-started_create-admin-group.html" target="_blank" rel="noopener noreferrer">Creating Your First IAM Admin User and Group</a><br /> Learn how to create an IAM group, grant the group full permissions for all AWS services, and then create an administrative IAM user for yourself by adding the user to the IAM group.</li> 
<li><a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-ec2_instance-profiles.html" target="_blank" rel="noopener noreferrer">Using Instance Profiles</a><br /> An instance profile is a container for an IAM role that you can use to pass role information to an EC2 instance when the instance starts. Use the commands on this page to work with instance profiles in an AWS account</li> 
<li><a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp.html" target="_blank" rel="noopener noreferrer">Temporary Security Credentials</a><br /> You can use the AWS Security Token Service (AWS STS) to create and provide trusted users with temporary security credentials that can control access to your AWS resources. Temporary security credentials work almost identically to the long-term access key credentials that your IAM users can use.</li> 
</ol> 
<p>In the “Comments” section below, let us know if you would like to see anything on these or other IAM documentation pages expanded or updated to make it more useful to you.</p> 
<p>–&nbsp;Stephenie</p> 
</article> 
<article class="post" vocab="http://schema.org/" typeof="TechArticle"> 
<meta property="inLanguage" content="en-US" /> 
<b><a href="https://aws.amazon.com/blogs/security/aws-eu-london-region-selected-to-provide-services-to-support-uk-law-enforcement-customers/" property="url" rel="bookmark"><span property="name headline">AWS EU (London) Region Selected to Provide Services to Support UK Law Enforcement Customers</span></a></b> 
<footer class="meta">
by 
<span property="author" typeof="Person"><span property="name">Oliver Bell</span></span> | on 
<time property="datePublished" datetime="2017-10-02T06:37:37+00:00">02 OCT 2017</time> | in 
<span class="categories"><a href="https://aws.amazon.com/blogs/security/category/security-identity-compliance/compliance/" title="View all posts in Compliance*"><span property="articleSection">Compliance*</span></a></span> | 
<a href="https://aws.amazon.com/blogs/security/aws-eu-london-region-selected-to-provide-services-to-support-uk-law-enforcement-customers/" property="url">Permalink</a> | 
<a id="aws-comment-trigger-5340" href="https://commenting.awsblogs.com/embed.html?disqus_shortname=aws-security-blog&amp;disqus_identifier=5340&amp;disqus_title=AWS+EU+%28London%29+Region+Selected+to+Provide+Services+to+Support+UK+Law+Enforcement+Customers&amp;disqus_url=https://aws.amazon.com/blogs/security/aws-eu-london-region-selected-to-provide-services-to-support-uk-law-enforcement-customers/" data-sandbox-attr="allow-forms allow-scripts allow-popups allow-same-origin" property="discussionUrl"><i class="icon-comment"></i> Comments</a> 
<script>
require(['blog'], function() {
AWS.Blog.commenting('#aws-comment-trigger-5340');
});
</script> | 
<a href="#" role="button" data-share-dialog=""><span class="span icon-share"></span>&nbsp;Share</a> 
<ul> 
</ul> 
</footer> 
<p><img class="alignnone wp-image-5343 size-full" title="AWS Compliance image" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/30/SecurityDesignAWS1-1.png" alt="AWS Compliance image" width="800" height="200" /></p> 
<p>The AWS EU (London) Region has been selected to provide services to support UK law enforcement customers. This decision followed an assessment by <a href="https://hodigital.blog.gov.uk/" target="_blank" rel="noopener noreferrer">Home Office Digital, Data and Technology</a> supported by their colleagues in the National Policing Information Risk Management Team (NPIRMT) to determine the region’s suitability for addressing their specific needs.</p> 
<p>The security, privacy, and protection of AWS customers are AWS’s first priority. We are committed to supporting Public Sector, Blue Light, Justice, and Public Safety organizations. We hope that other organizations in these sectors will now be encouraged to consider AWS services when addressing their own requirements, including the challenge of providing modern, scalable technologies that can meet their ever-evolving business demands.</p> 
<p>– Oliver</p> 
</article> 
<article class="post" vocab="http://schema.org/" typeof="TechArticle"> 
<meta property="inLanguage" content="en-US" /> 
<b><a href="https://aws.amazon.com/blogs/security/register-for-and-attend-this-september-28-tech-talk-how-to-use-aws-waf-to-mitigate-owasp-top-10-attacks/" property="url" rel="bookmark"><span property="name headline">Register for and Attend this September 28 Tech Talk: “How to Use AWS WAF to Mitigate OWASP Top 10 Attacks”</span></a></b> 
<footer class="meta">
by 
<span property="author" typeof="Person"><a href="https://aws.amazon.com/blogs/security/author/clieb/" title="Posts by Craig Liebendorfer" property="name">Craig Liebendorfer</a></span> | on 
<time property="datePublished" datetime="2017-09-27T12:03:29+00:00">27 SEP 2017</time> | in 
<span class="categories"><a href="https://aws.amazon.com/blogs/security/category/security-identity-compliance/aws-waf/" title="View all posts in AWS WAF*"><span property="articleSection">AWS WAF*</span></a>, <a href="https://aws.amazon.com/blogs/security/category/events/" title="View all posts in Events*"><span property="articleSection">Events*</span></a>, <a href="https://aws.amazon.com/blogs/security/category/how-to/" title="View all posts in How-To*"><span property="articleSection">How-To*</span></a></span> | 
<a href="https://aws.amazon.com/blogs/security/register-for-and-attend-this-september-28-tech-talk-how-to-use-aws-waf-to-mitigate-owasp-top-10-attacks/" property="url">Permalink</a> | 
<a id="aws-comment-trigger-5311" href="https://commenting.awsblogs.com/embed.html?disqus_shortname=aws-security-blog&amp;disqus_identifier=5311&amp;disqus_title=Register+for+and+Attend+this+September+28+Tech+Talk%3A+%26%238220%3BHow+to+Use+AWS+WAF+to+Mitigate+OWASP+Top+10+Attacks%26%238221%3B&amp;disqus_url=https://aws.amazon.com/blogs/security/register-for-and-attend-this-september-28-tech-talk-how-to-use-aws-waf-to-mitigate-owasp-top-10-attacks/" data-sandbox-attr="allow-forms allow-scripts allow-popups allow-same-origin" property="discussionUrl"><i class="icon-comment"></i> Comments</a> 
<script>
require(['blog'], function() {
AWS.Blog.commenting('#aws-comment-trigger-5311');
});
</script> | 
<a href="#" role="button" data-share-dialog=""><span class="span icon-share"></span>&nbsp;Share</a> 
<ul> 
</ul> 
</footer> 
<p><img class="alignnone" title="AWS Online Tech Talks banner" src="https://d0.awsstatic.com/Digital%20Marketing/Webinar/webinar_banner.png" alt="AWS Online Tech Talks banner" width="1180" height="200" align="middle" /></p> 
<p>&nbsp;</p> 
<p><strong>October 1, 2017, update:</strong> This webinar is now available as an <a href="https://www.youtube.com/watch?v=uIGXYtBWaA0" target="_blank" rel="noopener noreferrer">on-demand video</a> and <a href="https://www.slideshare.net/AmazonWebServices/how-to-use-aws-waf-to-mitigate-owasp-top-10-attacks-aws-online-tech-talks" target="_blank" rel="noopener noreferrer">slide deck</a>.</p> 
<hr /> 
<p>As part of the AWS Online Tech Talks series, AWS will present&nbsp;<a href="https://pages.awscloud.com/registration_092817_How-to-use-AWS-WAF-to-Mitigate-OWASP-Top-10-Attacks.html" target="_blank" rel="noopener noreferrer">How to Use AWS WAF to Mitigate OWASP Top 10 Attacks</a>&nbsp;on Thursday, September 28. This tech talk will start at 9:00 A.M. Pacific Time and end at 9:40 A.M. Pacific Time.</p> 
<p>The <a href="https://www.owasp.org/index.php/Top_10_2017-Top_10" target="_blank" rel="noopener noreferrer">Open Web Application Security Project (OWASP) Top 10</a> identifies the most critical vulnerabilities that web developers must address in their applications. AWS WAF, a web application firewall, helps you address the vulnerabilities identified in the OWASP Top 10. In this webinar, you will learn how to use AWS WAF to write rules to match common patterns of exploitation and block malicious requests from reaching your web servers.</p> 
<p>You also will learn how to:</p> 
<ul> 
<li>Secure your web applications.</li> 
<li>Configure AWS Shield and AWS WAF.</li> 
<li>Defend against the most common layer 7 attacks.</li> 
</ul> 
<p>This tech talk is free.&nbsp;<a href="https://pages.awscloud.com/registration_092817_How-to-use-AWS-WAF-to-Mitigate-OWASP-Top-10-Attacks.html" target="_blank" rel="noopener noreferrer">Register today</a>.</p> 
<p>–&nbsp;Craig</p> 
</article> 
<article class="post" vocab="http://schema.org/" typeof="TechArticle"> 
<meta property="inLanguage" content="en-US" /> 
<b><a href="https://aws.amazon.com/blogs/security/amazon-cognito-user-pools-now-integrates-with-amazon-pinpoint-to-add-analytics-for-user-pools/" property="url" rel="bookmark"><span property="name headline">Amazon Cognito User Pools Now Integrates with Amazon Pinpoint to Add Analytics for User Pools</span></a></b> 
<footer class="meta">
by 
<span property="author" typeof="Person"><a href="https://aws.amazon.com/blogs/security/author/clieb/" title="Posts by Craig Liebendorfer" property="name">Craig Liebendorfer</a></span> | on 
<time property="datePublished" datetime="2017-09-27T11:29:50+00:00">27 SEP 2017</time> | in 
<span class="categories"><a href="https://aws.amazon.com/blogs/security/category/mobile-services/amazon-cognito/" title="View all posts in Amazon Cognito*"><span property="articleSection">Amazon Cognito*</span></a></span> | 
<a href="https://aws.amazon.com/blogs/security/amazon-cognito-user-pools-now-integrates-with-amazon-pinpoint-to-add-analytics-for-user-pools/" property="url">Permalink</a> | 
<a id="aws-comment-trigger-5302" href="https://commenting.awsblogs.com/embed.html?disqus_shortname=aws-security-blog&amp;disqus_identifier=5302&amp;disqus_title=Amazon+Cognito+User+Pools+Now+Integrates+with+Amazon+Pinpoint+to+Add+Analytics+for+User+Pools&amp;disqus_url=https://aws.amazon.com/blogs/security/amazon-cognito-user-pools-now-integrates-with-amazon-pinpoint-to-add-analytics-for-user-pools/" data-sandbox-attr="allow-forms allow-scripts allow-popups allow-same-origin" property="discussionUrl"><i class="icon-comment"></i> Comments</a> 
<script>
require(['blog'], function() {
AWS.Blog.commenting('#aws-comment-trigger-5302');
});
</script> | 
<a href="#" role="button" data-share-dialog=""><span class="span icon-share"></span>&nbsp;Share</a> 
<ul> 
</ul> 
</footer> 
<p style="text-align: center"><img class="alignnone wp-image-5309 size-full" title="Amazon Cognito User Pools image" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/27/Cognito_Overview_4a1.jpg" alt="Amazon Cognito User Pools image" width="1000" height="400" /></p> 
<p><a href="http://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-identity-pools.html" target="_blank" rel="noopener noreferrer">Amazon Cognito User Pools</a> now integrates with <a href="https://aws.amazon.com/pinpoint/" target="_blank" rel="noopener noreferrer">Amazon Pinpoint</a> to provide analytics for user pools and to enrich the user data for Amazon Pinpoint campaigns. Amazon Cognito User Pools provides user directories that make&nbsp;it easy to add sign-up and sign-in to your mobile or web application. Amazon Pinpoint provides analytics and targeted campaigns to drive user engagement in mobile apps by using push notifications. Using Amazon Pinpoint analytics, you can track user pool sign-ups, sign-ins, failed authentications, daily active users, and monthly active users.</p> 
<p>To learn more, see the <a href="https://aws.amazon.com/about-aws/whats-new/2017/09/amazon-cognito-integrates-with-amazon-pinpoint-to-add-analytics-for-user-pools-and-enrich-pinpoint-campaigns/" target="_blank" rel="noopener noreferrer">What’s New post</a>, the <a href="http://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-pinpoint-integration.html" target="_blank" rel="noopener noreferrer">Amazon Cognito Developer Guide</a>, and the <a href="http://docs.aws.amazon.com/pinpoint/latest/developerguide/welcome.html" target="_blank" rel="noopener noreferrer">Amazon Pinpoint Developer Guide</a>.</p> 
<p>– Craig</p> 
</article> 
<article class="post" vocab="http://schema.org/" typeof="TechArticle"> 
<meta property="inLanguage" content="en-US" /> 
<b class="b post-title" property="name headline">How to Enable LDAPS for Your AWS Microsoft AD Directory</b> 
<footer class="meta">
by 
<span property="author" typeof="Person"><span property="name">Vijay Sharma</span></span> | on 
<time property="datePublished" datetime="2017-09-26T06:01:19+00:00">26 SEP 2017</time> | in 
<span class="categories"><a href="https://aws.amazon.com/blogs/security/category/security-identity-compliance/aws-directory-service/" title="View all posts in AWS Directory Service*"><span property="articleSection">AWS Directory Service*</span></a>, <a href="https://aws.amazon.com/blogs/security/category/how-to/" title="View all posts in How-To*"><span property="articleSection">How-To*</span></a></span> | 
<a href="https://aws.amazon.com/blogs/security/how-to-enable-ldaps-for-your-aws-microsoft-ad-directory/" property="url">Permalink</a> | 
<a id="aws-comment-trigger-5161" href="https://commenting.awsblogs.com/embed.html?disqus_shortname=aws-security-blog&amp;disqus_identifier=5161&amp;disqus_title=How+to+Enable+LDAPS+for+Your+AWS+Microsoft+AD+Directory&amp;disqus_url=https://aws.amazon.com/blogs/security/how-to-enable-ldaps-for-your-aws-microsoft-ad-directory/" data-sandbox-attr="allow-forms allow-scripts allow-popups allow-same-origin" property="discussionUrl"><i class="icon-comment"></i> Comments</a> 
<script>
require(['blog'], function() {
AWS.Blog.commenting('#aws-comment-trigger-5161');
});
</script> | 
<a href="#" role="button" data-share-dialog=""><span class="span icon-share"></span>&nbsp;Share</a> 
<ul> 
</ul> 
</footer> 
<p>Starting today, you can encrypt the <a href="http://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms_ad_ldap.html" target="_blank" rel="noopener noreferrer">Lightweight Directory Access Protocol</a> (LDAP) communications between your applications and <a href="https://aws.amazon.com/directoryservice/" target="_blank" rel="noopener noreferrer">AWS Directory Service for Microsoft Active Directory</a>, also known as AWS Microsoft AD. Many Windows and Linux applications use Active Directory’s (AD) LDAP service to read and write sensitive information about users and devices, including personally identifiable information (PII). Now, you can encrypt your AWS Microsoft AD LDAP communications end to end to protect this information by using LDAP Over Secure Sockets Layer (SSL)/Transport Layer Security (TLS), also called LDAPS. This helps you protect PII and other sensitive information exchanged with AWS Microsoft AD over untrusted networks.</p> 
<p>To enable LDAPS, you need to add a <a href="https://msdn.microsoft.com/en-us/library/cc875810.aspx" target="_blank" rel="noopener noreferrer">Microsoft enterprise Certification Authority (CA)</a> server to your AWS Microsoft AD domain and configure certificate templates for your domain controllers. After you have enabled LDAPS, AWS Microsoft AD encrypts communications with LDAPS-enabled Windows applications, Linux computers that use Secure Shell (SSH) authentication, and applications such as <a href="https://www.atlassian.com/software/jira" target="_blank" rel="noopener noreferrer">Jira</a> and <a href="https://jenkins.io/" target="_blank" rel="noopener noreferrer">Jenkins</a>.</p> 
<p>In this blog post, I show how to enable LDAPS for your AWS Microsoft AD directory in six steps: 1) Delegate permissions to CA administrators, 2) Add a Microsoft enterprise CA to your AWS Microsoft AD directory, 3) Create a certificate template, 4) Configure AWS security group rules, 5) AWS Microsoft AD enables LDAPS, and 6) Test LDAPS access using the LDP tool.<span id="more-5161"></span></p> 
<h3>Assumptions</h3> 
<p>For this post, I assume you are familiar with following:</p> 
<ul> 
<li><a href="http://docs.aws.amazon.com/AWSEC2/latest/WindowsGuide/EC2_GetStarted.html" target="_blank" rel="noopener noreferrer">Creating an Amazon EC2 for Windows Server instance</a> and <a href="https://aws.amazon.com/blogs/aws/seamlessly-join-ec2-instances-to-a-domain/" target="_blank" rel="noopener noreferrer">seamlessly joining it to your AWS Microsoft AD domain</a>.</li> 
<li>Logging in to an <a href="http://docs.aws.amazon.com/AWSEC2/latest/WindowsGuide/connecting_to_windows_instance.html" target="_blank" rel="noopener noreferrer">Amazon EC2 for Windows Server instance using Remote Desktop Protocol (RDP)</a>.</li> 
<li>Launching and using <a href="https://technet.microsoft.com/en-us/library/cc732131(v=ws.10).aspx" target="_blank" rel="noopener noreferrer">Microsoft Windows Server Manager</a>.</li> 
<li>Launching <a href="https://docs.microsoft.com/en-us/powershell/scripting/setup/starting-windows-powershell-on-earlier-versions-of-windows?view=powershell-5.1" target="_blank" rel="noopener noreferrer">Windows PowerShell with administrative privileges</a> and <a href="https://docs.microsoft.com/en-us/powershell/scripting/core-powershell/ise/how-to-write-and-run-scripts-in-the-windows-powershell-ise?view=powershell-5.1" target="_blank" rel="noopener noreferrer">running Windows PowerShell scripts</a>.</li> 
</ul> 
<h3>Solution overview</h3> 
<p>Before going into specific deployment steps, I will provide a high-level overview of deploying LDAPS. I cover how you enable LDAPS on AWS Microsoft AD. In addition, I provide some general background about CA deployment models&nbsp;and explain how to apply these models when deploying Microsoft CA to enable LDAPS on AWS Microsoft AD.</p> 
<h4>How you enable LDAPS on AWS Microsoft AD</h4> 
<p>LDAP-aware applications (LDAP clients) typically access LDAP servers using Transmission Control Protocol (TCP) on port 389. By default, LDAP communications on port 389 are unencrypted. However, many LDAP clients use one of two standards to encrypt LDAP communications: LDAP over SSL on port 636, and LDAP with <a href="https://tools.ietf.org/html/rfc2830" target="_blank" rel="noopener noreferrer">StartTLS</a> on port 389. If an LDAP client uses port 636, the LDAP server encrypts all traffic unconditionally with SSL. If an LDAP client issues a StartTLS command when setting up the LDAP session on port 389, the LDAP server encrypts all traffic to that client with TLS. AWS Microsoft AD now supports both encryption standards when you enable LDAPS on your AWS Microsoft AD domain controllers.</p> 
<p>You enable LDAPS on your AWS Microsoft AD domain controllers by installing a digital certificate that a CA issued. Though Windows servers have different methods for installing certificates, LDAPS with AWS Microsoft AD requires you to add a Microsoft CA to your AWS Microsoft AD domain and deploy the certificate through autoenrollment from the Microsoft CA. The installed certificate enables the LDAP service running on domain controllers to listen for and negotiate LDAP encryption on port 636 (LDAP over SSL) and port 389 (LDAP with StartTLS).</p> 
<h3>Background of CA deployment models</h3> 
<p>You can deploy CAs as part of a single-level or multi-level <a href="https://technet.microsoft.com/en-us/library/cc962065.aspx" target="_blank" rel="noopener noreferrer">CA hierarchy</a>. In a single-level hierarchy, all certificates come from the root of the hierarchy. In a multi-level hierarchy, you organize a collection of CAs in a hierarchy and the certificates sent to computers and users come from subordinate CAs in the hierarchy (not the root).</p> 
<p>Certificates issued by a CA identify the hierarchy to which the CA belongs. When a computer sends its certificate to another computer for verification, the receiving computer must have the public certificate from the CAs in the same hierarchy as the sender. If the CA that issued the certificate is part of a single-level hierarchy, the receiver must obtain the public certificate of the CA that issued the certificate. If the CA that issued the certificate is part of a multi-level hierarchy, the receiver can obtain a public certificate for all the CAs that are in the same hierarchy as the CA that issued the certificate. If the receiver can verify that the certificate came from a CA that is in the hierarchy of the receiver’s “trusted” public CA certificates, the receiver trusts the sender. Otherwise, the receiver rejects the sender.</p> 
<h4>Deploying Microsoft CA to enable LDAPS on AWS Microsoft AD</h4> 
<p>Microsoft offers a standalone CA and an enterprise CA. Though you can configure either as single-level or multi-level hierarchies, only the enterprise CA integrates with AD and offers autoenrollment for certificate deployment. Because you cannot sign in to run commands on your AWS Microsoft AD domain controllers, an automatic certificate enrollment model is required. Therefore, AWS Microsoft AD requires the certificate to come from a Microsoft enterprise CA that you configure to work in your AD domain. When you install the Microsoft enterprise CA, you can configure it to be part of a single-level hierarchy or a multi-level hierarchy. As a best practice, AWS recommends a multi-level <a href="https://technet.microsoft.com/en-us/library/cc962065.aspx" target="_blank" rel="noopener noreferrer">Microsoft CA trust hierarchy</a> consisting of a root CA and a subordinate CA. I cover only a multi-level hierarchy in this post.</p> 
<p>In a multi-level hierarchy, you configure your subordinate CA by importing a certificate from the root CA. You must issue a certificate from the root CA such that the certificate gives your subordinate CA the right to issue certificates on behalf of the root. This makes your subordinate CA part of the root CA hierarchy. You also deploy the root CA’s public certificate on all of your computers, which tells all your computers to trust certificates that your root CA issues and to trust certificates from any authorized subordinate CA.</p> 
<p>In such a hierarchy, you typically leave your root CA offline (inaccessible to other computers in the network) to protect the root of your hierarchy. You leave the subordinate CA online so that it can issue certificates on behalf of the root CA. This multi-level hierarchy increases security because if someone compromises your subordinate CA, you can revoke all certificates it issued and set up a new subordinate CA from your offline root CA. To learn more about setting up a secure CA hierarchy, see <a href="https://technet.microsoft.com/en-us/library/dn786436(v=ws.11).aspx" target="_blank" rel="noopener noreferrer">Securing PKI: Planning a CA Hierarchy</a>.</p> 
<p>When a Microsoft CA is part of your AD domain, you can configure certificate templates that you publish. These templates become visible to client computers through AD. If a client’s profile matches a template, the client requests a certificate from the Microsoft CA that matches the template. Microsoft calls this process <em>autoenrollment,</em> and it simplifies certificate deployment. To enable LDAPS on your AWS Microsoft AD domain controllers, you create a certificate template in the Microsoft CA that generates SSL and TLS-compatible certificates. The domain controllers see the template and automatically import a certificate of that type from the Microsoft CA. The imported certificate enables LDAP encryption.</p> 
<h3>Steps to enable LDAPS for your AWS Microsoft AD directory</h3> 
<p>The rest of this post is composed of the steps&nbsp;for enabling LDAPS for your AWS Microsoft AD directory. First, though, I explain which components you must have running to deploy this solution successfully. I also explain how this solution works and include an architecture diagram.</p> 
<h4>Prerequisites</h4> 
<p>The instructions in this post assume that you already have the following components running:</p> 
<ol> 
<li><strong>An active AWS Microsoft AD directory –</strong> To create a directory, follow the steps in <a href="http://docs.aws.amazon.com/directoryservice/latest/admin-guide/create_directory.html" target="_blank" rel="noopener noreferrer">Create an AWS Microsoft AD directory</a>.</li> 
<li><strong>An Amazon EC2 for Windows Server instance for managing users and groups in your directory </strong>– This instance needs to be <a href="https://aws.amazon.com/blogs/aws/seamlessly-join-ec2-instances-to-a-domain/" target="_blank" rel="noopener noreferrer">joined to your AWS Microsoft AD domain</a> and have <a href="http://docs.aws.amazon.com/directoryservice/latest/admin-guide/install_ad_tools.html" target="_blank" rel="noopener noreferrer">Active Directory Administration Tools</a>&nbsp;installed. Active Directory Administration Tools installs <a href="https://technet.microsoft.com/en-us/library/dd560651(v=ws.10).aspx" target="_blank" rel="noopener noreferrer">Active Directory Administrative Center</a> and the <a href="https://technet.microsoft.com/en-us/library/cc772839(v=ws.10).aspx" target="_blank" rel="noopener noreferrer">LDP tool</a>.</li> 
<li><strong>An existing root Microsoft CA or a multi-level Microsoft CA hierarchy</strong> – You might already have a root CA or a multi-level CA hierarchy in your on-premises network. If you plan to use your on-premises CA hierarchy, you must have <a href="https://technet.microsoft.com/en-us/library/dn786430(v=ws.11).aspx" target="_blank" rel="noopener noreferrer">administrative permissions to issue certificates to subordinate CAs</a>. If you do not have an existing Microsoft CA hierarchy, you can set up a new standalone Microsoft root CA by creating an Amazon EC2 for Windows Server instance and <a href="https://technet.microsoft.com/en-us/library/cc731183(v=ws.11).aspx" target="_blank" rel="noopener noreferrer">installing a standalone root certification authority</a>. You also must create a <a href="https://technet.microsoft.com/en-us/library/cc770642(v=ws.11).aspx" target="_blank" rel="noopener noreferrer">local user account</a> on this instance and add this user to the <a href="https://www.isunshare.com/windows-server/add-a-user-to-local-administrator-group.html" target="_blank" rel="noopener noreferrer">local administrator group</a> so that the user has permissions to issue a certificate to a subordinate CA.</li> 
</ol> 
<h4>The solution setup</h4> 
<p>The following diagram illustrates the setup with the steps you need to follow to enable LDAPS for AWS Microsoft AD. You will learn how to set up a subordinate Microsoft enterprise CA (in this case, <span style="font-family: courier">SubordinateCA</span>) and join it to your AWS Microsoft AD domain (in this case, <span style="font-family: courier">corp.example.com</span>).&nbsp;You also will learn how to create a certificate template on <span style="font-family: courier">SubordinateCA</span> and configure AWS security group rules to enable LDAPS for your directory.</p> 
<p>As a prerequisite, I already created a standalone Microsoft root CA (in this case <span style="font-family: courier">RootCA</span>) for creating <span style="font-family: courier">SubordinateCA</span>. <span style="font-family: courier">RootCA</span> also has a local user account called <span style="font-family: courier">RootAdmin</span> that has administrative permissions to issue certificates to <span style="font-family: courier">SubordinateCA</span>. Note that you may already have a root CA or a multi-level CA hierarchy in your on-premises network that you can use for creating <span style="font-family: courier">SubordinateCA</span> instead of creating a new root CA. If you choose to use your existing on-premises CA hierarchy, you must have administrative permissions on your on-premises CA to issue a certificate to <span style="font-family: courier">SubordinateCA</span>.</p> 
<p>Lastly, I also already created an Amazon EC2 instance (in this case,&nbsp;<span style="font-family: courier">Management</span>) that I use to manage users, configure AWS security groups, and test the LDAPS connection. I join this instance to the AWS Microsoft AD directory domain.</p> 
<p><img class="alignnone wp-image-5166 size-full" title="Diagram showing the process discussed in this post" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/22/VS-Diagram1-0917-a.png" alt="Diagram showing the process discussed in this post" width="900" height="530" /></p> 
<p>Here is how the process works:</p> 
<ol> 
<li><a href="#step1">Delegate permissions to CA administrators</a> (in this case, <span style="font-family: courier">CAAdmin</span>) so that they can join a Microsoft enterprise CA to your AWS Microsoft AD domain and configure it as a subordinate CA.</li> 
<li><a href="#step2">Add a Microsoft enterprise CA to your AWS Microsoft AD domain</a> (in this case, <span style="font-family: courier">SubordinateCA</span>) so that it can issue certificates to your directory domain controllers to enable LDAPS. This step includes joining&nbsp;<span style="font-family: courier">SubordinateCA</span> to your directory domain, installing the Microsoft enterprise CA, and obtaining a certificate from&nbsp;<span style="font-family: courier">RootCA</span> that grants&nbsp;<span style="font-family: courier">SubordinateCA</span> permissions to issue certificates.</li> 
<li><a href="#step3">Create a certificate template</a> (in this case, <span style="font-family: courier">ServerAuthentication</span>) with server authentication and autoenrollment enabled so that your AWS Microsoft AD directory domain controllers can obtain certificates through autoenrollment to enable LDAPS.</li> 
<li><a href="#step4">Configure AWS security group rules</a> so that AWS Microsoft AD directory domain controllers can connect to the subordinate CA to request certificates.</li> 
<li><a href="#step5">AWS Microsoft AD enables LDAPS</a> through the following process: 
<ol> 
<li>AWS Microsoft AD domain controllers request a certificate from <span style="font-family: courier">SubordinateCA</span>.</li> 
<li><span style="font-family: courier">SubordinateCA</span> issues a certificate to AWS Microsoft AD domain controllers.</li> 
<li>AWS Microsoft AD enables LDAPS for the directory by installing certificates on the directory domain controllers.</li> 
</ol> </li> 
<li><a href="#step6">Test LDAPS access by using the LDP tool</a>.</li> 
</ol> 
<p>I now will show you these steps in detail. I use the names of components—such as <span style="font-family: courier">RootCA</span>, <span style="font-family: courier">SubordinateCA</span>, and <span style="font-family: courier">Management</span>—and refer to users—such as <span style="font-family: courier">Admin</span>, <span style="font-family: courier">RootAdmin</span>, and <span style="font-family: courier">CAAdmin</span>—to illustrate who performs these steps. All component names and user names&nbsp;in this post are used for illustrative purposes only.</p> 
<h3>Deploy the solution</h3> 
<h4>Step 1: Delegate permissions to CA administrators</h4> 
<p><a id="step1"></a><br /> In this step, you delegate permissions to your users who manage your CAs. Your users then can join a subordinate CA to your AWS Microsoft AD domain and create the certificate template in your CA.</p> 
<p>To enable use with a Microsoft enterprise CA, AWS added a new built-in AD security group called <span style="font-family: courier">AWS Delegated Enterprise Certificate Authority Administrators</span> that has <a href="https://technet.microsoft.com/en-us/library/dn722303(v=ws.11).aspx" target="_blank" rel="noopener noreferrer">delegated permissions to install and administer a Microsoft enterprise CA</a>. By default, your directory <span style="font-family: courier">Admin</span> is part of the new group and can add other users or groups in your AWS Microsoft AD directory to this security group. If you have <a href="http://docs.aws.amazon.com/directoryservice/latest/admin-guide/setup_trust.html" target="_blank" rel="noopener noreferrer">trust with your on-premises AD directory</a>, you can also delegate CA administrative permissions to your on-premises users by adding on-premises AD users or <a href="https://technet.microsoft.com/en-us/library/cc755692(v=ws.10).aspx" target="_blank" rel="noopener noreferrer">global groups</a> to this new AD security group.</p> 
<p>To create a new user (in this case <span style="font-family: courier">CAAdmin</span>) in your directory and add this user to the&nbsp;<span style="font-family: courier">AWS Delegated Enterprise Certificate Authority Administrators</span>&nbsp;security group, follow these steps:</p> 
<ol> 
<li>Sign in to the <span style="font-family: courier">Management</span> instance using RDP with the user name <span style="font-family: courier">admin</span> and the password that you set for the <span style="font-family: courier">admin</span> user when you created your directory.</li> 
<li>Launch the <strong>Microsoft Windows Server Manager</strong> on the <span style="font-family: courier">Management</span> instance and navigate to <strong>Tools</strong> &gt; <strong>Active Directory Users and Computers</strong>.<br /> <img class="alignnone wp-image-5167 size-full" title="Screnshot of the menu including the &quot;Active Directory Users and Computers&quot; choice" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/22/1.b-1.jpg" alt="Screnshot of the menu including the &quot;Active Directory Users and Computers&quot; choice" width="425" height="212" /></li> 
<li>Switch to the&nbsp;tree view<strong>&nbsp;</strong>and navigate to&nbsp;<strong>corp.example.com</strong> <strong>&gt;</strong> <strong>CORP</strong><strong> &gt; </strong><strong>Users</strong><strong>. </strong>Right-click <strong>Users</strong> and choose <strong>New</strong><strong> &gt; </strong><strong>User</strong><strong><strong>.</strong></strong><br /> <img class="alignnone wp-image-5182 size-full" title="Screenshot of choosing New &gt; User" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/22/1.c.jpg" alt="Screenshot of choosing New &gt; User" width="487" height="533" /></li> 
<li>Add a new user with the <strong>First name</strong> <span style="font-family: courier">CA</span>, <strong>Last name</strong> <span style="font-family: courier">Admin</span>, and <strong>User logon name</strong> <span style="font-family: courier">CAAdmin</span>.<br /> <img class="alignnone wp-image-5183 size-full" title="Screenshot of completing the &quot;New Object - User&quot; boxes" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/22/1.d.jpg" alt="Screenshot of completing the &quot;New Object - User&quot; boxes" width="462" height="397" /></li> 
<li>In the <strong>Active Directory Users and Computers</strong> tool<strong>, </strong>navigate to <strong>corp.example.com</strong> <strong>&gt; </strong><strong>AWS Delegated Groups</strong><strong>.</strong> In the right pane, right-click <strong>AWS Delegated Enterprise Certificate Authority Administrators</strong> and choose <strong>Properties</strong>.<br /> <img class="alignnone wp-image-5184 size-full" title="Screenshot of navigating to AWS Delegated Enterprise Certificate Authority Administrators &gt; Properties" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/22/1.e-1.jpg" alt="Screenshot of navigating to AWS Delegated Enterprise Certificate Authority Administrators &gt; Properties" width="835" height="379" /></li> 
<li>In the <strong>AWS Delegated Enterprise Certificate Authority Administrators</strong> window, switch to the <strong>Members</strong> tab and choose <strong>Add</strong>.<br /> <img class="alignnone wp-image-5185 size-full" title="Screenshot of the &quot;Members&quot; tab of the &quot;AWS Delegate Enterprise Certificate Authority Administrators&quot; window" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/22/1.f.jpg" alt="Screenshot of the &quot;Members&quot; tab of the &quot;AWS Delegate Enterprise Certificate Authority Administrators&quot; window" width="670" height="653" /></li> 
<li>In the <strong>Enter the object names to select</strong> box, type <span style="font-family: courier">CAAdmin</span> and choose <strong>OK</strong>.<br /> <img class="alignnone wp-image-5186 size-full" title="Screenshot showing the &quot;Enter the object names to select&quot; box" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/22/1.g-1.jpg" alt="Screenshot showing the &quot;Enter the object names to select&quot; box" width="471" height="256" /></li> 
<li>In the next window, choose <strong>OK</strong> to add <span style="font-family: courier">CAAdmin</span> to the <span style="font-family: courier">AWS Delegated Enterprise Certificate Authority Administrators</span> security group<strong>.<br /> <img class="alignnone wp-image-5187 size-full" title="Screenshot of adding &quot;CA Admin&quot; to the &quot;AWS Delegated Enterprise Certificate Authority Administrators&quot; security group" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/22/1.h-1.jpg" alt="Screenshot of adding &quot;CA Admin&quot; to the &quot;AWS Delegated Enterprise Certificate Authority Administrators&quot; security group" width="414" height="461" /><br /> </strong></li> 
<li>Also add <span style="font-family: courier">CAAdmin</span> to the <span style="font-family: courier">AWS Delegated Server Administrators</span> security group so that <span style="font-family: courier">CAAdmin</span> can RDP in to the Microsoft enterprise CA machine<strong><strong>.</strong></strong><br /> <img class="alignnone wp-image-5257 size-full" title="Screenshot of adding &quot;CAAdmin&quot; to the &quot;AWS Delegated Server Administrators&quot; security group also so that &quot;CAAdmin&quot; can RDP in to the Microsoft enterprise CA machine" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/24/1.9-a-1-a.jpg" alt="Screenshot of adding &quot;CAAdmin&quot; to the &quot;AWS Delegated Server Administrators&quot; security group also so that &quot;CAAdmin&quot; can RDP in to the Microsoft enterprise CA machine" width="657" height="478" /></li> 
</ol> 
<p><strong>&nbsp;</strong>You have granted <span style="font-family: courier">CAAdmin</span> permissions to join a Microsoft enterprise CA to your AWS Microsoft AD directory domain.</p> 
<h4>Step 2: Add a Microsoft enterprise CA to your AWS Microsoft AD directory</h4> 
<p><a id="step2"></a><br /> In this step, you set up a subordinate Microsoft enterprise CA and join it to your AWS Microsoft AD directory domain. I will summarize the process first and then walk through the steps.</p> 
<p>First, you create an Amazon EC2 for Windows Server instance called <span style="font-family: courier">SubordinateCA</span> and join it to the domain, <span style="font-family: courier">corp.example.com</span>. You then publish <span style="font-family: courier">RootCA</span>’s public certificate and <a href="https://technet.microsoft.com/en-us/library/ee619754(v=ws.10).aspx" target="_blank" rel="noopener noreferrer">certificate revocation list</a> (CRL) to <span style="font-family: courier">SubordinateCA</span>’s local trusted store. You also publish <span style="font-family: courier">RootCA</span>’s public certificate to your directory domain. Doing so enables <span style="font-family: courier">SubordinateCA</span> and your directory domain controllers to trust <span style="font-family: courier">RootCA</span>. You then install the Microsoft enterprise CA service on <span style="font-family: courier">SubordinateCA</span> and request a certificate from <span style="font-family: courier">RootCA</span> to make <span style="font-family: courier">SubordinateCA</span> a subordinate Microsoft CA. After <span style="font-family: courier">RootCA</span> issues the certificate, <span style="font-family: courier">SubordinateCA</span> is ready to issue certificates to your directory domain controllers.</p> 
<p>Note that you can use an <a href="https://aws.amazon.com/s3/" target="_blank" rel="noopener noreferrer">Amazon S3 bucket</a> to pass the certificates between <span style="font-family: courier">RootCA</span> and <span style="font-family: courier">SubordinateCA</span>.</p> 
<p><img class="alignnone size-full wp-image-5206" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/22/VS-Diagram2-0917-a.png" alt="" width="900" height="705" /></p> 
<p>In detail, here is how the process works, as illustrated in the preceding diagram:</p> 
<ol type="a"> 
<li><strong>Set up an Amazon EC2 instance joined to your AWS Microsoft AD directory domain</strong> – Create an Amazon EC2 for Windows Server instance to use as a subordinate CA, and join it to your AWS Microsoft AD directory domain. For this example, the machine name is <span style="font-family: courier">SubordinateCA</span> and the domain is <span style="font-family: courier">corp.example.com</span>.</li> 
<li><strong>Share RootCA’s public certificate with SubordinateCA</strong> – Log in to <span style="font-family: courier">RootCA</span> as <span style="font-family: courier">RootAdmin</span> and start Windows PowerShell with administrative privileges. Run the following commands to copy <span style="font-family: courier">RootCA</span>’s public certificate and CRL to the folder <span style="font-family: courier">c:\rootcerts</span> on <span style="font-family: courier">RootCA</span>. 
<pre><code class="lang-text">New-Item c:\rootcerts -type directory
copy C:\Windows\system32\certsrv\certenroll\*.cr* c:\rootcerts</code></pre> 
</ol> 
<p style="padding-left: 30px">The following screenshot shows <span style="font-family: courier">RootCA</span>’s public certificate and CRL uploaded to an S3 bucket.<br /> <img class="alignnone wp-image-5232 size-full" title="Screenshot of RootCA’s public certificate and CRL uploaded to the S3 bucket" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/23/2.b-1.jpg" alt="Screenshot of RootCA’s public certificate and CRL uploaded to the S3 bucket" width="443" height="403" /></p> 
<ol start="3" type="a"> 
<li><strong>Publish RootCA’s public certificate to your directory domain</strong> – Log in to <span style="font-family: courier">SubordinateCA</span> as the <span style="font-family: courier">CAAdmin</span>. Download <span style="font-family: courier">RootCA</span>’s public certificate and CRL from the S3 bucket by following the instructions in <a href="http://docs.aws.amazon.com/AmazonS3/latest/user-guide/download-objects.html" target="_blank" rel="noopener noreferrer">How Do I Download an Object from an S3 Bucket?</a>&nbsp;Save the certificate and CRL to the <span style="font-family: courier">C:\rootcerts</span> folder on&nbsp;<span style="font-family: courier">SubordinateCA</span>. Add <span style="font-family: courier">RootCA</span>’s public certificate and the CRL to the local store of&nbsp;<span style="font-family: courier">SubordinateCA</span> and publish <span style="font-family: courier">RootCA</span>’s public certificate to your directory domain by running the following commands using Windows PowerShell with administrative privileges. 
<pre><code class="lang-text">certutil –addstore –f root <strong>&lt;path to the RootCA public certificate file&gt;</strong>
certutil –addstore –f root <strong>&lt;path to the RootCA CRL file&gt;</strong>
certutil –dspublish –f <strong>&lt;path to the RootCA public certificate file&gt;</strong> RootCA</code></pre> 
<li><strong>Install the subordinate Microsoft enterprise CA </strong>– Install the subordinate Microsoft enterprise CA on <span style="font-family: courier">SubordinateCA</span> by following the instructions in <a href="https://technet.microsoft.com/en-us/library/cc772192(v=ws.11).aspx" target="_blank" rel="noopener noreferrer">Install a Subordinate Certification Authority</a>. Ensure that you choose <strong>Enterprise CA</strong> for <strong>Setup Type</strong> to install an enterprise CA.<br /> <img class="alignnone size-full wp-image-5169" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/22/2.d.jpg" alt="" width="771" height="566" /></li> 
</ol> 
<p style="padding-left: 30px">For the <strong>CA Type</strong>, choose <strong>Subordinate CA</strong>.<br /> <img class="alignnone size-full wp-image-5170" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/22/2.d.2.jpg" alt="" width="774" height="564" /></p> 
<ol start="5" type="a"> 
<li><strong>Request a certificate from RootCA</strong> – Next, copy the certificate request on&nbsp;<span style="font-family: courier">SubordinateCA</span> to a folder called <span style="font-family: courier">c:\CARequest</span> by running the following commands using Windows PowerShell with administrative privileges. 
<pre><code class="lang-text">New-Item c:\CARequest -type directory
Copy c:\*.req C:\CARequest</code></pre> 
</ol> 
<ol start="6" type="a"> 
<li><strong>Approve SubordinateCA’s certificate request</strong> – Log in to <span style="font-family: courier">RootCA</span> as <span style="font-family: courier">RootAdmin</span> and download the certificate request from the S3 bucket to a folder called <span style="font-family: courier">CARequest</span>. Submit the request by running the following command using Windows PowerShell with administrative privileges. 
<pre><code class="lang-text">certreq -submit <strong>&lt;path to certificate request file&gt;</strong></code></pre> 
</ol> 
<p style="padding-left: 30px">Navigate&nbsp;to <strong>Server Manager &gt; <strong>Tools</strong> &gt; <strong>Certification Authority</strong></strong> on<strong> <span style="font-family: courier">RootCA</span>.<br /> <img class="alignnone wp-image-5173 size-full" title="Screenshot of &quot;Certification Authority&quot; in the drop-down menu" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/22/2.f.3.jpg" alt="Screenshot of &quot;Certification Authority&quot; in the drop-down menu" width="289" height="131" /></strong></p> 
<p style="padding-left: 30px">In the <strong>Certification Authority</strong> window, expand the <strong>ROOTCA</strong>&nbsp;tree in the left pane and choose<strong> Pending Requests</strong>. In the right pane, note the value in the <strong>Request ID</strong> column. Right-click the request and choose <strong>All Tasks &gt; Issue</strong>.<br /> <img class="alignnone wp-image-5262 size-full" title="Screenshot of noting the value in the &quot;Request ID&quot; column" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/24/2.f.3-a-1.jpg" alt="Screenshot of noting the value in the &quot;Request ID&quot; column" width="740" height="221" /></p> 
<ol start="7" type="a"> 
<li><strong>Retrieve the SubordinateCA certificate </strong>– Retrieve the <span style="font-family: courier">SubordinateCA</span> certificate by running following command using Windows PowerShell with administrative privileges. The command includes the <strong>&lt;</strong><strong>RequestId</strong><strong>&gt;</strong> that you noted in the previous step. 
<pre><code class="lang-text">certreq –retrieve <strong>&lt;RequestId&gt;</strong> <strong>&lt;drive&gt;</strong>:\subordinateCA.crt</code></pre> 
</ol> 
<ol start="8" type="a"> 
<li><strong>Install the SubordinateCA certificate</strong> – Log in to&nbsp;<span style="font-family: courier">SubordinateCA</span> as the <span style="font-family: courier">CAAdmin</span> and download <span style="font-family: courier">SubordinateCA.crt</span> from the S3 bucket. Install the certificate by running following commands using Windows PowerShell with administrative privileges. 
<pre><code class="lang-text">certutil –installcert c:\subordinateCA.crt
start-service certsvc</code></pre> 
<li><strong>Delete the content that you uploaded to S3 </strong>–<strong>&nbsp;</strong>As a security best practice, <a href="http://docs.aws.amazon.com/AmazonS3/latest/user-guide/delete-objects.html" target="_blank" rel="noopener noreferrer">delete</a> all the certificates and CRLs that you uploaded to the S3 bucket in the previous steps because you already have installed them on&nbsp;<span style="font-family: courier">SubordinateCA</span>.</li> 
</ol> 
<p>You have finished setting up the subordinate Microsoft enterprise CA that is joined to your AWS Microsoft AD directory domain. Now you can use your subordinate Microsoft enterprise CA to create a certificate template so that your directory domain controllers can request a certificate to enable LDAPS for your directory.</p> 
<h4>Step 3: Create a certificate template</h4> 
<p><a id="step3"></a><br /> In this step, you create a certificate template with server authentication and autoenrollment enabled on&nbsp;<span style="font-family: courier">SubordinateCA</span>. You create&nbsp;this new template (in this case, <span style="font-family: courier">ServerAuthentication</span>) by duplicating an existing certificate template (in this case, <span style="font-family: courier">Domain Controller template</span>) and adding server authentication and autoenrollment to the template.</p> 
<p>Follow these steps to create a certificate template:</p> 
<ol> 
<li>Log in to&nbsp;<span style="font-family: courier">SubordinateCA</span> as <span style="font-family: courier">CAAdmin</span>.</li> 
<li>Launch <strong>Microsoft Windows</strong> <strong>Server Manager. </strong>Select<strong> Tools</strong> &gt; <strong>Certification Authority</strong>.</li> 
<li>In the <strong>Certificate Authority</strong> window, expand the <strong>SubordinateCA</strong> tree in the left pane. Right-click <strong>Certificate Templates</strong>, and choose<strong> Manage</strong>.<br /> <img class="alignnone wp-image-5263 size-full" title="Screenshot of choosing &quot;Manage&quot; under &quot;Certificate Template&quot;" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/24/3.3-a-1.jpg" alt="Screenshot of choosing &quot;Manage&quot; under &quot;Certificate Template&quot;" width="287" height="354" /></li> 
<li>In the <strong>Certificate Templates Console</strong> window, right-click <strong>Domain Controller </strong>and choose <strong>Duplicate Template</strong>.<br /> <img class="alignnone wp-image-5178 size-full" title="Screenshot of the Certificate Templates Console window" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/22/3.d.jpg" alt="Screenshot of the Certificate Templates Console window" width="370" height="399" /></li> 
<li>In the <strong>Properties of New Template</strong> window, switch to the <strong>General</strong> tab and change the <strong>Template display name</strong> to <span style="font-family: courier">ServerAuthentication</span>.<br /> <img class="alignnone wp-image-5179 size-full" title="Screenshot of the &quot;Properties of New Template&quot; window" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/22/3.e.jpg" alt="Screenshot of the &quot;Properties of New Template&quot; window" width="414" height="568" /></li> 
<li>Switch to the <strong>Security</strong> tab, and choose <strong>Domain Controllers</strong> in the <strong>Group or user names</strong>&nbsp;section. Select the <strong>Allow&nbsp;</strong>check box for <strong>Autoenroll</strong> in the <strong>Permissions for</strong> <strong>Domain Controllers</strong> section.<br /> <img class="alignnone wp-image-5180 size-full" title="Screenshot of the &quot;Permissions for Domain Controllers&quot; section of the &quot;Properties of New Template&quot; window" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/22/3.f.jpg" alt="Screenshot of the &quot;Permissions for Domain Controllers&quot; section of the &quot;Properties of New Template&quot; window" width="413" height="565" /></li> 
<li>Switch to the <strong>Extensions</strong> tab, choose <strong>Application Policies</strong> in the <strong>Extensions included in this template</strong> section, and choose <strong>Edit<br /> <img class="alignnone wp-image-5190 size-full" title="Screenshot of the &quot;Extensions&quot; tab of the &quot;Properties of New Template&quot; window" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/22/3.g.jpg" alt="Screenshot of the &quot;Extensions&quot; tab of the &quot;Properties of New Template&quot; window" width="413" height="565" /><br /> </strong></li> 
<li>In the <strong>Edit Application Policies Extension</strong> window, choose <strong>Client Authentication</strong> and choose <strong>Remove</strong>. Choose <strong>OK</strong> to create the <span style="font-family: courier">ServerAuthentication</span> certificate template. Close the <strong>Certificate Templates Console</strong> window.<br /> <img class="alignnone wp-image-5191 size-full" title="Screenshot of the &quot;Edit Application Policies Extension&quot; window" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/22/3.h.jpg" alt="Screenshot of the &quot;Edit Application Policies Extension&quot; window" width="305" height="419" /></li> 
<li>In the <strong>Certificate Authority</strong> window, right-click <strong>Certificate Templates</strong>, and choose<strong> New</strong> &gt; <strong>Certificate Template to Issue</strong>.<br /> <img class="alignnone wp-image-5265 size-full" title="Screenshot of choosing &quot;New&quot; &gt; &quot;Certificate Template to Issue&quot;" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/24/3.9-a.jpg" alt="Screenshot of choosing &quot;New&quot; &gt; &quot;Certificate Template to Issue&quot;" width="519" height="332" /></li> 
<li>In the <strong>Enable Certificate Templates</strong> window, choose <span style="font-family: courier">ServerAuthentication</span> and choose <strong>OK.<br /> <img class="alignnone wp-image-5193 size-full" title="Screenshot of the &quot;Enable Certificate Templates&quot; window" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/22/3.j.jpg" alt="Screenshot of the &quot;Enable Certificate Templates&quot; window" width="595" height="378" /><br /> </strong></li> 
</ol> 
<p>You have finished creating a certificate template with server authentication and autoenrollment enabled on <span style="font-family: courier">SubordinateCA</span>. Your AWS Microsoft AD directory domain controllers can now obtain a certificate through autoenrollment to enable LDAPS.</p> 
<h4>Step 4: Configure AWS security group rules</h4> 
<p><a id="step4"></a><br /> In this step, you configure AWS security group rules so that your directory domain controllers can connect to the subordinate CA to request a certificate. To do this, you must add outbound rules to your directory’s AWS security group (in this case, <span style="font-family: courier">sg-4ba7682d</span>) to allow all outbound traffic to <span style="font-family: courier">SubordinateCA</span>’s AWS security group (in this case, <span style="font-family: courier">sg-6fbe7109</span>) so that your directory domain controllers can connect to <span style="font-family: courier">SubordinateCA</span> for requesting a certificate. You also must add inbound rules to <span style="font-family: courier">SubordinateCA</span>’s AWS security group to allow all incoming traffic from your directory’s AWS security group so that the subordinate CA can accept incoming traffic from your directory domain controllers.</p> 
<p>Follow these steps to configure AWS security group rules:</p> 
<ol> 
<li>Log in to the <span style="font-family: courier">Management</span> instance as <span style="font-family: courier">Admin</span>.</li> 
<li>Navigate to the <a href="https://console.aws.amazon.com/ec2" target="_blank" rel="noopener noreferrer">EC2 console</a>.</li> 
<li>In the left pane, choose <strong>Network &amp; Security &gt; Security Groups</strong>.</li> 
<li>In the right pane, choose the AWS security group (in this case, <span style="font-family: courier">sg-6fbe7109</span>) of&nbsp;<span style="font-family: courier">SubordinateCA</span>.</li> 
<li>Switch to the <strong>Inbound</strong> tab and choose <strong>Edit</strong>.</li> 
<li>Choose <strong>Add Rule</strong>. Choose <strong>All traffic</strong> for <strong>Type</strong> and <strong>Custom</strong> for <strong>Source</strong>. Enter your directory’s AWS security group (in this case, <span style="font-family: courier">sg-4ba7682d</span>) in the <strong>Source</strong>&nbsp;box. Choose <strong>Save</strong>.<br /> <img class="alignnone wp-image-5267 size-full" title="Screenshot of adding an inbound rule" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/24/4.6-a-1.jpg" alt="Screenshot of adding an inbound rule" width="900" height="284" /></li> 
<li>Now choose the AWS security group (in this case, <span style="font-family: courier">sg-4ba7682d</span>) of your AWS Microsoft AD directory, switch to the <strong>Outbound</strong> tab, and choose <strong>Edit</strong>.</li> 
<li>Choose <strong>Add Rule</strong>. Choose <strong>All traffic</strong> for <strong>Type</strong> and <strong>Custom</strong> for <strong>Destination</strong>. Enter your directory’s AWS security group (in this case, <span style="font-family: courier">sg-6fbe7109</span>) in the <strong>Destination</strong> box. Choose <strong>Save</strong>.<br /> <img class="alignnone wp-image-5268 size-full" title="Screenshot of adding an outbound rule" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/24/4.8-a-1.jpg" alt="" width="900" height="280" /></li> 
</ol> 
<p>You have completed the configuration of AWS security group rules to allow traffic between your directory domain controllers and&nbsp;<span style="font-family: courier">SubordinateCA</span>.</p> 
<h4>Step 5: AWS Microsoft AD enables LDAPS</h4> 
<p><a id="step5"></a><br /> The AWS Microsoft AD domain controllers perform this step automatically by recognizing the published template and requesting a certificate from the subordinate Microsoft enterprise CA. The subordinate CA can take up to 180 minutes to issue certificates to the directory domain controllers. The directory imports these certificates into the directory domain controllers and enables LDAPS for your directory automatically. This completes the setup of LDAPS for the AWS Microsoft AD directory. The LDAP service on the directory is now ready to accept LDAPS connections!</p> 
<h4>Step 6: Test LDAPS access by using the LDP tool</h4> 
<p><a id="step6"></a><br /> In this step, you test the LDAPS connection to the AWS Microsoft AD directory by using the LDP tool. The LDP tool is available on the <span style="font-family: courier">Management</span> machine where you installed <a href="http://docs.aws.amazon.com/directoryservice/latest/admin-guide/install_ad_tools.html" target="_blank" rel="noopener noreferrer">Active Directory Administration Tools</a>. Before you test the LDAPS connection, you must wait up to 180 minutes for the subordinate CA to issue a certificate to your directory domain controllers.</p> 
<p>To test LDAPS, you connect to one of the domain controllers using port 636. Here are the steps to test the LDAPS connection:</p> 
<ol> 
<li>Log in to <span style="font-family: courier">Management</span> as <span style="font-family: courier">Admin</span>.</li> 
<li>Launch the <strong>Microsoft Windows</strong> <strong>Server Manager</strong> on <span style="font-family: courier">Management</span> and navigate to <strong>Tools</strong> &gt; <strong>Active Directory Users and Computers</strong>.</li> 
<li>Switch to the <strong>tree view&nbsp;</strong>and navigate to&nbsp;<strong>corp.example.com</strong> <strong>&gt;</strong> <strong>CORP</strong> <strong>&gt; </strong><strong>Domain Controllers</strong><strong>. </strong>In the right pane, right-click on one of the domain controllers and choose <strong>Properties</strong>. Copy the DNS name of the domain controller.<br /> <img class="alignnone wp-image-5199 size-full" title="Screenshot of copying the DNS name of the domain controller" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/22/6.c.jpg" alt="Screenshot of copying the DNS name of the domain controller" width="845" height="567" /></li> 
<li>Launch the LDP.exe tool by launching Windows PowerShell and running the <span style="font-family: courier">LDP.exe</span> command.<br /> <img class="alignnone size-full wp-image-5200" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/22/6.d.jpg" alt="" width="498" height="60" /></li> 
<li>In the LDP tool, choose <strong>Connection</strong><strong> &gt; </strong><strong>Connect</strong><strong><strong>.</strong></strong><br /> <img class="alignnone wp-image-5201 size-full" title="Screenshot of choosing &quot;Connnection&quot; &gt; &quot;Connect&quot; in the LDP tool" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/22/6.e.jpg" alt="Screenshot of choosing &quot;Connnection&quot; &gt; &quot;Connect&quot; in the LDP tool" width="746" height="231" /></li> 
<li>In the <strong>Server</strong> box, paste the DNS name you copied in the previous step. Type <span style="font-family: courier">636</span> in the <strong>Port</strong> box. Choose <strong>OK</strong> to test the LDAPS connection to port 636 of your directory.<br /> <img class="alignnone wp-image-5202 size-full" title="Screenshot of completing the boxes in the &quot;Connect&quot; window" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/22/6.f.jpg" alt="Screenshot of completing the boxes in the &quot;Connect&quot; window" width="281" height="149" /></li> 
<li>You should see the following message to confirm that your LDAPS connection is now open.<br /> <img class="alignnone wp-image-5204 size-full" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/22/6.g.jpg" alt="" width="999" height="128" /></li> 
</ol> 
<p>You have completed the setup of LDAPS for your AWS Microsoft AD directory! You can now encrypt LDAP communications between your Windows and Linux applications and your AWS Microsoft AD directory using LDAPS.</p> 
<h3>Summary</h3> 
<p>In this blog post, I walked through the process of enabling LDAPS for your AWS Microsoft AD directory. Enabling LDAPS helps you protect PII and other sensitive information exchanged over untrusted networks between your Windows and Linux applications and your AWS Microsoft AD. To learn more about how to use AWS Microsoft AD, see the <a href="https://aws.amazon.com/documentation/directory-service/" target="_blank" rel="noopener noreferrer">Directory Service documentation</a>. For general information and pricing, see the <a href="https://aws.amazon.com/directoryservice/" target="_blank" rel="noopener noreferrer">Directory Service home page</a>.</p> 
<p>If you have comments about this blog post, submit a comment in the “Comments” section below. If you have implementation or troubleshooting questions, start a new thread on the&nbsp;<a href="https://forums.aws.amazon.com/forum.jspa?forumID=180" target="_blank" rel="noopener noreferrer">Directory Service forum</a> or <a href="https://console.aws.amazon.com/support/home" target="_blank" rel="noopener noreferrer">contact AWS Support</a>.</p> 
<p>– Vijay</p> 
<footer> 
TAGS: 
<span property="keywords"><a href="https://aws.amazon.com/blogs/security/tag/active-directory/" rel="tag">Active Directory</a>, <a href="https://aws.amazon.com/blogs/security/tag/aws-microsoft-ad/" rel="tag">AWS Microsoft AD</a>, <a href="https://aws.amazon.com/blogs/security/tag/certificate-authority/" rel="tag">Certificate Authority</a>, <a href="https://aws.amazon.com/blogs/security/tag/encryption/" rel="tag">Encryption</a>, <a href="https://aws.amazon.com/blogs/security/tag/security-group/" rel="tag">security group</a>, <a href="https://aws.amazon.com/blogs/security/tag/ssh/" rel="tag">SSH</a>, <a href="https://aws.amazon.com/blogs/security/tag/ssl/" rel="tag">SSL</a>, <a href="https://aws.amazon.com/blogs/security/tag/tls/" rel="tag">TLS</a></span> 
</footer> 
<script>
require(['blog'], function() {
AWS.Blog.commenting('#aws-comment-trigger-5161');
});
</script> 
</article> 
<article class="post" vocab="http://schema.org/" typeof="TechArticle"> 
<meta property="inLanguage" content="en-US" /> 
<b class="b post-title" property="name headline">Now Use AWS IAM to Delete a Service-Linked Role When You No Longer Require an AWS Service to Perform Actions on Your Behalf</b> 
<footer class="meta">
by 
<span property="author" typeof="Person"><span property="name">Ujjwal Pugalia</span></span> | on 
<time property="datePublished" datetime="2017-09-21T14:56:08+00:00">21 SEP 2017</time> | in 
<span class="categories"><a href="https://aws.amazon.com/blogs/security/category/security-identity-compliance/aws-identity-and-access-management-iam/" title="View all posts in AWS Identity and Access Management (IAM)*"><span property="articleSection">AWS Identity and Access Management (IAM)*</span></a>, <a href="https://aws.amazon.com/blogs/security/category/security-identity-compliance/identity/" title="View all posts in Identity"><span property="articleSection">Identity</span></a></span> | 
<a href="https://aws.amazon.com/blogs/security/now-use-aws-iam-to-delete-a-service-linked-role-when-you-no-longer-require-an-aws-service-to-perform-actions-on-your-behalf/" property="url">Permalink</a> | 
<a id="aws-comment-trigger-4754" href="https://commenting.awsblogs.com/embed.html?disqus_shortname=aws-security-blog&amp;disqus_identifier=4754&amp;disqus_title=Now+Use+AWS+IAM+to+Delete+a+Service-Linked+Role+When+You+No+Longer+Require+an+AWS+Service+to+Perform+Actions+on+Your+Behalf&amp;disqus_url=https://aws.amazon.com/blogs/security/now-use-aws-iam-to-delete-a-service-linked-role-when-you-no-longer-require-an-aws-service-to-perform-actions-on-your-behalf/" data-sandbox-attr="allow-forms allow-scripts allow-popups allow-same-origin" property="discussionUrl"><i class="icon-comment"></i> Comments</a> 
<script>
require(['blog'], function() {
AWS.Blog.commenting('#aws-comment-trigger-4754');
});
</script> | 
<a href="#" role="button" data-share-dialog=""><span class="span icon-share"></span>&nbsp;Share</a> 
<ul> 
</ul> 
</footer> 
<p>Earlier this year, <a href="https://aws.amazon.com/iam/" target="_blank" rel="noopener noreferrer">AWS Identity and Access Management (IAM)</a> introduced <a href="https://aws.amazon.com/blogs/security/introducing-an-easier-way-to-delegate-permissions-to-aws-services-service-linked-roles/" target="_blank" rel="noopener noreferrer">service-linked roles</a><em>, </em>which provide you an easy and secure way to delegate permissions to AWS services. Each service-linked role delegates permissions to an AWS service, which is called its <em>linked service</em><strong>.</strong> Service-linked roles help with monitoring and auditing requirements by providing a transparent way to understand all actions performed on your behalf because <a href="https://aws.amazon.com/cloudtrail/" target="_blank" rel="noopener noreferrer">AWS CloudTrail</a> logs all actions performed by the linked service using service-linked roles. For information about which services support service-linked roles, see <a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/reference_aws-services-that-work-with-iam.html" target="_blank" rel="noopener noreferrer">AWS Services That Work with IAM</a>. Over time, more AWS services will support service-linked roles.</p> 
<p>Today, IAM added support for the deletion of service-linked roles through the IAM console and the IAM API/CLI. This means you now can revoke permissions from the linked service to create and manage AWS resources in your account. When you delete a service-linked role, the linked service no longer has the permissions to perform actions on your behalf. To ensure your AWS services continue to function as expected when you delete a service-linked role, IAM validates that you no longer have resources that require the service-linked role to function properly. This prevents you from inadvertently revoking permissions required by an AWS service to manage your existing AWS resources and helps you maintain your resources in a consistent state. If there are any resources in your account that require the service-linked role, you will receive an error when you attempt to delete the service-linked role, and the service-linked role will remain in your account. If you do not have any resources that require the service-linked role, you can delete the service-linked role and IAM will remove the service-linked role from your account.</p> 
<p>In this blog post, I show how to delete a service-linked role by using the <a href="https://console.aws.amazon.com/iam/home" target="_blank" rel="noopener noreferrer">IAM console</a>. To learn more about how to delete service-linked roles by using the IAM API/CLI, see the <a href="http://docs.aws.amazon.com/IAM/latest/APIReference/API_DeleteServiceLinkedRole.html" target="_blank" rel="noopener noreferrer">DeleteServiceLinkedRole API</a> documentation.</p> 
<p><strong>Note:</strong> The IAM console does not currently support service-linked role deletion for <a href="https://aws.amazon.com/lex/" target="_blank" rel="noopener noreferrer">Amazon Lex</a>, but you can delete your service-linked role by using the <a href="https://console.aws.amazon.com/lex/home" target="_blank" rel="noopener noreferrer">Amazon Lex console</a>. To learn more, see&nbsp;<a href="http://alpha-docs-aws.amazon.com/lex/latest/dg/howitworks-service-permissions.html" target="_blank" rel="noopener noreferrer">Service Permissions</a>.<span id="more-4754"></span></p> 
<h3>How to delete a service-linked role by using the IAM console</h3> 
<p>If you no longer need to use an AWS service that uses a service-linked role, you can remove permissions from that service by deleting the service-linked role through the IAM console. To delete a service-linked role, you must have permissions for the <span style="font-family: courier">iam:DeleteServiceLinkedRole</span> action. For example, the following IAM policy grants the permission to delete service-linked roles used by <a href="http://aws.amazon.com/redshift/" target="_blank" rel="noopener noreferrer">Amazon Redshift</a>.&nbsp;To learn more about working with IAM policies, see <a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_manage.html" target="_blank" rel="noopener noreferrer">Working with Policies</a>.</p> 
<pre><code class="lang-text">{ 
&quot;Version&quot;: &quot;2012-10-17&quot;,
&quot;Statement&quot;: [
{
&quot;Sid&quot;: &quot;AllowDeletionOfServiceLinkedRolesForRedshift&quot;,
&quot;Effect&quot;: &quot;Allow&quot;,
&quot;Action&quot;: [&quot;iam:DeleteServiceLinkedRole&quot;],
&quot;Resource&quot;: [&quot;arn:aws:iam::*:role/aws-service-role/redshift.amazonaws.com/AWSServiceRoleForRedshift*&quot;]
}
]
}</code></pre> 
<p>To delete a service-linked role by using the IAM console:</p> 
<ol> 
<li>Navigate to the <a href="https://console.aws.amazon.com/iam/home" target="_blank" rel="noopener noreferrer">IAM console</a> and choose <strong>Roles</strong> from the navigation pane.</li> 
</ol> 
<p style="padding-left: 30px"><img class="alignnone wp-image-5150 size-full" title="Screenshot of the Roles page in the IAM console" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/21/UP1_SLRD_092117-c.png" alt="Screenshot of the Roles page in the IAM console" width="543" height="518" /></p> 
<ol start="2"> 
<li>Choose the service-linked role you want to delete and then choose <strong>Delete role</strong>. In this example, I choose the&nbsp;&nbsp;<span style="font-family: courier">AWSServiceRoleForRedshift</span> service-linked role.</li> 
</ol> 
<p style="padding-left: 30px"><img class="alignnone wp-image-5156 size-full" title="Screenshot of the AWSServiceRoleForRedshift service-linked role" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/21/UP2_SLRD_092117-b.png" alt="Screenshot of the AWSServiceRoleForRedshift service-linked role" width="902" height="301" /></p> 
<ol start="3"> 
<li>A dialog box asks you to confirm that you want to delete the service-linked role you have chosen. In the <strong>Last activity</strong> column, you can see when the AWS service last used the service-linked role, which tells you when the linked service last used the service-linked role to perform an action on your behalf. If you want to continue to delete the service-linked role, choose <strong>Yes, delete</strong> to delete the service-linked role.</li> 
</ol> 
<p style="padding-left: 30px"><img class="alignnone wp-image-5135 size-full" title="Screenshot of the &quot;Delete role&quot; window" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/21/UP3_SLRD_092117-a.png" alt="Screenshot of the &quot;Delete role&quot; window" width="900" height="392" /></p> 
<ol start="4"> 
<li>IAM then checks whether you have any resources that require the service-linked role you are trying to delete. While IAM checks, you will see the status message, <strong>Deletion in progress</strong>, below the role name.&nbsp;<img class="alignnone wp-image-5143 size-full" title="Screenshot showing &quot;Deletion in progress&quot;" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/21/UP4_SLRD_092117-a.png" alt="Screenshot showing &quot;Deletion in progress&quot;" width="902" height="198" /></li> 
</ol> 
<ol start="5"> 
<li>If no resources require the service-linked role, IAM deletes the role from your account and displays a success message on the console.</li> 
</ol> 
<p style="padding-left: 30px"><img class="alignnone wp-image-5138 size-full" title="Screenshot of the success message" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/21/UP5_SLRD_092117.png" alt="Screenshot of the success message" width="718" height="91" /></p> 
<ol start="6"> 
<li>If there <em>are</em> AWS resources that require the service-linked role you are trying to delete, you will see the status message,&nbsp;<strong>Deletion failed</strong>, below the role name.</li> 
</ol> 
<p style="padding-left: 30px"><img class="alignnone wp-image-5144 size-full" title="Screenshot showing the &quot;Deletion failed&quot;" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/21/UP6_SLRD_092117-a.png" alt="Screenshot showing the &quot;Deletion failed&quot;" width="902" height="203" /></p> 
<ol start="7"> 
<li>If you choose <strong>View details</strong>, you will see a message that explains the deletion failed because there are resources that use the service-linked role.<br /> <img class="alignnone wp-image-5157 size-full" title="Screenshot showing details about why the role deletion failed" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/21/UP7_SLRD_092117-a.png" alt="Screenshot showing details about why the role deletion failed" width="1408" height="151" /></li> 
<li>Choose <strong>View Resources</strong> to view the Amazon Resource Names (ARNs) of the first five resources that require the service-linked role. You can delete the service-linked role only after you delete all resources that require the service-linked role. In this example, only one resource requires the service-linked role.</li> 
</ol> 
<p style="padding-left: 30px"><img class="alignnone wp-image-5158 size-full" title="Screenshot showing the Amazon Resource Name that requires the service-linked role" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/09/21/UP8_SLRD_092117-a.png" alt="" width="983" height="392" /></p> 
<h3>Conclusion</h3> 
<p>Service-linked roles make it easier for you to delegate permissions to AWS services to create and manage AWS resources on your behalf and to understand all actions the service will perform on your behalf. If you no longer need to use an AWS service that uses a service-linked role, you can remove permissions from that service by deleting the service-linked role through the IAM console. However, before you delete a service-linked role, you must delete all the resources associated with that role to ensure that your resources remain in a consistent state.</p> 
<p>If you have any questions, submit a comment in the “Comments” section below. If you need help working with service-linked roles, start a new thread on the <a href="https://forums.aws.amazon.com/forum.jspa?forumID=76" target="_blank" rel="noopener noreferrer">IAM forum</a>&nbsp;or <a href="https://console.aws.amazon.com/support/home" target="_blank" rel="noopener noreferrer">contact AWS Support</a>.</p> 
<p>– Ujjwal</p> 
<footer> 
TAGS: 
<span property="keywords"><a href="https://aws.amazon.com/blogs/security/tag/access-management/" rel="tag">Access management</a>, <a href="https://aws.amazon.com/blogs/security/tag/roles/" rel="tag">roles</a>, <a href="https://aws.amazon.com/blogs/security/tag/service-linked-roles/" rel="tag">service-linked roles</a></span> 
</footer> 
<script>
require(['blog'], function() {
AWS.Blog.commenting('#aws-comment-trigger-4754');
});
</script> 
</article> 
<p>
© 2017, Amazon Web Services, Inc. or its affiliates. All rights reserved.
</p>

    </div>
  </div>
</div>


    <div id="footer" class="navigation hidden-print">
      <div class="container">
        <div class="row">
          <div class="col-xs-12">
            <ul class="footer-links nav navbar-nav">
              <li><a href="../aws.html">AWS</a></li>
              <li><a href="../linux.html">Linux</a></li>
              <li><a href="../docker.html">Docker</a></li>
              <li><a href="../ibmpower.html">IBM Power</a></li>
              <li><a href="blogsataws1.html">Blogs@AWS (Kindle Friendly)</a></li>
            </ul>
            <ul class="footer-links nav navbar-nav navbar-right">
              <li><a href="../comments.html">Comments?</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
