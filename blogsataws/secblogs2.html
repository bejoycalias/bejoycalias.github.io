<!DOCTYPE html>
<html lang="en">
  <head>
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-593498H');</script>
<!-- End Google Tag Manager -->

    <meta charset="utf-8">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">

    <meta name="msapplication-config" content="/microsoft-tile.xml" />
    <meta name="theme-color" content="#ffffff">

    <meta property="og:url" content="https://bejoycalias.github.io/blogsataws/secblogs1.html" />
    <meta property="og:site_name" content="Bejoy's TechNotes"/>
    <meta property="og:title" content="Bejoy's TechNotes - Kindle Friendly AWS Security Blogs" />
    <meta property="og:image" content="https://bejoycalias.github.io/assets/images/og-image.png"/>
    <meta property="og:image:width" content="1200"/>
    <meta property="og:image:height" content="1200"/>
    <meta property="og:description" content="" />

    <title>Bejoy's TechNotes - Kindle Friendly AWS Security Blogs</title>
    <link href="../assets/stylesheets/application-832aa42c.css" rel="stylesheet" />

    <!--[if lt IE 9]>
      <script src="../assets/javascripts/ie-compat-c141a02d.js"></script>
    <![endif]-->
    <script src="../assets/javascripts/application-ff53d307.js"></script>

    <!-- Typekit script to import Klavika font -->
    <script src="https://use.typekit.net/wxf7mfi.js"></script>
    <script>try{Typekit.load({ async: true });}catch(e){}</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-100043608-1', 'auto');
  ga('send', 'pageview');

</script>

    
  </head>

  <body id="aws-blogs" class="layout-inner aws-blogs">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-593498H"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->


    <div id="header" class="navigation navbar-static-top hidden-print">
      <div class="container">
        <div class="row">
          <div class="col-xs-12">
            <div class="navbar-header">
              <div class="navbar-brand">
                <a href="/">
                  <svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="135.000000pt" height="50" viewbox="0 0 135.000000 45.000000" preserveaspectratio="xMidYMid meet" class="logo">

<g transform="translate(0.000000,45.000000) scale(0.100000,-0.100000)" fill="#000000" stroke="none">
<path class="text" fill="#000000" d="M527 384 c-4 -4 -7 -18 -7 -31 0 -21 4 -24 28 -21 21 2 27 8 27 28 0
18 -6 26 -20 28 -12 2 -24 0 -28 -4z"></path>
<path class="text" fill="#000000" d="M1080 335 c0 -48 2 -55 20 -55 18 0 20 7 20 55 0 48 -2 55 -20 55
-18 0 -20 -7 -20 -55z"></path>
<path class="text" fill="#000000" d="M54 357 c-2 -7 -3 -69 -2 -138 l3 -124 65 -3 c90 -3 130 20 130 77 0
29 -6 44 -20 54 -20 14 -20 15 -3 45 14 25 15 34 5 56 -6 15 -23 31 -38 36
-38 15 -134 13 -140 -3z m110 -33 c19 -7 21 -45 4 -62 -7 -7 -22 -12 -35 -12
-20 0 -23 5 -23 40 0 41 13 50 54 34z m20 -130 c19 -18 19 -20 6 -45 -8 -13
-21 -19 -45 -19 -34 0 -35 1 -35 40 0 38 2 40 29 40 16 0 37 -7 45 -16z"></path>
<path class="text" fill="#000000" d="M319 271 c-23 -24 -29 -38 -29 -74 0 -25 3 -53 6 -62 20 -50 164 -64
164 -15 0 15 -7 17 -45 12 -46 -5 -75 8 -75 34 0 11 16 14 65 14 l65 0 0 35
c0 80 -92 114 -151 56z m99 -33 c3 -15 -4 -18 -37 -18 -43 0 -50 7 -29 28 18
18 62 11 66 -10z"></path>
<path class="text" fill="#000000" d="M520 184 c0 -107 -1 -116 -20 -121 -11 -3 -20 -12 -20 -19 0 -21 76
-19 84 2 3 9 6 69 6 135 l0 119 -25 0 -25 0 0 -116z"></path>
<path class="text" fill="#000000" d="M649 271 c-24 -25 -29 -37 -29 -78 1 -70 34 -103 105 -103 55 0 95
44 95 103 0 60 -7 75 -41 92 -47 25 -96 19 -130 -14z m111 -30 c25 -48 2 -111
-40 -111 -45 0 -69 80 -34 114 21 22 61 20 74 -3z"></path>
<path class="text" fill="#000000" d="M850 287 c0 -8 16 -57 36 -110 28 -76 33 -100 25 -116 -16 -28 -14
-31 18 -31 27 0 29 4 70 123 23 67 41 128 41 135 0 6 -11 12 -24 12 -21 0 -26
-8 -41 -65 -10 -36 -21 -68 -25 -70 -3 -2 -16 27 -29 66 -19 60 -25 69 -47 69
-13 0 -24 -6 -24 -13z"></path>
<path class="text" fill="#000000" d="M1192 284 c-17 -12 -22 -24 -20 -47 2 -26 10 -36 45 -52 49 -23 59
-55 17 -55 -14 0 -34 5 -45 10 -16 9 -19 7 -19 -13 0 -17 7 -27 23 -31 69 -18
117 6 117 60 0 32 -4 37 -45 55 -60 26 -62 54 -4 46 37 -5 40 -3 37 16 -2 18
-11 23 -43 25 -25 2 -49 -3 -63 -14z"></path>
</g>
</svg>

                </a>
              </div>
              <button class="navbar-toggle" type="button">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
            </div>
            <div class="buttons hidden-xs">
              <nav class="navigation-links" role="navigation">
                <ul class="main-links nav navbar-nav navbar-right">
                  <li><a href="../aws.html">AWS</a></li>
                  <li><a href="../linux.html">Linux</a></li>
                  <li><a href="../docker.html">Docker</a></li>
                  <li><a href="../ibmpower.html">IBM Power</a></li>
                  <li><a href="blogsataws1.html">Blogs@AWS (Kindle Friendly)</a></li>
                </ul>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="sidebar-overlay"></div>

<aside class="sidebar" role="navigation">
  <div class="sidebar-header">
    <svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="135.000000pt" height="42" viewbox="0 0 135.000000 45.000000" preserveaspectratio="xMidYMid meet">

<g transform="translate(0.000000,45.000000) scale(0.100000,-0.100000)" fill="#000000" stroke="none">
<path class="text" fill="#000000" d="M527 384 c-4 -4 -7 -18 -7 -31 0 -21 4 -24 28 -21 21 2 27 8 27 28 0
18 -6 26 -20 28 -12 2 -24 0 -28 -4z"></path>
<path class="text" fill="#000000" d="M1080 335 c0 -48 2 -55 20 -55 18 0 20 7 20 55 0 48 -2 55 -20 55
-18 0 -20 -7 -20 -55z"></path>
<path class="text" fill="#000000" d="M54 357 c-2 -7 -3 -69 -2 -138 l3 -124 65 -3 c90 -3 130 20 130 77 0
29 -6 44 -20 54 -20 14 -20 15 -3 45 14 25 15 34 5 56 -6 15 -23 31 -38 36
-38 15 -134 13 -140 -3z m110 -33 c19 -7 21 -45 4 -62 -7 -7 -22 -12 -35 -12
-20 0 -23 5 -23 40 0 41 13 50 54 34z m20 -130 c19 -18 19 -20 6 -45 -8 -13
-21 -19 -45 -19 -34 0 -35 1 -35 40 0 38 2 40 29 40 16 0 37 -7 45 -16z"></path>
<path class="text" fill="#000000" d="M319 271 c-23 -24 -29 -38 -29 -74 0 -25 3 -53 6 -62 20 -50 164 -64
164 -15 0 15 -7 17 -45 12 -46 -5 -75 8 -75 34 0 11 16 14 65 14 l65 0 0 35
c0 80 -92 114 -151 56z m99 -33 c3 -15 -4 -18 -37 -18 -43 0 -50 7 -29 28 18
18 62 11 66 -10z"></path>
<path class="text" fill="#000000" d="M520 184 c0 -107 -1 -116 -20 -121 -11 -3 -20 -12 -20 -19 0 -21 76
-19 84 2 3 9 6 69 6 135 l0 119 -25 0 -25 0 0 -116z"></path>
<path class="text" fill="#000000" d="M649 271 c-24 -25 -29 -37 -29 -78 1 -70 34 -103 105 -103 55 0 95
44 95 103 0 60 -7 75 -41 92 -47 25 -96 19 -130 -14z m111 -30 c25 -48 2 -111
-40 -111 -45 0 -69 80 -34 114 21 22 61 20 74 -3z"></path>
<path class="text" fill="#000000" d="M850 287 c0 -8 16 -57 36 -110 28 -76 33 -100 25 -116 -16 -28 -14
-31 18 -31 27 0 29 4 70 123 23 67 41 128 41 135 0 6 -11 12 -24 12 -21 0 -26
-8 -41 -65 -10 -36 -21 -68 -25 -70 -3 -2 -16 27 -29 66 -19 60 -25 69 -47 69
-13 0 -24 -6 -24 -13z"></path>
<path class="text" fill="#000000" d="M1192 284 c-17 -12 -22 -24 -20 -47 2 -26 10 -36 45 -52 49 -23 59
-55 17 -55 -14 0 -34 5 -45 10 -16 9 -19 7 -19 -13 0 -17 7 -27 23 -31 69 -18
117 6 117 60 0 32 -4 37 -45 55 -60 26 -62 54 -4 46 37 -5 40 -3 37 16 -2 18
-11 23 -43 25 -25 2 -49 -3 -63 -14z"></path>
</g>
</svg>

  </div>

  <ul class="nav sidebar-nav">
    <li><a href="../aws.html">AWS</a></li>
    <li><a href="../linux.html">Linux</a></li>
    <li><a href="../docker.html">Docker</a></li>
    <li><a href="../ibmpower.html">IBM Power</a></li>
    <li><a href="blogsataws1.html">Blogs@AWS (Kindle Friendly)</a></li>
  </ul>
</aside>


    <div class="container">
  <div class="row">
    <div id="docs-sidebar" class="col-sm-3 col-md-3 col-xs-12 hidden-print" role="complementary">
      <ul class="nav docs-sidenav">
      <li><a href="blogsataws1.html">Blogs @ AWS</a></li>
      <li><a href="whatsnew1.html">What's New @ AWS</a></li>
      <li><a href="mgmtblogs1.html">Management Tools Blogs @ AWS</a></li>
      <li><a href="computeblogs1.html">Compute Blogs @ AWS</a></li>
      <li><a href="devopsblogs1.html">DevOps Blogs @ AWS</a></li>
      <li class="active"><a href="secblogs1.html">Security Blogs @ AWS</a></li>
      <li><a href="apnblogs1.html">APN Blogs @ AWS</a></li>

    </ul>
    </div>

    <div id="inner" class="col-sm-9 col-md-9 col-xs-12" role="main">
<p></p>
<p><i>Contents of this page is copied directly from AWS blog sites to make it Kindle friendly. Some styles & sections from these pages are removed to render this properly in 'Article Mode' of Kindle e-Reader browser. All the contents of this page is property of AWS.</i></p>
<p><a href="secblogs1.html">Page 1</a>|<a href="secblogs2.html">Page 2</a>|<a href="secblogs3.html">Page 3</a>|<a href="secblogs4.html">Page 4</a></p>
<article class="blog-post" vocab="http://schema.org/" typeof="TechArticle"> 
<meta property="inLanguage" content="en-US" /> 
<meta property="image" content="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2017/12/12/GDPR.png" /> 
<b class="lb-b blog-post-title" property="name headline">All AWS Services GDPR ready</b> 
<p style="margin: 0; padding:0;">=======================<p>
<p>Today, I’m very pleased to announce that AWS services comply with the General Data Protection Regulation (GDPR). This means that, in addition to benefiting from all of the measures that AWS already takes to maintain services security, customers can deploy AWS services as a key part of their GDPR compliance plans.</p> 
<p>This announcement confirms we have completed the entirety of our GDPR service readiness audit, validating that all generally available services and features adhere to the high privacy bar and data protection standards required of data processors by the GDPR. We completed this work two months ahead of the May 25, 2018 enforcement deadline in order to give customers and APN partners an environment in which they can confidently build their own GDPR-compliant products, services, and solutions.</p> 
<p>AWS’s GDPR service readiness is only part of the story; we are continuing to work alongside our customers and the AWS Partner Network (APN) to help on their journey toward GDPR compliance. Along with this announcement, I’d like to highlight the following examples of ways AWS can help you accelerate your own GDPR compliance efforts.</p> 
<p><span style="text-decoration: underline"><strong>Security of Personal Data</strong></span><br /> During our GDPR service readiness audit, our security and compliance experts confirmed that AWS has in place effective technical and organizational measures for data processors to secure personal data in accordance with the GDPR. Security remains our highest priority, and we continue to innovate and invest in a high bar for security and compliance across all global operations. Our industry-leading functionality provides the foundation for our long list of internationally-recognized certifications and accreditations, demonstrating compliance with rigorous international standards, such as ISO 27001 for technical measures, <a href="https://aws.amazon.com/compliance/iso-27017-faqs/">ISO 27017</a> for cloud security, <a href="https://aws.amazon.com/compliance/iso-27018-faqs/">ISO 27018</a> for cloud privacy, SOC 1, SOC 2 and SOC 3, PCI DSS Level 1, and EU-specific certifications such as BSI’s <a href="https://aws.amazon.com/compliance/bsi-c5/">Common Cloud Computing Controls Catalogue</a> (C5). AWS continues to pursue the certifications that assist our customers.</p> 
<p><span style="text-decoration: underline"><strong>Compliance-enabling Services</strong></span><br /> Many requirements under the GDPR focus on ensuring effective control and protection of personal data. AWS services give you the capability to implement your own security measures in the ways you need in order to enable your compliance with the GDPR, including specific measures such as:</p> 
<li>Encryption of personal data</li> 
<li>Ability to ensure the ongoing confidentiality, integrity, availability, and resilience of processing systems and services</li> 
<li>Ability to restore the availability and access to personal data in a timely manner in the event of a physical or technical incident</li> 
<li>Processes for regularly testing, assessing, and evaluating the effectiveness of technical and organizational measures for ensuring the security of processing</li> 
<p>This is an advanced set of security and compliance services that are designed specifically to handle the requirements of the GDPR. There are numerous AWS services that have particular significance for customers focusing on GDPR compliance, including:</p> 
<li><a href="https://aws.amazon.com/guardduty/">Amazon GuardDuty</a> – a security service featuring intelligent threat detection and continuous monitoring</li> 
<li><a href="https://aws.amazon.com/macie/">Amazon Macie</a> – a machine learning tool to assist discovery and securing of personal data stored in Amazon S3</li> 
<li><a href="https://aws.amazon.com/inspector/">Amazon Inspector</a> – an automated security assessment service to help keep applications in conformity with best security practices</li> 
<li><a href="https://docs.aws.amazon.com/config/latest/developerguide/managed-rules-by-aws-config.html">AWS Config Rules</a> – a monitoring service that dynamically checks cloud resources for compliance with security rules</li> 
<p>Additionally, we have published a whitepaper, “<a href="https://d1.awsstatic.com/whitepapers/compliance/GDPR_Compliance_on_AWS.pdf">Navigating GDPR Compliance on AWS</a>,” dedicated to this topic. This paper details how to tie GDPR concepts to specific AWS services, including those relating to monitoring, data access, and key management. Furthermore, our <a href="https://aws.amazon.com/compliance/gdpr-center/">GDPR Center</a> will give you access to the up-to-date resources you need to tackle requirements that directly support your GDPR efforts.</p> 
<p><span style="text-decoration: underline"><strong>Compliant DPA</strong></span><br /> We <a href="https://aws.amazon.com/contact-us/">offer</a> a GDPR-compliant Data Processing Addendum (DPA), enabling you to comply with GDPR contractual obligations.</p> 
<p><span style="text-decoration: underline"><strong>Conformity with a Code of Conduct</strong></span><br /> GDPR introduces adherence to a “code of conduct” as a mechanism for demonstrating sufficient guarantees of requirements that the GDPR places on data processors. In this context, we previously announced compliance with the CISPE Code of Conduct. The CISPE Code of Conduct provides customers with additional assurances regarding their ability to fully control their data in a safe, secure, and compliant environment when they use services from providers like AWS. More detail about the CISPE Code of Conduct can be found at: <a href="https://aws.amazon.com/compliance/cispe/">https://aws.amazon.com/compliance/cispe/</a></p> 
<p><span style="text-decoration: underline"><strong>Training and Summits</strong></span><br /> We can provide you with training on navigating GDPR compliance using AWS services via our Professional Services team. This team has a GDPR workshop offering, which is a two-day facilitated session customized to your specific needs and challenges. We are also providing GDPR presentations during our AWS Summits in European countries, as well as San Francisco and Tokyo.</p> 
<p><span style="text-decoration: underline"><strong>Additional Resources</strong></span><br /> Finally, we have teams of compliance, data protection, and security experts, as well as the APN, helping customers across Europe prepare for running regulated workloads in the cloud as the GDPR becomes enforceable. For additional information on this, please contact your AWS Account Manager.</p> 
<p>As we move towards May 25 and beyond, we’ll be posting a series of blogs to dive deeper into GDPR-related concepts along with how AWS can help. Please visit our <strong><a href="https://aws.amazon.com/compliance/gdpr-center/">GDPR Center</a></strong>&nbsp;for more information. We’re excited about being your partner in fully addressing this important regulation.</p> 
<p>-Chad Woolf</p> 
<p>Vice President, AWS Security Assurance</p> 
<p><strong>Interested in additional AWS Security news? Follow the AWS Security Blog <a href="https://twitter.com/AWSsecurityinfo">on Twitter</a>.</strong></p> 
<script>
require(['blog'], function() {
AWS.Blog.commenting('#aws-comment-trigger-7487');
});
</script> 
</article> 
<article class="blog-post" vocab="http://schema.org/" typeof="TechArticle"> 
<meta property="inLanguage" content="en-US" /> 
<meta property="image" content="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2018/03/24/Spain_flag800x400.png" /> 
<b class="lb-b blog-post-title" property="name headline">AWS Achieves Spain’s ENS High Certification Across 29 Services</b> 
<p style="margin: 0; padding:0;">=======================<p>
<p>AWS has achieved Spain’s <a href="https://aws.amazon.com/compliance/esquema-nacional-de-seguridad" title="undefined" target="_blank">Esquema Nacional de Seguridad (ENS) High certification</a> across 29 services. To successfully achieve the ENS High Standard, BDO Espa&ntilde;a conducted an independent audit and attested that AWS meets confidentiality, integrity, and availability standards. This provides the assurance needed by Spanish Public Sector organizations wanting to build secure applications and services on AWS.</p> 
<p>The National Security Framework, regulated under Royal Decree 3/2010, was developed through close collaboration between ENAC (Entidad Nacional de Acreditaci&oacute;n), the Ministry of Finance and Public Administration and the CCN (National Cryptologic Centre), and other administrative bodies.</p> 
<p>The following AWS Services are ENS High accredited across our Dublin and Frankfurt Regions:</p> 
<li>Amazon API Gateway</li> 
<li>Amazon DynamoDB</li> 
<li>Amazon Elastic Container Service</li> 
<li>Amazon Elastic Block Store</li> 
<li>Amazon Elastic Compute Cloud</li> 
<li>Amazon Elastic File System</li> 
<li>Amazon Elastic MapReduce</li> 
<li>Amazon ElastiCache</li> 
<li>Amazon Glacier</li> 
<li>Amazon Redshift</li> 
<li>Amazon Relational Database Service</li> 
<li>Amazon Simple Queue Service</li> 
<li>Amazon Simple Storage Service</li> 
<li>Amazon Simple Workflow Service</li> 
<li>Amazon Virtual Private Cloud</li> 
<li>Amazon WorkSpaces</li> 
<li>AWS CloudFormation</li> 
<li>AWS CloudTrail</li> 
<li>AWS Config</li> 
<li>AWS Database Migration Service</li> 
<li>AWS Direct Connect</li> 
<li>AWS Directory Service</li> 
<li>AWS Elastic Beanstalk</li> 
<li>AWS Key Management Service</li> 
<li>AWS Lambda</li> 
<li>AWS Snowball</li> 
<li>AWS Storage Gateway</li> 
<li>Elastic Load Balancing</li> 
<li>VM Import/Export</li> 
<script>
require(['blog'], function() {
AWS.Blog.commenting('#aws-comment-trigger-7496');
});
</script> 
</article> 
<article class="blog-post" vocab="http://schema.org/" typeof="TechArticle"> 
<meta property="inLanguage" content="en-US" /> 
<meta property="image" content="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2018/03/16/KeyLockIdCard800x400-featured-image.png" /> 
<b class="lb-b blog-post-title" property="name headline">AWS Key Management Service now offers FIPS 140-2 validated cryptographic modules enabling easier adoption of the service for regulated workloads</b> 
<p style="margin: 0; padding:0;">=======================<p>
<p>AWS Key Management Service (KMS) now uses FIPS 140-2 validated hardware security modules (HSM) and supports FIPS 140-2 validated endpoints, which provide independent assurances about the confidentiality and integrity of your keys. Having additional third-party assurances about the keys you manage in AWS KMS can make it easier to use the service for regulated workloads.</p> 
<p>The process of gaining FIPS 140-2 validation is rigorous. First, AWS KMS HSMs were tested by an independent lab; those results were further reviewed by the <a href="https://csrc.nist.gov/Projects/Cryptographic-Module-Validation-Program" title="undefined" target="_blank">Cryptographic Module Validation Program</a> run by NIST. You can view the <a href="https://csrc.nist.gov/projects/cryptographic-module-validation-program/Certificate/3139" title="undefined" target="_blank">FIPS 140-2 certificate of the AWS Key Management Service HSM</a> to get more details.</p> 
<p>AWS KMS HSMs are designed so that no one, not even AWS employees, can retrieve your plaintext keys. The service uses the FIPS 140-2 validated HSMs to protect your keys when you request the service to create keys on your behalf or when you import them. Your plaintext keys are never written to disk and are only used in volatile memory of the HSMs while performing your requested cryptographic operation. Furthermore, AWS KMS keys are never transmitted outside the AWS Regions they were created. And HSM firmware updates are controlled by multi-party access that is audited and reviewed by an independent group within AWS. </p> 
<p>AWS KMS HSMs are validated at level 2 overall and at level 3 in the following areas:</p> 
<li>Cryptographic Module Specification</li> 
<li>Roles, Services, and Authentication</li> 
<li>Physical Security</li> 
<li>Design Assurance</li> 
<p>You can also make AWS KMS requests to API endpoints that terminate TLS sessions using a FIPS 140-2 validated cryptographic software module. To do so, connect to the unique <a href="https://docs.aws.amazon.com/general/latest/gr/rande.html#kms_region" title="undefined" target="_blank">FIPS 140-2 validated HTTPS endpoints</a> in the AWS KMS requests made from your applications. AWS KMS FIPS 140-2 validated HTTPS endpoints are powered by the <a href="https://www.openssl.org/docs/fips/SecurityPolicy-2.0.13.pdf" title="undefined" target="_blank">OpenSSL FIPS Object Module</a>. FIPS 140-2 validated API endpoints are available in all commercial regions where AWS KMS is available.</p> 
<script>
require(['blog'], function() {
AWS.Blog.commenting('#aws-comment-trigger-7478');
});
</script> 
</article> 
<article class="blog-post" vocab="http://schema.org/" typeof="TechArticle"> 
<meta property="inLanguage" content="en-US" /> 
<meta property="image" content="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2018/03/13/AmazonGuardDuty-for-featured-image.png" /> 
<b class="lb-b blog-post-title" property="name headline">How we reduce complexity and rapidly iterate on Amazon GuardDuty: twelve new detections added</b> 
<p style="margin: 0; padding:0;">=======================<p>
<p>We’re relentlessly innovating on your behalf at AWS, especially when it comes to security. Last November, we launched Amazon GuardDuty, a continuous security monitoring and threat detection service that incorporates threat intelligence, anomaly detection, and machine learning to help protect your AWS resources, including your AWS accounts. Many large customers, including <a title="undefined" href="https://www.businesswire.com/news/home/20171128006613/en/AWS-Announces-Amazon-GuardDuty" target="_blank" rel="noopener noreferrer">General Electric, Autodesk, and MapBox</a>, discovered these benefits and have quickly adopted the service for its ease of use and improved threat detection. In this post, I want to show you how easy it is for everyone to get started—large and small—and discuss our rapid iteration on the service.</p> 
<p>After more than seven years at AWS, I still find myself staying up at night obsessing about unnecessary complexity. Sounds fun, right? Well, I don’t have to tell you that there’s a lot of unnecessary complexity and undifferentiated heavy lifting in security. Most security tooling requires significant care and feeding by humans. It’s often difficult to configure and manage, it’s hard to know if it’s working properly, and it’s costly to procure and run. As a result, it’s not accessible to all customers, and for those that do get their hands on it, they spend a lot of highly-skilled resources trying to keep it operating at its potential.</p> 
<p>Even for the most skilled security teams, it can be a struggle to ensure that all resources are covered, especially in the age of virtualization, where new accounts, new resources, and new users can come and go across your organization at a rapid pace. Furthermore, attackers have come up with ingenious ways of giving you the impression your security solution is working when, in fact, it has been completely disabled.</p> 
<p>I’ve spent a lot of time obsessing about these problems. How can we use the Cloud to not just innovate in security, but also make it easier, more affordable, and more accessible to all? Our ultimate goal is to help you better protect your AWS resources, while also freeing you up to focus on the next big project.</p> 
<p>With GuardDuty, we really turned the screws on unnecessary complexity, distilling continuous security monitoring and threat detection down to a binary decision—it’s either on or off. That’s it. There’s no software, virtual appliances, or agents to deploy, no data sources to enable, and no complex permissions to create. You don’t have to write custom rules or become an expert at machine learning. All we ask of you is to simply turn the service on with a single-click or API call.</p> 
<p>GuardDuty operates completely on our infrastructure, so there’s no risk of disrupting your workloads. By providing a hard hypervisor boundary between the code running in your AWS accounts and the code running in GuardDuty, we can help ensure full coverage while making it harder for a misconfiguration or an ingenious attacker to change that. When we detect something interesting, we generate a security finding and deliver it to you through the GuardDuty console and AWS CloudWatch Events. This makes it possible to simply view findings in GuardDuty or push them to an existing SIEM or workflow system. We’ve already seen customers take it a step further using AWS Lambda to automate actions such as changing security groups, isolating instances, or rotating credentials.</p> 
<p>Now… are you ready to get started? It’s this simple:</p> 
<p><img width="100%" src="https://d1.awsstatic.com/security-center/SecurityBlog/guard_duty_enable_1.aaab2e0d1fc629e4aa6956d0bc127555e82c74ae.png" /></p> 
<b>So, you’ve got it enabled, now what can GuardDuty detect?</b> 
<p>As soon as you enable the service, it immediately starts consuming multiple metadata streams at scale, including AWS CloudTrail, VPC Flow Logs, and DNS logs. It compares what it finds to fully managed threat intelligence feeds containing the latest malicious IPs and domains. In parallel, GuardDuty profiles all activity in your account, which allows it to learn the behavior of your resources so it can identify highly suspicious activity that suggests a threat.</p> 
<p>The threat-intelligence-based detections can identify activity such as an EC2 instance being probed or brute-forced by an attacker. If an instance is compromised, it can detect attempts at lateral movement, communication with a known malware or command-and-control server, crypto-currency mining, or an attempt to exfiltrate data through DNS.</p> 
<p>Where it gets more interesting is the ability to detect AWS account-focused threats. For example, if an attacker gets a hold of your AWS account credentials—say, one of your developers exposes credentials on GitHub—GuardDuty will identify unusual account behavior. For example, an unusual instance type being deployed in a region that has never been used, suspicious attempts to inventory your resources by calling unusual patterns of list APIs or describe APIs, or an effort to obscure user activity by disabling CloudTrail logging.</p> 
<p>Our obsession with removing complexity meant making these detections fully-managed. We take on all the heavy lifting of building, maintaining, measuring, and improving the detections so that you can focus on what to do when an event does occur.</p> 
<b>What’s new?</b> 
<p>When we launched at the end of November, we had thirty-four distinct detections in GuardDuty, but we weren’t stopping there. Many of these detections are already on their second or third continuous improvement iteration. In less than three months, we’ve also added twelve more, including nine CloudTrail-based anomaly detections that identify highly suspicious activity in your accounts. These new detections intelligently catch changes to, or reconnaissance of, network, resource, user permissions, and anomalous activity in EC2, CloudTrail, and AWS console log-ins. These are detections we’ve built based on what we’ve learned from observed attack patterns across the scale of AWS.</p> 
<p>The intelligence in these detections is built around the identification of <strong>highly sensitive</strong> AWS API calls that are invoked under one or more <strong>highly suspicious</strong> circumstances. The combination of “highly sensitive” and “highly suspicious” is important. Highly sensitive APIs are those that either change the security posture of an account by adding or elevating users, user policies, roles, or account-key IDs (AKIDs). Highly suspicious circumstances are determined from underlying models profiled at the API level by GuardDuty. The result is the ability to catch real threats, while decreasing false positives, limiting false negatives, and reducing alert-noise.</p> 
<b>It’s still day one</b> 
<p>As we like to say in Amazon, it’s still day one. I’m excited about what we’ve built with GuardDuty, but we’re not going to stop improving, even if you’re already happy with what we’ve built. Check out the list of new detections below and all of the <a title="undefined" href="https://docs.aws.amazon.com/guardduty/latest/ug/what-is-guardduty.html" target="_blank" rel="noopener noreferrer">GuardDuty detections in our online documentation</a>. Keep the feedback coming as it’s what powers us at AWS.</p> 
<p>Now, I have to stop writing because my wife tells me I have some unnecessary complexity to remove from our closet.</p> 
<b>New GuardDuty CloudTrail-based anomaly detections</b> 
<ol> 
<li><strong>Recon:IAMUser/NetworkPermissions</strong><br /> <strong>Situation</strong>: An IAM user invoked an API commonly used to discover the network access permissions of existing security groups, ACLs, and routes in your AWS account.<br /> <strong>Description</strong>: This finding is triggered when network configuration settings in your AWS environment are probed under suspicious circumstances. For example, if an IAM user in your AWS environment invoked the DescribeSecurityGroups API with no prior history of doing so. An attacker might use stolen credentials to perform this reconnaissance of network configuration settings before executing the next stage of their attack, which might include changing network permissions or making use of existing openings in the network configuration.<br /> &nbsp;</li> 
<li><strong>Recon:IAMUser/ResourcePermissions</strong><br /> <strong>Situation</strong>: An IAM user invoked an API commonly used to discover the permissions associated with various resources in your AWS account.<br /> <strong>Description</strong>: This finding is triggered when resource access permissions in your AWS account are probed under suspicious circumstances. For example, if an IAM user with no prior history of doing so, invoked the DescribeInstances API. An attacker might use stolen credentials to perform this reconnaissance of your AWS resources in order to find valuable information or determine the capabilities of the credentials they already have.<br /> &nbsp;</li> 
<li><strong>Recon:IAMUser/UserPermissions</strong><br /> <strong>Situation</strong>: An IAM user invoked an API commonly used to discover the users, groups, policies, and permissions in your AWS account.<br /> <strong>Description</strong>: This finding is triggered when user permissions in your AWS environment are probed under suspicious circumstances. For example, if an IAM user invoked the ListInstanceProfilesForRole API with no prior history of doing so. An attacker might use stolen credentials to perform this reconnaissance of your IAM users and roles to determine the capabilities of the credentials they already have or to find more permissive credentials that are vulnerable to lateral movement.<br /> &nbsp;</li> 
<li><strong>Persistence:IAMUser/NetworkPermissions</strong><br /> <strong>Situation</strong>: An IAM user invoked an API commonly used to change the network access permissions for security groups, routes, and ACLs in your AWS account.<br /> <strong>Description</strong>: This finding is triggered when network configuration settings are changed under suspicious circumstances. For example, if an IAM user in your AWS environment invoked the CreateSecurityGroup API with no prior history of doing so. Attackers often attempt to change security groups, allowing certain inbound traffic on various ports to improve their ability to access the bot they might have planted on your EC2 instance.<br /> &nbsp;</li> 
<li><strong>Persistence:IAMUser/ResourcePermissions</strong><br /> <strong>Situation</strong>: An IAM user invoked an API commonly used to change the security access policies of various resources in your AWS account.<br /> <strong>Description</strong>: This finding is triggered when a change is detected to policies or permissions attached to AWS resources. For example, if an IAM user in your AWS environment invoked the PutBucketPolicy API with no prior history of doing so. Some services, such as Amazon S3, support resource-attached permissions that grant one or more IAM principals access to the resource. With stolen credentials, attackers can change the policies attached to a resource, granting themselves future access to that resource.<br /> &nbsp;</li> 
<li><strong>Persistence:IAMUser/UserPermissions</strong><br /> <strong>Situation</strong>: An IAM user invoked an API commonly used to add, modify, or delete IAM users, groups, or policies in your AWS account.<br /> <strong>Description</strong>: This finding is triggered by suspicious changes to the user-related permissions in your AWS environment. For example, if an IAM user in your AWS environment invoked the AttachUserPolicy API with no prior history of doing so. In an effort to maximize their ability to access the account even after they’ve been discovered, attackers can use stolen credentials to create new users, add access policies to existing users, create access keys, and so on. The owner of the account might notice that a particular IAM user or password was stolen and delete it from the account, but might not delete other users that were created by the fraudulently created admin IAM user, leaving their AWS account still accessible to the attacker.<br /> &nbsp;</li> 
<li><strong>ResourceConsumption:IAMUser/ComputeResources</strong><br /> <strong>Situation</strong>: An IAM user invoked an API commonly used to launch compute resources like EC2 Instances.<br /> <strong>Description</strong>: This finding is triggered when EC2 instances in your AWS environment are launched under suspicious circumstances. For example, if an IAM user invoked the RunInstances API with no prior history of doing so. This might be an indication of an attacker using stolen credentials to access compute time (possibly for cryptocurrency mining or password cracking). It can also be an indication of an attacker using an EC2 instance in your AWS environment and its credentials to maintain access to your account.<br /> &nbsp;</li> 
<li><strong>Stealth:IAMUser/LoggingConfigurationModified</strong><br /> <strong>Situation</strong>: An IAM user invoked an API commonly used to stop CloudTrail logging, delete existing logs, and otherwise eliminate traces of activity in your AWS account.<br /> <strong>Description</strong>: This finding is triggered when the logging configuration in your AWS account is modified under suspicious circumstances. For example, if an IAM user invoked the StopLogging API with no prior history of doing so. This can be an indication of an attacker trying to cover their tracks by eliminating any trace of their activity.<br /> &nbsp;</li> 
<li><strong>UnauthorizedAccess:IAMUser/ConsoleLogin</strong><br /> <strong>Situation</strong>: An unusual console login by an IAM user in your AWS account was observed.<br /> <strong>Description</strong>: This finding is triggered when a console login is detected under suspicious circumstances. For example, if an IAM user invoked the ConsoleLogin API from a never-before- used client or an unusual location. This could be an indication of stolen credentials being used to gain access to your AWS account, or a valid user accessing the account in an invalid or less secure manner (for example, not over an approved VPN).</li> 
</ol> 
<b>New GuardDuty threat intelligence based detections</b> 
<ol> 
<li><strong>Trojan:EC2/PhishingDomainRequest!DNS</strong><br /> This detection occurs when an EC2 instance queries domains involved in phishing attacks.<br /> &nbsp;</li> 
<li><strong>Trojan:EC2/BlackholeTraffic!DNS</strong><br /> This detection occurs when an EC2 instance connects to a black hole domain. Black holes refer to places in the network where incoming or outgoing traffic is silently discarded without informing the source that the data didn’t reach its intended recipient.<br /> &nbsp;</li> 
<li><strong>Trojan:EC2/DGADomainRequest.C!DNS</strong><br /> This detection occurs when an EC2 instance queries algorithmically generated domains. Such domains are commonly used by malware and could be an indication of a compromised EC2 instance.</li> 
</ol> 
<p>If you have feedback about this blog post, submit comments in the “Comments” section below. If you have questions about this blog post, start a new thread on the <a title="undefined" href="https://forums.aws.amazon.com/forum.jspa?forumID=288" target="_blank" rel="noopener noreferrer">Amazon GuardDuty forum</a> or contact <a title="undefined" href="https://console.aws.amazon.com/support/home" target="_blank" rel="noopener noreferrer">AWS Support</a>.</p> 
<script>
require(['blog'], function() {
AWS.Blog.commenting('#aws-comment-trigger-7445');
});
</script> 
</article> 
<article class="blog-post" vocab="http://schema.org/" typeof="TechArticle"> 
<meta property="inLanguage" content="en-US" /> 
<meta property="image" content="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2018/03/07/Vijay-featured-image-800-by-400.png" /> 
<b class="lb-b blog-post-title" property="name headline">How to Delegate Administration of Your AWS Managed Microsoft AD Directory to Your On-Premises Active Directory Users</b> 
<p style="margin: 0; padding:0;">=======================<p>
<p>You can now enable your on-premises users administer your <a title="undefined" href="https://aws.amazon.com/directoryservice/" target="_blank" rel="noopener noreferrer">AWS Directory Service for Microsoft Active Directory</a>, also known as AWS Managed Microsoft AD. Using an <a title="undefined" href="https://docs.aws.amazon.com/directoryservice/latest/admin-guide/setup_trust.html" target="_blank" rel="noopener noreferrer">Active Directory (AD) trust</a> and the new AWS delegated AD security groups, you can grant administrative permissions to your on-premises users by managing group membership in your on-premises AD directory. This simplifies how you manage who can perform administration. It also makes it easier for your administrators because they can sign in to their existing workstation with their on-premises AD credential to administer your AWS Managed Microsoft AD.</p> 
<p>AWS created new domain local AD security groups (AWS delegated groups) in your AWS Managed Microsoft AD directory. Each AWS delegated group has unique AD administrative permissions. Users that are members in the new AWS delegated groups get permissions to perform administrative tasks, such as <a title="undefined" href="https://docs.aws.amazon.com/directoryservice/latest/admin-guide/creating_ad_users_and_groups.html" target="_blank" rel="noopener noreferrer">add users</a>, <a title="undefined" href="https://aws.amazon.com/blogs/security/how-to-configure-even-stronger-password-policies-to-help-meet-your-security-standards-by-using-aws-directory-service-for-microsoft-active-directory/" target="_blank" rel="noopener noreferrer">configure fine-grained password policies</a> and <a title="undefined" href="https://aws.amazon.com/blogs/security/how-to-enable-ldaps-for-your-aws-microsoft-ad-directory/" target="_blank" rel="noopener noreferrer">enable Microsoft enterprise Certificate Authority</a>. Because the AWS delegated groups are domain local in scope, you can use them through an AD Trust to your on-premises AD. This eliminates the requirement to create and use separate identities to administer your AWS Managed Microsoft AD. Instead, by adding selected on-premises users to desired AWS delegated groups, you can grant your administrators some or all of the permissions. You can simplify this even further by adding on-premises AD security groups to the AWS delegated groups. This enables you to add and remove users from your on-premises AD security group so that they can manage administrative permissions in your AWS Managed Microsoft AD.</p> 
<p>In this blog post, I will show you how to delegate permissions to your on-premises users to perform an administrative task–configuring fine-grained password policies–in your AWS Managed Microsoft AD directory. You can follow the steps in this post to delegate other administrative permissions, such as configuring <a title="undefined" href="https://docs.aws.amazon.com/directoryservice/latest/admin-guide/admin_permissions.html#gmsa" target="_blank" rel="noopener noreferrer">group Managed Service Accounts</a> and <a title="undefined" href="https://docs.aws.amazon.com/directoryservice/latest/admin-guide/admin_permissions.html#kcd" target="_blank" rel="noopener noreferrer">Kerberos constrained delegation</a>, to your on-premises users.</p> 
<b>Background</b> 
<p>Until now, AWS Managed Microsoft AD delegated administrative permissions for your directory by creating AD security groups in your <a title="undefined" href="https://docs.aws.amazon.com/directoryservice/latest/admin-guide/admin_permissions.html" target="_blank" rel="noopener noreferrer">Organization Unit</a> (OU) and authorizing these <a title="undefined" href="https://docs.aws.amazon.com/directoryservice/latest/admin-guide/create_details_managed.html" target="_blank" rel="noopener noreferrer">AWS delegated groups</a> for <a title="undefined" href="https://docs.aws.amazon.com/directoryservice/latest/admin-guide/admin_permissions.html" target="_blank" rel="noopener noreferrer">common administrative activities</a>. The <a title="undefined" href="https://docs.aws.amazon.com/directoryservice/latest/admin-guide/admin_permissions.html" target="_blank" rel="noopener noreferrer">admin user</a> in your directory created user accounts within your OU, and granted these users permissions to administer your directory by adding them to one or more of these AWS delegated groups.</p> 
<p>However, if you used your AWS Managed Microsoft AD with a <a title="undefined" href="https://docs.aws.amazon.com/directoryservice/latest/admin-guide/setup_trust.html" target="_blank" rel="noopener noreferrer">trust</a> to an on-premises AD forest, you couldn’t add users from your on-premises directory to these AWS delegated groups. This is because AWS created the AWS delegated groups with <a title="undefined" href="https://technet.microsoft.com/en-us/library/cc755692(v=ws.10).aspx" target="_blank" rel="noopener noreferrer">global</a> scope, which restricts adding users from another forest. This necessitated that you create different user accounts in AWS Managed Microsoft AD for the purpose of administration. As a result, AD administrators typically had to remember additional credentials for AWS Managed Microsoft AD.</p> 
<p>To address this, AWS created new AWS delegated groups with <a title="undefined" href="https://technet.microsoft.com/en-us/library/cc755692(v=ws.10).aspx" target="_blank" rel="noopener noreferrer">domain local</a> scope in a separate OU called AWS Delegated Groups. These new AWS delegated groups with domain local scope are more flexible and permit adding users and groups from other domains and forests. This allows your admin user to delegate your on-premises users and groups administrative permissions to your AWS Managed Microsoft AD directory.</p> 
<blockquote> 
<p>Note: If you already have an existing AWS Managed Microsoft AD directory containing the original AWS delegated groups with global scope, AWS preserved the original AWS delegated groups in the event you are currently using them with identities in AWS Managed Microsoft AD. AWS recommends that you transition to use the new AWS delegated groups with domain local scope. All newly created AWS Managed Microsoft AD directories have the new AWS delegated groups with domain local scope only.</p> 
</blockquote> 
<p>Now, I will show you the steps to delegate administrative permissions to your on-premises users and groups to configure fine-grained password policies in your AWS Managed Microsoft AD directory.</p> 
<b>Prerequisites</b> 
<p>For this post, I assume you are familiar with <a title="undefined" href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/dn579255(v=ws.11)" target="_blank" rel="noopener noreferrer">AD security groups</a> and how security group scope rules work. I also assume you are familiar with <a title="undefined" href="https://technet.microsoft.com/en-us/library/cc977993.aspx" target="_blank" rel="noopener noreferrer">AD trusts</a>.</p> 
<p>The instructions in this blog post require you to have the following components running:</p> 
<li><strong>An active AWS Managed Microsoft AD directory</strong>. To create a directory, follow the steps in <a title="undefined" href="http://docs.aws.amazon.com/directoryservice/latest/admin-guide/create_directory.html" target="_blank" rel="noopener noreferrer">Creating an AWS Managed Microsoft AD directory</a>. You also need to know the password for the <code>admin</code> account so that you can add other users and groups to the AWS created AD security groups in the AWS Managed Microsoft AD directory.</li> 
<li><strong>An existing on-premises AD directory</strong>. Your on-premises AD directory must contain a user that you want to delegate permissions to manage your AWS Managed Microsoft AD directory.</li> 
<li><strong>A trust relationship between your AWS Managed Microsoft AD and your on-premises AD</strong>. To learn more, see <a title="undefined" href="https://aws.amazon.com/blogs/security/now-available-simplified-configuration-of-trust-relationships-in-the-aws-directory-service-console/" target="_blank" rel="noopener noreferrer">Simplified Configuration of Trust Relationship in the AWS Directory Service Console</a>. You can create a one-way outgoing trust from your AWS Managed Microsoft AD directory to your on-premises AD directory, or a two-way trust.</li> 
<li><strong>A machine joined to AWS Managed Microsoft AD domain with Active Directory Users and Computers (ADUC) tool installed</strong>. If you don’t have an existing machine with ADUC installed, you can <a title="undefined" href="https://aws.amazon.com/blogs/aws/seamlessly-join-ec2-instances-to-a-domain/" target="_blank" rel="noopener noreferrer">join an Amazon EC2 for Windows Server instance to your AWS Managed Microsoft AD domain</a> and install <a title="undefined" href="http://docs.aws.amazon.com/directoryservice/latest/admin-guide/install_ad_tools.html" target="_blank" rel="noopener noreferrer">Active Directory Administrative Tools</a>.</li> 
<li><strong>A machine joined to your on-premises AD directory with ADUC installed</strong>. You can install ADUC by installing <a title="undefined" href="http://docs.aws.amazon.com/directoryservice/latest/admin-guide/install_ad_tools.html" target="_blank" rel="noopener noreferrer">Active Directory Administrative Tools</a> on a Windows computer that you joined to your on-premises AD domain.</li> 
<b>Solution overview</b> 
<p>I will now show you how to manage which on-premises users have delegated permissions to administer your directory by efficiently using on-premises AD security groups to manage these permissions. I will do this by:</p> 
<ol> 
<li>Adding on-premises groups to an AWS delegated group. In this step, you sign in to management instance connected to AWS Managed Microsoft AD directory as <code>admin</code> user and add on-premises groups to AWS delegated groups.</li> 
<li>Administer your AWS Managed Microsoft AD directory as on-premises user. In this step, you sign in to a workstation connected to your on-premises AD using your on-premises credentials and administer your AWS Managed Microsoft AD directory.</li> 
</ol> 
<p>For the purpose of this blog, I already have an on-premises AD directory (in this case, <code>on-premises.com</code>). I also created an AWS Managed Microsoft AD directory (in this case, <code>corp.example.com</code>) that I use with <a title="undefined" href="https://aws.amazon.com/rds/sqlserver/" target="_blank" rel="noopener noreferrer">Amazon RDS for SQL Server</a>. To enable <a title="undefined" href="https://en.wikipedia.org/wiki/Integrated_Windows_Authentication" target="_blank" rel="noopener noreferrer">Integrated Windows Authentication</a> to my <code>on-premises.com</code> domain, I established a one-way outgoing trust from my AWS Managed Microsoft AD directory to my on-premises AD directory. To administer my AWS Managed Microsoft AD, I created an Amazon EC2 for Windows Server instance (in this case, <code>Cloud Management</code>). I also have an on-premises workstation (in this case, <code>On-premises Management</code>), that is connected to my on-premises AD directory.</p> 
<p>The following diagram represents the relationships between the on-premises AD and the AWS Managed Microsoft AD directory.</p> 
<p>The left side represents the AWS Cloud containing AWS Managed Microsoft AD directory. I connected the directory to the on-premises AD directory via a 1-way forest trust relationship. When AWS created my AWS Managed Microsoft AD directory, AWS created a group called <code>AWS Delegated Fine Grained Password Policy Administrators</code> that has permissions to configure fine-grained password policies in AWS Managed Microsoft AD.</p> 
<p>The right side of the diagram represents the on-premises AD directory. I created a global AD security group called <code>On-premises fine grained password policy admins</code> and I configured it so all members can manage fine grained password policies in my on-premises AD. I have two administrators in my company, <code>John</code> and <code>Richard</code>, who I added as members of <code>On-premises fine grained password policy admins</code>. I want to enable <code>John</code> and <code>Richard</code> to also manage fine grained password policies in my AWS Managed Microsoft AD.</p> 
<p>While I could add <code>John</code> and <code>Richard</code> to the <code>AWS Delegated Fine Grained Password Policy Administrators</code> individually, I want a more efficient way to delegate and remove permissions for on-premises users to manage fine grained password policies in my AWS Managed Microsoft AD. In fact, I want to assign permissions to the same people that manage password policies in my on-premises directory.</p> 
<p><img width="100%" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2018/03/06/Vijay-Sharma-01.png" /></p> 
<p>To do this, I will:</p> 
<ol> 
<li>As <code>admin</code> user, add the <code>On-premises fine grained password policy admins</code> as member of the <code>AWS Delegated Fine Grained Password Policy Administrators</code> security group from my <code>Cloud Management</code> machine.</li> 
<li>Manage who can administer password policies in my AWS Managed Microsoft AD directory by adding and removing users as members of the <code>On-premises fine grained password policy admins</code>. Doing so enables me to perform all my delegation work in my on-premises directory without the need to use a remote desktop protocol (RDP) session to my <code>Cloud Management</code> instance. In this case, <code>Richard</code>, who is a member of <code>On-premises fine grained password policy admins</code> group can now administer AWS Managed Microsoft AD directory from <code>On-premises Management</code> workstation.</li> 
</ol> 
<p>Although I’m showing a specific case using fine grained password policy delegation, you can do this with any of the new AWS delegated groups and your on-premises groups and users.</p> 
<p>Let’s get started.</p> 
<b>Step 1 – Add on-premises groups to AWS delegated groups</b> 
<p>In this step, open an RDP session to the Cloud Management instance and sign in as the admin user in your AWS Managed Microsoft AD directory. Then, add your users and groups from your on-premises AD to AWS delegated groups in AWS Managed Microsoft AD directory. In this example, I do the following:</p> 
<ol> 
<li>Sign in to the <code>Cloud Management</code> instance with the user name <code>admin</code> and the password that you set for the <code>admin</code> user when you created your directory.</li> 
<li>Open the <strong>Microsoft Windows Server Manager</strong> and navigate to <strong>Tools</strong> &gt; <strong>Active Directory Users and Computers</strong>.<br /> <img width="100%" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2018/03/06/Vijay-Sharma-Step-1-02-300x150.png" /></li> 
<li>Switch to the tree view and navigate to <strong>corp.example.com</strong> &gt; <strong>AWS Delegated Groups</strong>. Right-click <strong>AWS Delegated Fine Grained Password Policy Administrators</strong> and select <strong>Properties</strong>.<br /> <img width="100%" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2018/03/06/Vijay-Sharma-Step-1-03-300x127.png" /></li> 
<li>In the <strong>AWS Delegated Fine Grained Password Policy</strong> window, switch to <strong>Members</strong> tab and choose <strong>Add</strong>.<br /> <img width="100%" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2018/03/06/Vijay-Sharma-Step-1-04-269x300.png" /></li> 
<li>In the <strong>Select Users, Contacts, Computers, Service Accounts, or Groups</strong> window, choose <strong>Locations</strong>.<br /> <img width="100%" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2018/03/06/Vijay-Sharma-Step-1-05-300x165.png" /></li> 
<li>In the <strong>Locations</strong> window, select <strong>on-premises.com domain</strong> and choose <strong>OK</strong>.<br /> <img width="100%" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2018/03/06/Vijay-Sharma-Step-1-06-300x174.png" /></li> 
<li>In the <strong>Enter the object names to select</strong> box, enter <code>on-premises fine grained password policy admins</code> and choose <strong>Check Names</strong>.<br /> <img width="100%" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2018/03/06/Vijay-Sharma-Step-1-07-300x165.png" /></li> 
<li>Because I have a 1-way trust from AWS Managed Microsoft AD to my on-premises AD, Windows prompts me to enter credentials for an on-premises user account that has permissions to complete the search. If I had a 2-way trust and the admin account in my AWS Managed Microsoft AD has permissions to read my on-premises directory, Windows will not prompt me.In the <strong>Windows Security</strong> window, enter the credentials for an account with permissions for <code>on-premises.com</code> and choose <strong>OK</strong>.<br /> <img width="100%" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2018/03/06/Vijay-Sharma-Step-1-08-300x280.png" /></li> 
<li>Click <strong>OK</strong> to add <code>On-premises fine grained password policy admins</code> group as a member of the <code>AWS Delegated Fine Grained Password Policy Administrators</code> group in your AWS Managed Microsoft AD directory.<br /> <img width="100%" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2018/03/06/Vijay-Sharma-Step-1-09-300x165.png" /></li> 
</ol> 
<p>At this point, any user that is a member of <code>On-premises fine grained password policy admins</code> group has permissions to manage password policies in your AWS Managed Microsoft AD directory.</p> 
<b>Step 2 – Administer your AWS Managed Microsoft AD as on-premises user</b> 
<p>Any member of the on-premises group(s) that you added to an AWS delegated group inherited the permissions of the AWS delegated group.</p> 
<p>In this example, <code>Richard</code> signs in to the <code>On-premises Management</code> instance. Because <code>Richard</code> inherited permissions from <code>Delegated Fine Grained Password Policy Administrators</code>, he can now administer fine grained password policies in the AWS Managed Microsoft AD directory using on-premises credentials.</p> 
<ol> 
<li>Sign in to the <code>On-premises Management</code> instance as <code>Richard</code>.</li> 
<li>Open the <strong>Microsoft Windows Server Manager</strong> and navigate to <strong>Tools</strong> &gt; <strong>Active Directory Users and Computers</strong>.<br /> <img width="100%" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2018/03/06/Vijay-Sharma-Step-2-10-300x150.png" /></li> 
<li>Switch to the tree view, right-click <strong>Active Directory Users and Computers</strong>, and then select <strong>Change Domain</strong>.<br /> <img width="100%" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2018/03/06/Vijay-Sharma-Step-2-11-300x167.png" /></li> 
<li>In the <strong>Change Domain</strong> window, enter <code>corp.example.com</code>, and then choose <strong>OK</strong>.<br /> <img width="100%" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2018/03/06/Vijay-Sharma-Step-2-12-300x114.png" /></li> 
<li>You’ll be connected to your AWS Managed Microsoft AD domain:<br /> <img width="100%" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2018/03/06/Vijay-Sharma-Step-2-13-277x300.png" /></li> 
</ol> 
<p><code>Richard</code> can now administer the password policies. Because <code>John</code> is also a member of the AWS delegated group, <code>John</code> can also perform password policy administration the same way.</p> 
<p>In future, if <code>Richard</code> moves to another division within the company and you hire <code>Judy</code> as a replacement for <code>Richard</code>, you can simply remove <code>Richard</code> from <code>On-premises fine grained password policy admins</code> group and add <code>Judy</code> to this group. <code>Richard</code> will no longer have administrative permissions, while <code>Judy</code> can now administer password policies for your AWS Managed Microsoft AD directory.</p> 
<b>Summary</b> 
<p>We’ve tried to make it easier for you to administer your AWS Managed Microsoft AD directory by creating AWS delegated groups with domain local scope. You can add your on-premises AD groups to the AWS delegated groups. You can then control who can administer your directory by managing group membership in your on-premises AD directory. Your administrators can sign in to their existing on-premises workstations using their on-premises credentials and administer your AWS Managed Microsoft AD directory. I encourage you to explore the new AWS delegated security groups by using Active Directory Users and Computers from the management instance for your AWS Managed Microsoft AD. To learn more about AWS Directory Service, see the <a title="undefined" href="http://aws.amazon.com/directoryservice/" target="_blank" rel="noopener noreferrer">AWS Directory Service home page</a>. If you have questions, please post them on the <a title="undefined" href="https://forums.aws.amazon.com/forum.jspa?forumID=180" target="_blank" rel="noopener noreferrer">Directory Service forum</a>. If you have comments about this post, submit them in the “Comments” section below.</p> 
<script>
require(['blog'], function() {
AWS.Blog.commenting('#aws-comment-trigger-7395');
});
</script> 
</article> 
<article class="blog-post" vocab="http://schema.org/" typeof="TechArticle"> 
<meta property="inLanguage" content="en-US" /> 
<meta property="image" content="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2018/03/07/cloudforgov-800-by-400.png" /> 
<b class="lb-b blog-post-title" property="name headline">AWS Secret Region expands to include 11 new services</b> 
<p style="margin: 0; padding:0;">=======================<p>
<p>As a follow up to our initial region availability on November 20, 2017, I’m happy to announce that we have expanded the number of accredited services available in the AWS Secret Region by an additional 11 services. We continue to be the only cloud service provider with accredited regions to address the full range of U.S. Department of Defense (DoD) data classifications, including Unclassified, Sensitive (CUI), Secret, and Top Secret.</p> 
<p>When the region launched last November, we achieved a Provisional Authorization (PA) for Impact Level 6 (IL6) workloads from the U.S. Defense Information Systems Agency (DISA), the IT combat support organization of the DoD. The PA was recently extended, allowing for continued access to the region for IL6 workloads.</p> 
<p>The AWS Secret Region was designed and built to meet the specific security requirements of secret classified workloads for the DoD and the intelligence community. A service catalog for the region is available through your AWS Account Executive.</p> 
<p>You can also learn more about the <a href="https://aws.amazon.com/blogs/publicsector/announcing-the-new-aws-secret-region/" title="undefined" target="_blank">AWS Secret Region</a> and the <a href="https://aws.amazon.com/blogs/publicsector/cloud-security-built-for-government-missions/" title="undefined" target="_blank">other FedRAMP and DoD SRG-compliant regions</a> on the AWS Government, Education, &amp; Nonprofit Blog.</p> 
<script>
require(['blog'], function() {
AWS.Blog.commenting('#aws-comment-trigger-7418');
});
</script> 
</article> 
<article class="blog-post" vocab="http://schema.org/" typeof="TechArticle"> 
<meta property="inLanguage" content="en-US" /> 
<meta property="image" content="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2018/03/07/Rajat-featured-image-800-by-400.png" /> 
<b class="lb-b blog-post-title" property="name headline">How to Use Bucket Policies and Apply Defense-in-Depth to Help Secure Your Amazon S3 Data</b> 
<p style="margin: 0; padding:0;">=======================<p>
<p>Amazon S3 provides comprehensive security and compliance capabilities that meet even the most stringent regulatory requirements. It gives you flexibility in the way you manage data for cost optimization, access control, and compliance. However, because the service is flexible, a user could accidentally configure buckets in a manner that is not secure. For example, let’s say you uploaded files to an Amazon S3 bucket with public read permissions, even though you intended only to share this file with a colleague or a partner. Although this might have accomplished your task to share the file internally, the file is now available to anyone on the internet, even without authentication.</p> 
<p>In this blog post, we show you how to prevent your Amazon S3 buckets and objects from allowing public access. We discuss how to secure data in Amazon S3 with a <a title="undefined" href="https://en.wikipedia.org/wiki/Defense_in_depth_(computing)" target="_blank" rel="noopener noreferrer">defense-in-depth</a> approach, where multiple security controls are put in place to help prevent data leakage. This approach helps prevent you from allowing public access to confidential information, such as personally identifiable information (PII) or protected health information (PHI).</p> 
<b>Preventing your Amazon S3 buckets and objects from allowing public access</b> 
<p>Every call to an Amazon S3 service becomes a <a title="undefined" href="https://docs.aws.amazon.com/AmazonS3/latest/API/Welcome.html" target="_blank" rel="noopener noreferrer">REST API request</a>. When your request is transformed via a REST call, the permissions are converted into parameters included in the HTTP header or as URL parameters. The Amazon S3 bucket policy allows or denies access to the Amazon S3 bucket or Amazon S3 objects based on policy statements, and then evaluates conditions based on those parameters. To learn more, see <a title="undefined" href="https://docs.aws.amazon.com/AmazonS3/latest/dev/using-iam-policies.html" target="_blank" rel="noopener noreferrer">Using Bucket Policies and User Policies</a>.</p> 
<p>With this in mind, let’s say multiple <a title="undefined" href="https://aws.amazon.com/iam/" target="_blank" rel="noopener noreferrer">AWS Identity and Access Management</a> (IAM) users at Example Corp. have access to an Amazon S3 bucket and the objects in the bucket. Example Corp. wants to share the objects among its IAM users, while at the same time preventing the objects from being made available publicly.</p> 
<p>To demonstrate how to do this, we start by creating an Amazon S3 bucket named <code>examplebucket</code>. After creating this bucket, we must apply the following bucket policy. This policy denies any uploaded object (<code>PutObject</code>) with the attribute <code>x-amz-acl</code> having the values <code>public-read</code>, <code>public-read-write</code>, or <code>authenticated-read</code>. This means authenticated users cannot upload objects to the bucket if the objects have public permissions.</p> 
<code class="lang-text">{
&quot;Version&quot;: &quot;2012-10-17&quot;,
&quot;Statement&quot;: [
{
&quot;Sid&quot;: &quot;DenyPublicReadACL&quot;,
&quot;Effect&quot;: &quot;Deny&quot;,
&quot;Principal&quot;: {
&quot;AWS&quot;: &quot;*&quot;
},
&quot;Action&quot;: [
&quot;s3:PutObject&quot;,
&quot;s3:PutObjectAcl&quot;
],
&quot;Resource&quot;: &quot;arn:aws:s3:::examplebucket/*&quot;,
&quot;Condition&quot;: {
&quot;StringEquals&quot;: {
&quot;s3:x-amz-acl&quot;: [
&quot;public-read&quot;,
&quot;public-read-write&quot;,
&quot;authenticated-read&quot;
]
}
}
},
{
&quot;Sid&quot;: &quot;DenyPublicReadGrant&quot;,
&quot;Effect&quot;: &quot;Deny&quot;,
&quot;Principal&quot;: {
&quot;AWS&quot;: &quot;*&quot;
},
&quot;Action&quot;: [
&quot;s3:PutObject&quot;,
&quot;s3:PutObjectAcl&quot;
],
&quot;Resource&quot;: &quot;arn:aws:s3:::examplebucket/*&quot;,
&quot;Condition&quot;: {
&quot;StringLike&quot;: {
&quot;s3:x-amz-grant-read&quot;: [
&quot;*http://acs.amazonaws.com/groups/global/AllUsers*&quot;,
&quot;*http://acs.amazonaws.com/groups/global/AuthenticatedUsers*&quot;
]
}
}
},
{
&quot;Sid&quot;: &quot;DenyPublicListACL&quot;,
&quot;Effect&quot;: &quot;Deny&quot;,
&quot;Principal&quot;: {
&quot;AWS&quot;: &quot;*&quot;
},
&quot;Action&quot;: &quot;s3:PutBucketAcl&quot;,
&quot;Resource&quot;: &quot;arn:aws:s3:::examplebucket&quot;,
&quot;Condition&quot;: {
&quot;StringEquals&quot;: {
&quot;s3:x-amz-acl&quot;: [
&quot;public-read&quot;,
&quot;public-read-write&quot;,
&quot;authenticated-read&quot;
]
}
}
},
{
&quot;Sid&quot;: &quot;DenyPublicListGrant&quot;,
&quot;Effect&quot;: &quot;Deny&quot;,
&quot;Principal&quot;: {
&quot;AWS&quot;: &quot;*&quot;
},
&quot;Action&quot;: &quot;s3:PutBucketAcl&quot;,
&quot;Resource&quot;: &quot;arn:aws:s3:::examplebucket&quot;,
&quot;Condition&quot;: {
&quot;StringLike&quot;: {
&quot;s3:x-amz-grant-read&quot;: [
&quot;*http://acs.amazonaws.com/groups/global/AllUsers*&quot;,
&quot;*http://acs.amazonaws.com/groups/global/AuthenticatedUsers*&quot;
]
}
}
}
]
}
</code> 
<p>To better understand what is happening in this bucket policy, we’ll explain each statement. Let’s start with the first statement.</p> 
<code class="lang-text">
{
&quot;Sid&quot;: &quot;DenyPublicReadACL&quot;,
&quot;Effect&quot;: &quot;Deny&quot;,
&quot;Principal&quot;: {
&quot;AWS&quot;: &quot;*&quot;
},
&quot;Action&quot;: [
&quot;s3:PutObject&quot;,
&quot;s3:PutObjectAcl&quot;
],
&quot;Resource&quot;: &quot;arn:aws:s3:::examplebucket/*&quot;,
&quot;Condition&quot;: {
&quot;StringEquals&quot;: {
&quot;s3:x-amz-acl&quot;: [
&quot;public-read&quot;,
&quot;public-read-write&quot;,
&quot;authenticated-read&quot;
]
}
}
}
</code> 
<p>This statement accomplishes the following:</p> 
<blockquote> 
<p>“Deny any Amazon S3 request to <code>PutObject</code> or <code>PutObjectAcl</code> in the bucket <code>examplebucket</code> when the request includes one of the following access control lists (ACLs): <code>public-read</code>, <code>public-read-write</code>, or <code>authenticated-read</code>.”</p> 
</blockquote> 
<p>Remember that <a title="undefined" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_evaluation-logic.html#policy-eval-denyallow" target="_blank" rel="noopener noreferrer">IAM policies are evaluated</a> not in a first-match-and-exit model. Instead, IAM evaluates first if there is an explicit Deny. If there is not, IAM continues to evaluate if you have an explicit Allow and then you have an implicit Deny.</p> 
<p>The above policy creates an explicit Deny. Even when any authenticated user tries to upload (<code>PutObject</code>) an object with public read or write permissions, such as <code>public-read</code> or <code>public-read-write</code> or <code>authenticated-read</code>, the action will be denied. To understand how S3 Access Permissions work, you must understand what <strong>Access Control Lists</strong> (ACL) and <strong>Grants</strong> are. You can find the documentation <a title="undefined" href="https://docs.aws.amazon.com/AmazonS3/latest/dev/acl-overview.html" target="_blank" rel="noopener noreferrer">here</a>.</p> 
<p>Now let’s continue our bucket policy explanation by examining the next statement.</p> 
<code class="lang-text">{
&quot;Sid&quot;: &quot;DenyPublicReadGrant&quot;,
&quot;Effect&quot;: &quot;Deny&quot;,
&quot;Principal&quot;: {
&quot;AWS&quot;: &quot;*&quot;
},
&quot;Action&quot;: [
&quot;s3:PutObject&quot;,
&quot;s3:PutObjectAcl&quot;
],
&quot;Resource&quot;: &quot;arn:aws:s3:::examplebucket/*&quot;,
&quot;Condition&quot;: {
&quot;StringLike&quot;: {
&quot;s3:x-amz-grant-read&quot;: [
&quot;*http://acs.amazonaws.com/groups/global/AllUsers*&quot;,
&quot;*http://acs.amazonaws.com/groups/global/AuthenticatedUsers*&quot;
]
}
}
}
</code> 
<p>This statement is very similar to the first statement, except that instead of checking the ACLs, we are checking specific user groups’ grants that represent the following groups:</p> 
<li><strong>AuthenticatedUsers group</strong>. Represented by <code>http://acs.amazonaws.com/groups/global/AuthenticatedUsers</code>, this group represents all AWS accounts. Access permissions to this group allow any AWS account to access the resource. However, all requests must be signed (authenticated).</li> 
<li><strong>AllUsers group</strong>. Represented by <code>http://acs.amazonaws.com/groups/global/AllUsers</code>, access permissions to this group allow anyone on the internet access to the resource. The requests can be signed (authenticated) or unsigned (anonymous). Unsigned requests omit the <code>Authentication</code> header in the request.</li> 
<p>For more information about which parameters you can use to create bucket policies, see <a title="undefined" href="https://docs.aws.amazon.com/AmazonS3/latest/dev/using-iam-policies.html" target="_blank" rel="noopener noreferrer">Using Bucket Policies and User Policies</a>.</p> 
<p>Now that you know how to deny object uploads with permissions that would make the object public, you just have two statement policies that prevent users from changing the bucket permissions (Denying s3:PutBucketACL from ACL and Denying s3:PutBucketACL from Grants).</p> 
<p>Below is how we’re preventing users from changing the bucket permisssions.</p> 
<code class="lang-text">{
&quot;Sid&quot;: &quot;DenyPublicListACL&quot;,
&quot;Effect&quot;: &quot;Deny&quot;,
&quot;Principal&quot;: {
&quot;AWS&quot;: &quot;*&quot;
},
&quot;Action&quot;: &quot;s3:PutBucketAcl&quot;,
&quot;Resource&quot;: &quot;arn:aws:s3:::examplebucket&quot;,
&quot;Condition&quot;: {
&quot;StringEquals&quot;: {
&quot;s3:x-amz-acl&quot;: [
&quot;public-read&quot;,
&quot;public-read-write&quot;,
&quot;authenticated-read&quot;
]
}
}
},
{
&quot;Sid&quot;: &quot;DenyPublicListGrant&quot;,
&quot;Effect&quot;: &quot;Deny&quot;,
&quot;Principal&quot;: {
&quot;AWS&quot;: &quot;*&quot;
},
&quot;Action&quot;: &quot;s3:PutBucketAcl&quot;,
&quot;Resource&quot;: &quot;arn:aws:s3:::examplebucket&quot;,
&quot;Condition&quot;: {
&quot;StringLike&quot;: {
&quot;s3:x-amz-grant-read&quot;: [
&quot;*http://acs.amazonaws.com/groups/global/AllUsers*&quot;,
&quot;*http://acs.amazonaws.com/groups/global/AuthenticatedUsers*&quot;
]
}
}
}
</code> 
<p>As you can see above, the statement is very similar to the Object statements, except that now we use <code>s3:PutBucketAcl</code> instead of <code>s3:PutObjectAcl</code>, the Resource is just the bucket ARN, and the objects have the “<code>/*</code>” in the end of the ARN.</p> 
<p>In this section, we showed how to prevent IAM users from accidently uploading Amazon S3 objects with public permissions to buckets. In the next section, we show you how to enforce multiple layers of security controls, such as encryption of data at rest and in transit while serving traffic from Amazon S3.</p> 
<b>Securing data on Amazon S3 with defense-in-depth</b> 
<p>Let’s say that Example Corp. wants to serve files securely from Amazon S3 to its users with the following requirements:</p> 
<li>The data must be encrypted at rest and during transit.</li> 
<li>The data must be accessible only by a limited set of public IP addresses.</li> 
<li>All requests for data should be handled only by <a title="undefined" href="https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/Introduction.html" target="_blank" rel="noopener noreferrer">Amazon CloudFront</a> (which is a content delivery network) instead of being directly available from an Amazon S3 URL. If you’re using an Amazon S3 bucket as the origin for a CloudFront distribution, you can grant public permission to read the objects in your bucket. This allows anyone to access your objects either through CloudFront or the Amazon S3 URL. CloudFront doesn’t expose Amazon S3 URLs, but your users still might have access to those URLs if your application serves any objects directly from Amazon S3, or if anyone gives out direct links to specific objects in Amazon S3.</li> 
<li>A domain name is required to consume the content. Custom SSL certificate support lets you deliver content over HTTPS by using your own domain name and your own SSL certificate. This gives visitors to your website the security benefits of CloudFront over an SSL connection that uses your own domain name, in addition to lower latency and higher reliability.</li> 
<p>To represent defense-in-depth visually, the following diagram contains several Amazon S3 objects (A) in a single Amazon S3 bucket (B). You can encrypt these objects on the server side or the client side. You also can configure the bucket policy such that objects are accessible only through CloudFront, which you can accomplish through an <a title="undefined" href="https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/private-content-restricting-access-to-s3.html" target="_blank" rel="noopener noreferrer">origin access identity</a> (C). You then can configure CloudFront to deliver content only over HTTPS in addition to using your own domain name (D).</p> 
<p><img width="100%" src="https://d1.awsstatic.com/security-center/SecurityBlog/bucket_policies_defense_s3.43e6c93a095f2f55b33b30276f4782ab9ec79f47.png" /></p> 
<b>Defense-in-depth requirement 1: Data must be encrypted at rest and during transit</b> 
<p>Let’s start with the objects themselves. Amazon S3 objects—files in this case—can range from zero bytes to multiple terabytes in size (see <a title="undefined" href="http://docs.aws.amazon.com/AmazonS3/latest/dev/UploadingObjects.html" target="_blank" rel="noopener noreferrer">service limits</a> for the latest information). Each Amazon S3 bucket includes a collection of objects, and the objects can be uploaded via the Amazon S3 console, <a title="undefined" href="https://aws.amazon.com/cli/" target="_blank" rel="noopener noreferrer">AWS CLI</a>, or <a title="undefined" href="https://docs.aws.amazon.com/AmazonS3/latest/API/Welcome.html" target="_blank" rel="noopener noreferrer">AWS API</a>.</p> 
<p>You can encrypt Amazon S3 objects at rest and during transit. At rest, objects in a bucket are encrypted with <a title="undefined" href="https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingServerSideEncryption.html" target="_blank" rel="noopener noreferrer">server-side encryption</a> by using <a title="undefined" href="https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingServerSideEncryption.html" target="_blank" rel="noopener noreferrer">Amazon S3 managed keys</a> or AWS Key Management Service (AWS KMS) <a title="undefined" href="https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingKMSEncryption.html" target="_blank" rel="noopener noreferrer">managed keys</a> or <a title="undefined" href="https://docs.aws.amazon.com/AmazonS3/latest/dev/ServerSideEncryptionCustomerKeys.html" target="_blank" rel="noopener noreferrer">customer-provided</a> keys through AWS KMS. You also can encrypt objects on the <a title="undefined" href="https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingClientSideEncryption.html" target="_blank" rel="noopener noreferrer">client side</a> by using AWS KMS managed keys or a customer-supplied <a title="undefined" href="https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingClientSideEncryptionUpload.html" target="_blank" rel="noopener noreferrer">client-side master key</a>.</p> 
<p>If you choose to use server-side encryption, Amazon S3 encrypts your objects before saving them on disks in AWS data centers. To encrypt an object at the time of upload, you need to add the <code>x-amz-server-side-encryption</code> header to the request to tell Amazon S3 to encrypt the object using Amazon S3 managed keys (SSE-S3), AWS KMS managed keys (SSE-KMS), or customer-provided keys (SSE-C). There are two possible values for the <code>x-amz-server-side-encryption</code> header: <code>AES256</code>, which tells Amazon S3 to use Amazon S3 managed keys, and <code>aws:kms</code>, which tells Amazon S3 to use AWS KMS managed keys.</p> 
<p>The following code example shows a <code>Put</code> request using SSE-S3.</p> 
<code class="lang-text">PUT /example-object HTTP/1.1
Host: myBucket.s3.amazonaws.com
Date: Wed, 8 Jun 2016 17:50:00 GMT
Authorization: authorization string
Content-Type: text/plain
Content-Length: 11434
x-amz-meta-author: Janet
Expect: 100-continue
x-amz-server-side-encryption: AES256
[11434 bytes of object data]
</code> 
<p>If you choose to use client-side encryption, you can encrypt data on the client side and upload the encrypted data to Amazon S3. In this case, you manage the encryption process, the encryption keys, and related tools. You encrypt data on the client side by using AWS KMS managed keys or a customer-supplied, client-side master key.</p> 
<b>Defense-in-depth requirement 2: Data must be accessible only by a limited set of public IP addresses</b> 
<p>At the Amazon S3 bucket level, you can configure permissions through a bucket policy. For example, you can limit access to the objects in a bucket by IP address range or specific IP addresses. Alternatively, you can make the objects accessible only through HTTPS.</p> 
<p>The following bucket policy allows access to Amazon S3 objects only through HTTPS (the policy was generated with the <a title="undefined" href="http://awspolicygen.s3.amazonaws.com/policygen.html" target="_blank" rel="noopener noreferrer">AWS Policy Generator</a>). Here the bucket policy explicitly denies (<code>&quot;Effect&quot;: &quot;Deny&quot;</code>) all read access (<code>&quot;Action&quot;: &quot;s3:GetObject&quot;</code>) from anybody who browses (<code>&quot;Principal&quot;: &quot;*&quot;</code>) to Amazon S3 objects within an Amazon S3 bucket if they are not accessed through HTTPS (<code>&quot;aws:SecureTransport&quot;: &quot;false&quot;</code>).</p> 
<code class="lang-text">{
&quot;Version&quot;: &quot;2012-10-17&quot;,
&quot;Id&quot;: &quot;Policy1504640911349&quot;,
&quot;Statement&quot;: [
{
&quot;Sid&quot;: &quot;Stmt1504640908907&quot;,
&quot;Effect&quot;: &quot;Deny&quot;,
&quot;Principal&quot;: &quot;*&quot;,
&quot;Action&quot;: &quot;s3:GetObject&quot;,
&quot;Resource&quot;: &quot;arn:aws:s3:::/*&quot;,
&quot;Condition&quot;: {
&quot;Bool&quot;: {
&quot;aws:SecureTransport&quot;: &quot;false&quot;
}
}
}
]
}
</code> 
<b>Defense-in-depth requirement 3: Data must not be publicly accessible directly from an Amazon S3 URL</b> 
<p>Next, configure <a title="undefined" href="https://aws.amazon.com/cloudfront/" target="_blank" rel="noopener noreferrer">Amazon CloudFront</a> to serve traffic from within the bucket. The use of CloudFront serves several purposes:</p> 
<li>CloudFront is a content delivery network that acts as a cache to serve static files quickly to clients.</li> 
<li>Depending on the number of requests, the cost of delivery is less than if objects were served directly via Amazon S3.</li> 
<li>Objects served through CloudFront can be limited to specific countries.</li> 
<p>Access to these Amazon S3 objects is available only through CloudFront. We do this by creating an <a title="undefined" href="https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/private-content-restricting-access-to-s3.html" target="_blank" rel="noopener noreferrer">origin access identity</a> (OAI) for CloudFront and granting access to objects in the respective Amazon S3 bucket only to that OAI. As a result, access to Amazon S3 objects from the internet is possible only through CloudFront; all other means of accessing the objects—such as through an Amazon S3 URL—are denied. CloudFront acts not only as a content distribution network, but also as a host that denies access based on geographic restrictions. You apply these restrictions by updating your CloudFront web distribution and adding a whitelist that contains only a specific country’s name (let’s say Liechtenstein). Alternatively, you could add a blacklist that contains every country except that country. Learn more about how to use CloudFront geographic restriction to whitelist or blacklist a country to restrict or allow users in specific locations from accessing web content in the <a title="undefined" href="https://aws.amazon.com/premiumsupport/knowledge-center/cloudfront-geo-restriction/" target="_blank" rel="noopener noreferrer">AWS Support Knowledge Center</a>.</p> 
<b>Defense-in-depth requirement 4: A domain name is required to consume the content</b> 
<p>To serve content from CloudFront, you must use a domain name in the URLs for objects on your webpages or in your web application. The domain name can be either of the following:</p> 
<li>The domain name that CloudFront automatically assigns when you create a distribution, such as <code>d111111abcdef8.cloudfront.net</code></li> 
<li>Your own domain name, such as <code>example.com</code></li> 
<p>For example, you might use one of the following URLs to return the file image.jpg:</p> 
<li>http://d111111abcdef8.cloudfront.net/images/image.jpg</li> 
<li>http://example.com/images/image.jpg</li> 
<p>You use the same URL format whether you store the content in Amazon S3 buckets or at a custom origin, like one of your own web servers.</p> 
<p>Instead of using the default domain name that CloudFront assigns for you when you create a distribution, you can <a title="undefined" href="http://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/distribution-web-values-specify.html#DownloadDistValuesCNAME" target="_blank" rel="noopener noreferrer">add an alternate domain name</a> that’s easier to work with, like <code>example.com</code>. By setting up your own domain name with CloudFront, you can use a URL like this for objects in your distribution: <code>http://example.com/images/image.jpg</code>.</p> 
<p>Let’s say that you already have a domain name hosted on <a title="undefined" href="https://aws.amazon.com/route53/" target="_blank" rel="noopener noreferrer">Amazon Route 53</a>. You would like to serve traffic from the domain name, request an SSL certificate, and add this to your CloudFront web distribution. The <a title="undefined" href="https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/using-https-viewers-to-cloudfront.html" target="_blank" rel="noopener noreferrer">SSL offloading</a> occurs in CloudFront by serving traffic securely from each CloudFront location. You also can <a title="undefined" href="http://docs.aws.amazon.com/AmazonS3/latest/dev/website-hosting-cloudfront-walkthrough.html" target="_blank" rel="noopener noreferrer">configure CloudFront</a> to deliver your content over <a title="undefined" href="http://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/using-https-viewers-to-cloudfront.html" target="_blank" rel="noopener noreferrer">HTTPS</a> by using your custom domain name and your own <a title="undefined" href="https://aws.amazon.com/blogs/aws/new-aws-certificate-manager-deploy-ssltls-based-apps-on-aws/" target="_blank" rel="noopener noreferrer">SSL certificate</a>. Serving web content through CloudFront reduces response from the origin as requests are redirected to the nearest edge location. This results in faster download times than if the visitor had requested the content from a data center that is located farther away.</p> 
<b>Summary</b> 
<p>In this post, we demonstrated how you can apply policies to Amazon S3 buckets so that only users with appropriate permissions are allowed to access the buckets. Anonymous users (with public-read/public-read-write permissions) and authenticated users without the appropriate permissions are prevented from accessing the buckets.</p> 
<p>We also examined how to secure access to objects in Amazon S3 buckets. The objects in Amazon S3 buckets can be encrypted at rest and during transit. Doing so helps provide end-to-end security from the source (in this case, Amazon S3) to your users.</p> 
<p>If you have feedback about this blog post, submit comments in the “Comments” section below. If you have questions about this blog post, start a new thread on the <a title="undefined" href="https://forums.aws.amazon.com/forum.jspa?forumID=24" target="_blank" rel="noopener noreferrer">Amazon S3 forum</a> or contact <a title="undefined" href="https://console.aws.amazon.com/support/home" target="_blank" rel="noopener noreferrer">AWS Support</a>.</p> 
<script>
require(['blog'], function() {
AWS.Blog.commenting('#aws-comment-trigger-7392');
});
</script> 
</article> 
<article class="blog-post" vocab="http://schema.org/" typeof="TechArticle"> 
<meta property="inLanguage" content="en-US" /> 
<meta property="image" content="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2018/02/23/federated_auth_with_adfs_1-1.png" /> 
<b class="lb-b blog-post-title" property="name headline">AWS Federated Authentication with Active Directory Federation Services (AD FS)</b> 
<p style="margin: 0; padding:0;">=======================<p>
<p>Today we’d like to walk you through AWS Identity and Access Management (IAM), federated sign-in through Active Directory (AD) and Active Directory Federation Services (ADFS). With IAM, you can centrally manage users, security credentials such as access keys, and permissions that control which resources users can access. Customers have the option of creating users and group objects within IAM or they can utilize a third-party federation service to assign external directory users access to AWS resources. To streamline the administration of user access in AWS, organizations can utilize a federated solution with an external directory, allowing them to minimize administrative overhead. Benefits of this approach include leveraging existing passwords and password policies, roles and groups. This guide provides a walk-through on how to automate the federation setup across multiple accounts/roles with an Active Directory backing identity store. This will establish the minimum baseline for the authentication architecture, including the initial IdP deployment and elements for federation.</p> 
<p><span style="text-decoration: underline"><strong>ADFS Federated Authentication Process</strong></span></p> 
<p>The following describes the process a user will follow to authenticate to AWS using Active Directory and ADFS as the identity provider and identity brokers:</p> 
<p><img width="100%" src="https://d1.awsstatic.com/security-center/SecurityBlog/federated_auth_with_adfs_25.dc86ecbfbbf80af3f553e7374d2a55ad1afb7016.png" /></p> 
<ol> 
<li>Corporate user accesses the corporate Active Directory Federation Services portal sign-in page and provides Active Directory authentication credentials.</li> 
<li>AD FS authenticates the user against Active Directory.</li> 
<li>Active Directory returns the user’s information, including AD group membership information.</li> 
<li>AD FS dynamically builds ARNs by using Active Directory group memberships for the IAM roles and user attributes for the AWS account IDs, and sends a signed assertion to the users browser with a redirect to post the assertion to AWS STS.</li> 
<li>Temporary credentials are returned using STS AssumeRoleWithSAML.</li> 
<li>The user is authenticated and provided access to the AWS management console.</li> 
</ol> 
<p><span style="text-decoration: underline"><strong>Configuration Steps</strong></span></p> 
<p>Configuration requires setup in the Identity Provider store (e.g. Active Directory), the identity broker (e.g. Active Directory Federation Services), and AWS. It is possible to configure AWS to federate authentication using a variety of third-party SAML 2.0 compliant identity providers, more information can be <a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_providers_saml_3rd-party.html">found here</a>.</p> 
<p><span style="text-decoration: underline"><strong>AWS Configuration</strong></span></p> 
<p>The configuration steps outlined in this document can be completed to enable federated access to multiple AWS accounts, facilitating a single sign on process across a multi-account AWS environment. Access can also be provided to multiple roles in each AWS account. The roles available to a user are based on their group memberships in the identity provider (IdP). In a multi-role and/or multi-account scenario, role assumption requires the user to select the account and role they wish to assume during the authentication process.</p> 
<p><span style="text-decoration: underline"><strong>Identity Provider</strong></span></p> 
<p>A SAML 2.0 identity provider is an IAM resource that describes an identity provider (IdP) service that supports the <a href="https://wiki.oasis-open.org/security">SAML 2.0 (Security Assertion Markup Language 2.0)</a> standard. AWS SAML identity provider configurations can be used to establish trust between AWS and SAML-compatible identity providers, such as Shibboleth or Microsoft Active Directory Federation Services. These enable users in an organization to access AWS resources using existing credentials from the identity provider.</p> 
<p>A SAML identify provider can be configured using the AWS console by completing the following steps.</p> 
<p>1. Access the “Identity Providers” section of the AWS IAM console at the following URL: <a href="https://console.aws.amazon.com/iam/home?region=us-east-1#/providers">https://console.aws.amazon.com/iam/home?region=us-east-1#/providers</a>. Click on the “Create Provider” button.</p> 
<p><img width="100%" src="https://d1.awsstatic.com/security-center/SecurityBlog/federated_auth_with_adfs_2.3a1032e31a5de83c858ee1810b1a6842830538b3.png" /></p> 
<p>2. Select SAML for the provider type. Select a provider name of your choosing (this will become the logical name used in the identity provider ARN). Lastly, download the FederationMetadata.xml file from your ADFS server to your client system file (https://yourADFSserverFQDN/FederationMetadata/2007-06/FederationMetadata.xml). Click “Choose File” and upload it to AWS.</p> 
<p><img width="100%" src="https://d1.awsstatic.com/security-center/SecurityBlog/federated_auth_with_adfs_3.8b3a464702bc5a12d2ca84342040b86575eabb06.png" /></p> 
<p>3. Click “Next Step” and then verify the information you have entered. Click “Create” to complete the AWS identity provider configuration process.</p> 
<p><strong>IAM Role Naming Convention for User Access</strong><br /> Once the AWS identity provider configuration is complete, it is necessary to create the roles in AWS that federated users can assume via SAML 2.0. An IAM role is an AWS identity with permission policies that determine what the identity can and cannot do in AWS. In a federated authentication scenario, users (as defined in the IdP) assume an AWS role during the sign-in process. A role should be defined for each access delineation that you wish to define. For example, create a role for each line of business (LOB), or each function within a LOB. Each role will then be assigned a set of policies that define what privileges the users who will be assuming that role will have.</p> 
<p>The following steps detail how to create a single role. These steps should be completed multiple times to enable assumption of different roles within AWS, as required.</p> 
<p>1. Access the “Roles” section of the AWS IAM console at the following URL: <a href="https://console.aws.amazon.com/iam/home?region=us-east-1#/roles">https://console.aws.amazon.com/iam/home?region=us-east-1#/roles</a>. Click on the “Create Role” button.</p> 
<p><img width="100%" src="https://d1.awsstatic.com/security-center/SecurityBlog/federated_auth_with_adfs_4.b66327250fe514d1522d9dafba2ec8a77de0725f.png" /></p> 
<p>2. Select “SAML” as the trusted entity type. Click Next Step.</p> 
<p><img width="100%" src="https://d1.awsstatic.com/security-center/SecurityBlog/federated_auth_with_adfs_5.69a994ecc1645a52e53648efaae211cdfcfaa55a.png" /></p> 
<p>3. Select your previously created identity provider. Click Next: Permissions.</p> 
<p><img width="100%" src="https://d1.awsstatic.com/security-center/SecurityBlog/federated_auth_with_adfs_6.d5efa7a6b3f8b6e01f1dd9b80c2d2d42d021a2e2.png" /></p> 
<p>4. The next step requires selection of policies that represent the desired permissions the user should obtain in AWS, once they have authenticated and successfully assumed the role. This can be either a custom policy or preferably an AWS managed policy. AWS recommends leveraging existing <a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_job-functions.html">AWS access policies for job functions</a> for common levels of access. For example, the “Billing” AWS Managed policy should be utilized to provide financial analyst access to AWS billing and cost information.</p> 
<p><img width="100%" src="https://d1.awsstatic.com/security-center/SecurityBlog/federated_auth_with_adfs_7.ef4226b439e98c4ecbe39c96479c7cb1388a4362.png" /></p> 
<p>5.&nbsp;Provide a name for your role. All roles should be created with the prefix ADFS-&lt;rolename&gt; to simplify the identification of roles in AWS that are accessed through the federated authentication process. Next click, “Create Role”.</p> 
<p><img width="100%" src="https://d1.awsstatic.com/security-center/SecurityBlog/federated_auth_with_adfs_8.75deb2c2ef9ab7528e95185865044e1dc09bbb11.png" /></p> 
<p><span style="text-decoration: underline"><strong>Active Directory Configuration</strong></span></p> 
<p>Determining how you will create and delineate your AD groups and IAM roles in AWS is crucial to how you secure access to your account and manage resources. SAML assertions to the AWS environment and the respective IAM role access will be managed through regular expression (regex) matching between your on-premises AD group name to an AWS IAM role.</p> 
<p>One approach for creating the AD groups that uniquely identify the AWS IAM role mapping is by selecting a common group naming convention. For example, your AD groups would start with an identifier, for example AWS-, as this will distinguish your AWS groups from others within the organization. Next, include the 12-digit AWS account number. Finally, add the matching role name within the AWS account. Here is an example:</p> 
<p><img width="100%" src="https://d1.awsstatic.com/security-center/SecurityBlog/federated_auth_with_adfs_9.8631e991b7762154a86c95050781fa2e40d169c4.png" /></p> 
<p>You should do this for each role and corresponding AWS account you wish to support with federated access. Users in Active Directory can subsequently be added to the groups, providing the ability to assume access to the corresponding roles in AWS. If a user is associated with multiple Active Directory groups and AWS accounts, they will see a list of roles by AWS account and will have the option to choose which role to assume. A user will not be able to assume more than one role at a time, but has the ability to switch between them as needed.</p> 
<p>Note: Microsoft imposes a limit on the number of groups a user can be a member of (approximately 1,015 groups) due to the size limit for the access token that is created for each security principal. This limitation, however, is not affected by how the groups may or may not be nested.</p> 
<p><span style="text-decoration: underline"><strong>Active Directory Federation Services Configuration</strong></span></p> 
<p>ADFS federation occurs with the participation of two parties; the identity or claims provider (in this case the owner of the identity repository – Active Directory) and the relying party, which is another application that wishes to outsource authentication to the identity provider; in this case Amazon Secure Token Service (STS). The relying party is a federation partner that is represented by a claims provider trust in the federation service.</p> 
<p><span style="text-decoration: underline"><strong>Relying Party</strong></span></p> 
<p>You can configure a new relying party in Active Directory Federation Services by doing the following.</p> 
<p>1. From the ADFS Management Console, right-click ADFS and select Add Relying Party Trust.</p> 
<p><img width="100%" src="https://d1.awsstatic.com/security-center/SecurityBlog/federated_auth_with_adfs_10.9fd79859843b0f010de321d51f35f5a94dc5c2e0.png" /></p> 
<p>2. In the Add Relying Party Trust Wizard, click Start.</p> 
<p><img width="100%" src="https://d1.awsstatic.com/security-center/SecurityBlog/federated_auth_with_adfs_11.09329982f8db9c655a025040b6e1586d09b309a9.png" /></p> 
<p>3. Check Import data about the relying party published online or on a local network, enter<br /> https://signin.aws.amazon.com/static/saml-metadata.xml, and then click Next. The metadata XML file is a standard SAML metadata document that describes AWS as a relying party.</p> 
<p><img width="100%" src="https://d1.awsstatic.com/security-center/SecurityBlog/federated_auth_with_adfs_12.4932a319727e7185476763684ab525cb38373e2f.png" /></p> 
<p>Note: SAML federations use metadata documents to maintain information about the public keys and certificates that each party utilizes. At run time, each member of the federation can then use this information to validate that the cryptographic elements of the distributed transactions come from the expected actors and haven’t been tampered with. Since these metadata documents do not contain any sensitive cryptographic material, AWS publishes federation metadata at <a href="https://signin.aws.amazon.com/static/saml-metadata.xml">https://signin.aws.amazon.com/static/saml-metadata.xml</a></p> 
<p>4. Set the display name for the relying party and then click Next.</p> 
<p><img width="100%" src="https://d1.awsstatic.com/security-center/SecurityBlog/federated_auth_with_adfs_13.185958f6c7870d9b6144b06a274d6049a64b062d.png" /></p> 
<p>5. We will not choose to enable/configure the MFA settings at this time.</p> 
<p><img width="100%" src="https://d1.awsstatic.com/security-center/SecurityBlog/federated_auth_with_adfs_14.f8d6fdb15f19bcd1f1b4557e429b31802d03c091.png" /></p> 
<p>6. Select “Permit all users to access this relying party” and click Next.</p> 
<p><img width="100%" src="https://d1.awsstatic.com/security-center/SecurityBlog/federated_auth_with_adfs_15.0e4626b25a2a85532da8c1497b7d02ce9baa01dc.png" /></p> 
<p>7. Review your settings and then click Next.</p> 
<p><img width="100%" src="https://d1.awsstatic.com/security-center/SecurityBlog/federated_auth_with_adfs_16.e5bbe2e02c7b0bcc73cdd4fee9e5d3840e30eff2.png" /></p> 
<p>8. Choose Close on the Finish page to complete the Add Relying Party Trust Wizard. AWS is now configured as a relying party.</p> 
<p><img width="100%" src="https://d1.awsstatic.com/security-center/SecurityBlog/federated_auth_with_adfs_26.png.01e599495877e5ad0aa2eba234bee6f83c90a32e.jpg" /></p> 
<p><span style="text-decoration: underline"><strong>Custom Claim Rules</strong></span></p> 
<p>Microsoft Active Directory Federation Services (AD FS) uses Claims Rule Language to issue and transform claims between claims providers and relying parties. A claim is information about a user from a trusted source. The trusted source is asserting that the information is true, and that source has authenticated the user in some manner. The claims provider is the source of the claim. This can be information pulled from an attribute store such as Active Directory (AD). The relying party is the destination for the claims, in this case AWS.</p> 
<p>AD FS provides administrators with the option to define custom rules that they can use to determine the behavior of identity claims with the claim rule language. The Active Directory Federation Services (AD FS) claim rule language acts as the administrative building block to help manage the behavior of incoming and outgoing claims. There are four claim rules that need to be created to effectively enable Active Directory users to assume roles in AWS based on group membership in Active Directory.</p> 
<p>Right-click on the relying party (in this case Amazon Web Services) and then click Edit Claim Rules</p> 
<p><img width="100%" src="https://d1.awsstatic.com/security-center/SecurityBlog/federated_auth_with_adfs_19.594240ea64134bc2c79239d9aba7f7de572df07b.png" /></p> 
<p>Here are the steps used to create the claim rules for NameId, RoleSessionName, Get AD Groups and Roles.</p> 
<p>1. NameId</p> 
<p style="margin-left: 5%;margin-right: 5%">a) In the Edit Claim Rules for &lt;relying party&gt; dialog box, click Add Rule.<br /> b) Select Transform an Incoming Claim and then click Next.<br /> c) Use the following settings:</p> 
<p style="margin-left: 10%;margin-right: 10%">i) Claim rule name: NameId<br /> ii) Incoming claim type: Windows Account Name<br /> iii) Outgoing claim type: Name ID<br /> iv) Outgoing name ID format: Persistent Identifier<br /> v) Pass through all claim values: checked</p> 
<p style="margin-left: 5%;margin-right: 5%">d) Click OK.</p> 
<p><img width="100%" src="https://d1.awsstatic.com/security-center/SecurityBlog/federated_auth_with_adfs_20.982922cd43adf189967386acfb3feb380d6a4de2.png" /></p> 
<p>Rule language:<br /> <code>c:[Type == &quot;http://schemas.microsoft.com/ws/2008/06/identity/claims/windowsaccountname&quot;]<br /> =&gt; issue(Type = &quot;http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier&quot;, Issuer = c.Issuer, OriginalIssuer = c.OriginalIssuer, Value = c.Value, ValueType = c.ValueType, Properties[&quot;http://schemas.xmlsoap.org/ws/2005/05/identity/claimproperties/format&quot;] = &quot;urn:oasis:names:tc:SAML:2.0:nameid-format:persistent&quot;);</code></p> 
<p>2. RoleSessionName</p> 
<p style="margin-left: 5%;margin-right: 5%">a) Click Add Rule<br /> b) In the Claim rule template list, select Send LDAP Attributes as Claims.<br /> c) Use the following settings:</p> 
<p style="margin-left: 10%;margin-right: 10%">i) Claim rule name: RoleSessionName<br /> ii) Attribute store: Active Directory<br /> iii) LDAP Attribute: E-Mail-Addresses<br /> iv) Outgoing Claim Type: https://aws.amazon.com/SAML/Attributes/RoleSessionName</p> 
<p style="margin-left: 5%;margin-right: 5%">d) Click OK</p> 
<p><img width="100%" src="https://d1.awsstatic.com/security-center/SecurityBlog/federated_auth_with_adfs_21.f184e9d25b5213e26499c647704cb60022d05003.png" /></p> 
<p>Rule language:<br /> <code>c:[Type == &quot;http://schemas.microsoft.com/ws/2008/06/identity/claims/windowsaccountname&quot;, Issuer == &quot;AD AUTHORITY&quot;]<br /> =&gt; issue(store = &quot;Active Directory&quot;, types = (&quot;https://aws.amazon.com/SAML/Attributes/RoleSessionName&quot;), query = &quot;;mail;{0}&quot;, param = c.Value);</code></p> 
<p>3. Get AD Groups</p> 
<p style="margin-left: 5%;margin-right: 5%">a) Click Add Rule.<br /> b) In the Claim rule template list, select Send Claims Using a Custom Rule and then click Next.<br /> c) For Claim Rule Name, select Get AD Groups, and then in Custom rule, enter the following:</p> 
<p><img width="100%" src="https://d1.awsstatic.com/security-center/SecurityBlog/federated_auth_with_adfs_22.6274a5dddac2a7f58315f2c0cc3fc4f0a69b9505.png" /></p> 
<p>Rule language:<br /> <code>c:[Type == &quot;http://schemas.microsoft.com/ws/2008/06/identity/claims/windowsaccountname&quot;, Issuer == &quot;AD AUTHORITY&quot;]<br /> =&gt; add(store = &quot;Active Directory&quot;, types = (&quot;http://temp/variable&quot;), query = &quot;;tokenGroups;{0}&quot;, param = c.Value);</code></p> 
<p>This custom rule uses a script in the claim rule language that retrieves all the groups the authenticated user is a member of and places them into a temporary claim named http://temp/variable. Think of this as a variable you can access later.</p> 
<p>Note: Ensure there’s no trailing whitespace to avoid unexpected results.</p> 
<p>4. Role Attributes</p> 
<p style="margin-left: 5%;margin-right: 5%">a) Unlike the two previous claims, here we used custom rules to send role attributes. This is done by retrieving all the authenticated user’s AD groups and then matching the groups that start with to IAM roles of a similar name. I used the names of these groups to create Amazon Resource Names (ARNs) of IAM roles in my AWS account (i.e., those that start with AWS-). Sending role attributes requires two custom rules. The first rule retrieves all the authenticated user’s AD group memberships and the second rule performs the transformation to the roles claim.</p> 
<p style="margin-left: 10%;margin-right: 10%">i) Click Add Rule.<br /> ii) In the Claim rule template list, select Send Claims Using a Custom Rule and then click Next.<br /> iii) For Claim Rule Name, enter Roles, and then in Custom rule, enter the following:</p> 
<p><img width="100%" src="https://d1.awsstatic.com/security-center/SecurityBlog/federated_auth_with_adfs_23.99bb0356c4f02c4cdb9f91888490bf6210bca0cc.png" /></p> 
<p>Rule language:<br /> <code>c:[Type == &quot;http://temp/variable&quot;, Value =~ &quot;(?i)^AWS-([\d]{12})&quot;] =&gt; issue(Type = &quot;https://aws.amazon.com/SAML/Attributes/Role&quot;, Value = RegExReplace(c.Value, &quot;AWS-([\d]{12})-&quot;, &quot;arn:aws:iam::$1:saml-provider/idp1,arn:aws:iam::$1:role/&quot;));</code></p> 
<p>This custom rule uses regular expressions to transform each of the group memberships of the form AWS-&lt;Account Number&gt;-&lt;Role Name&gt; into in the IAM role ARN, IAM federation provider ARN form AWS expects.</p> 
<p>Note: In the example rule language above idp1 represents the logical name given to the SAML identity provider in the AWS identity provider setup. Please change this based on the logical name you chose in the IAM console for your identity provider.</p> 
<p><span style="text-decoration: underline"><strong>Adjusting Session Duration</strong></span></p> 
<p>By default, the temporary credentials that are issued by AWS IAM for SAML federation are valid for an hour. Depending on your organizations security stance, you may wish to adjust. You can allow your federated users to work in the AWS Management Console for up to 12 hours. This can be accomplished by adding another claim rule in your ADFS configuration. To add the rule, do the following:</p> 
<p style="margin-left: 5%;margin-right: 5%">1. Access ADFS Management Tool on your ADFS Server.<br /> 2. Choose Relying Party Trusts, then select your AWS Relying Party configuration.<br /> 3. Choose Edit Claim Rules.<br /> 4. Choose Add Rule to configure a new rule, and then choose Send claims using a custom rule. Finally, choose Next.<br /> 5. Name your Rule “Session Duration” and add the following rule syntax.<br /> 6. Adjust the value of 28800 seconds (8 hours) as appropriate.</p> 
<p><img width="100%" src="https://d1.awsstatic.com/security-center/SecurityBlog/federated_auth_with_adfs_24.edae1e081bc5baeb1979fc2b398f29a81e35607c.png" /></p> 
<p>Rule language:<br /> <code>=&gt; issue(Type = &quot;https://aws.amazon.com/SAML/Attributes/SessionDuration&quot;, Value = &quot;28800&quot;);</code></p> 
<p>Note: AD FS 2012 R2 and AD FS 2016 tokens have a sixty-minute validity period by default. This value is configurable on a per-relying party trust basis. In addition to adding the “Session Duration” claim rule, you will also need to update the security token created by AD FS. To update this value, run the following command:</p> 
<p><code>Set-ADFSRelyingPartyTrust -TargetName “[Display Name]” -TokenLifetime 480</code></p> 
<p>The Parameter “-TokenLifetime” determines the Lifetime in Minutes. In this example, we set the Lifetime to 480 minutes, eight hours.</p> 
<p>These are the main settings related to session lifetimes and user authentication. Once updated, any new console session your federated users initiate will be valid for the duration specified in the SessionDuration claim.</p> 
<p><span style="text-decoration: underline"><strong>API/CLI Access</strong></span><br /> Access to the AWS API and command-line tools using federated access can be accomplished using techniques in the following blog article:</p> 
<p><a href="https://blogs.aws.amazon.com/security/post/Tx1LDN0UBGJJ26Q/How-to-Implement-Federated-API-and-CLI-Access-Using-SAML-2-0-and-AD-FS">https://blogs.aws.amazon.com/security/post/Tx1LDN0UBGJJ26Q/How-to-Implement-Federated-API-and-CLI-Access-Using-SAML-2-0-and-AD-FS</a></p> 
<p>This will enable your users to access your AWS environment using their domain credentials through the AWS CLI or one of the AWS SDKs.</p> 
<p><span style="text-decoration: underline"><strong>Conclusion</strong></span><br /> In this post, I’ve shown you how to provide identity federation, and thus SSO, to the AWS Management Console for multiple accounts using SAML assertions. With this approach, the AWS Security Token service (STS) will provide temporary credentials (via SAML) for the user to ‘assume’ a role (that they have access to use, as denoted by AD Group membership) that has specific permissions associated; as opposed to providing long-term access credentials to the AWS resources. By adopting this model, you will have a secure and robust IAM approach for accessing AWS resources that align with AWS security best practices.</p> 
<script>
require(['blog'], function() {
AWS.Blog.commenting('#aws-comment-trigger-7338');
});
</script> 
</article> 
<article class="blog-post" vocab="http://schema.org/" typeof="TechArticle"> 
<meta property="inLanguage" content="en-US" /> 
<meta property="image" content="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2018/02/22/sso_user_portal_3-1136x630.png" /> 
<b class="lb-b blog-post-title" property="name headline">AWS Single Sign-On Now Enables Command Line Interface Access for AWS Accounts Using Corporate Credentials</b> 
<p style="margin: 0; padding:0;">=======================<p>
<p>Today, AWS made it easier to use the <a href="https://aws.amazon.com/cli/">AWS Command Line Interface</a> (CLI) to manage services in your AWS accounts. Now you can sign into the <a href="https://aws.amazon.com/single-sign-on/">AWS Single Sign-On</a> (AWS SSO) user portal using your existing corporate credentials, choose an AWS account and a specific permission set, and get temporary credentials to manage your AWS services through the AWS CLI.</p> 
<p><a href="https://aws.amazon.com/blogs/security/introducing-aws-single-sign-on/">AWS SSO</a> is a service that enables you to centrally manage single sign-on access to multiple AWS accounts and business applications. <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp.html">AWS temporary security credentials</a> are an easy way to get short-term credentials to manage your AWS services through the AWS CLI or a <a href="https://aws.amazon.com/tools/">programmatic client</a>.</p> 
<p>Previously, when you issued commands from the CLI to access resources in each of several AWS accounts, you had to remember the password for each account, sign in to each AWS account individually, and fetch the credentials for each account one at a time. Now, AWS SSO eliminates the need to sign in to each AWS account individually to get temporary credentials. Instead, you can sign in to the AWS SSO user portal once using your existing corporate credentials and then fetch temporary credentials for any of your authorized AWS accounts to use with the AWS CLI to access the resources in that account, limited by the permissions granted to you.</p> 
<p>In this blog post, I’ll show how to fetch temporary credentials from the AWS SSO user portal to use with the AWS CLI to access resources in your AWS accounts. First, I’ll show you how to obtain short-term credentials for any account for a permission set for which you are authorized. Next, I’ll show you three ways to use these credentials.</p> 
<p>For this scenario, let’s say I am an administrator at “AnyCompany” and I want to list instances in two AWS accounts by using the AWS CLI command, <code>aws ec2 describe-instances</code>. “AnyCompany” has enabled access to AWS accounts through AWS SSO.</p> 
<p><strong>Prerequisites</strong></p> 
<p>You need to install the <a href="https://aws.amazon.com/cli/">AWS CLI</a> to use this feature. You also need to configure AWS SSO, connect a corporate directory, and grant access to users or groups to access AWS accounts with permission sets. To learn more, see, “<a href="https://aws.amazon.com/blogs/security/introducing-aws-single-sign-on/">Introducing AWS Single Sign-On</a>“.</p> 
<p><span style="text-decoration: underline"><strong>How to access resources in your AWS accounts by using AWS SSO and the AWS CLI</strong></span></p> 
<p>1. Sign in to the AWS SSO user portal using your corporate credentials. If you don’t know the URL of your AWS SSO user portal, ask your IT administrator. This URL can be found in <a href="https://console.aws.amazon.com/singlesignon">AWS SSO Console</a> in the <strong>Dashboard</strong> menu, under “<strong>User portal URL</strong>” section. In the user portal, you will see the AWS accounts to which you have been granted access.</p> 
<p><img width="100%" src="https://d1.awsstatic.com/security-center/SecurityBlog/sso_user_portal_1.acb9ce3eaf5a8249f6e27e7f8d6f343211ae297d.png" /></p> 
<p>2. Choose “<strong>AWS Account</strong>” to expand the list of AWS accounts.</p> 
<p><img width="100%" src="https://d1.awsstatic.com/security-center/SecurityBlog/sso_user_portal_2.90e159e24f3395a815f65ee6f66dd2db8bcea7bf.png" /></p> 
<p>3. Choose the AWS account that you want to access using the AWS CLI. This expands the list of permission sets in the account that you can use to access the account. For this example, I choose “<strong>Administrator</strong>” permission set which has the necessary permissions to create security groups in accounts. I then choose “<strong>Command Line</strong>” or “<strong>Programmatic Access</strong>” associated with the “<strong>Administrator</strong>” permissions set.</p> 
<p><img width="100%" src="https://d1.awsstatic.com/security-center/SecurityBlog/sso_user_portal_3.092c0aae7b0ae1b4fb702b913290114414fa8d10.png" /></p> 
<p>4. AWS SSO shows the credentials you requested in the appropriate format for your operating system. If you need credentials for an operating system that is different from the one shown, you can switch between the <strong>MacOS</strong> <strong>and Linux</strong> and <strong>Windows</strong> tabs. AWS SSO offers three options to use the temporary security credentials (these credentials are valid for up to 60 minutes; see the following screenshot for examples of each option):</p> 
<p>a. To run commands from the AWS CLI against the selected AWS account, copy the commands in the “<strong>Setup AWS CLI environment variables</strong>” section and paste the commands in the terminal window to set the necessary environment variables. These environment variables will be effective in the current terminal window.</p> 
<p>b. To run commands from multiple terminal windows against the same AWS account, copy the profile in the “<strong>Setup AWS CLI profile</strong>” section<strong>&nbsp;</strong>to setup a new named profile in your AWS credentials file. To learn more, see: “<a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-config-files.html">Configuration and Credential Files</a>“. You then will be able to use the –profile option with your AWS CLI command to use this credential. This will be effective in all terminal windows that use the same credential file.</p> 
<p>c. To access AWS resources from an AWS service client, use the credentials under the “<strong>Copy individual values</strong>” section to initialize your client. For more information, see the “Use the temporary credentials to access AWS resources” section on “<a href="https://docs.aws.amazon.com/sdk-for-java/v1/developer-guide/prog-services-sts.html">Getting Temporary Credentials with AWS STS</a>“.</p> 
<p><img width="100%" src="https://d1.awsstatic.com/security-center/SecurityBlog/sso_user_portal_4.a38806efb8077d7708aa33cb0ece339a540bca60.png" /></p> 
<p>5. Move your mouse over the option you want to copy credentials. I chose option 1.</p> 
<p><img width="100%" src="https://d1.awsstatic.com/security-center/SecurityBlog/sso_user_portal_5.50ba04f52ade52f6d8420b317025e94c6e3a899a.png" /></p> 
<p>6. I have copied, pasted, and run the AWS CLI environment variables commands in my terminal window:</p> 
<p><code>$ export AWS_ACCESS_KEY_ID=“ASIAJWOHLDZASDEXAMPLE&quot;<br /> $ export AWS_SECRET_ACCESS_KEY=&quot;feTxcGI2aus2m4RZh+eDASvqw3vOq/jS+EXAMPLE&quot;<br /> $ export AWS_SESSION_TOKEN=&quot;FQoDYXdzEFQaDIiq9STHISISEXAMPLE”</code></p> 
<p>7. Optionally, you can verify that the credentials are set up correctly by running the “<code>aws configure list</code>” command. Verify that the <code>access_key</code> and <code>secret_key</code> have values assigned.</p> 
<p><img width="100%" src="https://d1.awsstatic.com/security-center/SecurityBlog/sso_user_portal_7.a5b50f4bb1f5abff2173c222c119df89cfa214d1.png" /></p> 
<p>8. Now you can run any applicable AWS CLI commands (based on the permission set granted to you by your administrator). In the following example, I list instances in my AWS account.</p> 
<p><img width="100%" src="https://d1.awsstatic.com/security-center/SecurityBlog/sso_user_portal_8.a9314a8cad12331c4620fd2df7041df872ca8579.png" /></p> 
<p>9. To run the same (or different) AWS CLI command against a different AWS account, repeat this process, starting with Step 3. By keeping the AWS SSO user portal open in a browser window, you can easily switch to another AWS account without needing to sign in again. Every time you want to switch between accounts/permission sets or do additional work in an account after the temporary credentials expire, just copy fresh credentials for that account/permission set from the user portal.</p> 
<p><span style="text-decoration: underline"><strong>Conclusion</strong></span></p> 
<p>In this post, in order to manage services using the AWS CLI, I’ve showed you how to use your existing corporate username and password to get temporary credentials from AWS SSO. If you have questions, please start a new thread in the <a href="https://forums.aws.amazon.com/forum.jspa?forumID=277">AWS SSO Forum</a>.</p> 
<p>– Anand Murugesan</p> 
<script>
require(['blog'], function() {
AWS.Blog.commenting('#aws-comment-trigger-7301');
});
</script> 
</article> 
<article class="blog-post" vocab="http://schema.org/" typeof="TechArticle"> 
<meta property="inLanguage" content="en-US" /> 
<meta property="image" content="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2018/02/12/TH3a1.png" /> 
<b class="lb-b blog-post-title" property="name headline">How to Use New Advanced Security Features for Amazon Cognito User Pools</b> 
<p style="margin: 0; padding:0;">=======================<p>
<p><a href="https://aws.amazon.com/cognito/" target="_blank" rel="noopener noreferrer">Amazon Cognito</a> lets you easily add user sign-up, sign-in, and access control to your mobile and web apps. You can use fully managed user directories, called <a href="http://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-identity-pools.html" target="_blank" rel="noopener noreferrer">Amazon Cognito user pools</a>, to create accounts for your users, allow them to sign in, and update their profiles. Your users also can sign in by using external identity providers (IdPs) by <a href="https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-identity-federation.html" target="_blank" rel="noopener noreferrer">federating</a> with Amazon, Google, Facebook, SAML, or OpenID Connect (OIDC)–based IdPs. If your app is backed by resources, Amazon Cognito also gives you tools to manage permissions for accessing resources through <a href="https://aws.amazon.com/iam/" target="_blank" rel="noopener noreferrer">AWS Identity and Access Management</a> (IAM) <a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles.html" target="_blank" rel="noopener noreferrer">roles</a> and <a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies.html" target="_blank" rel="noopener noreferrer">policies</a>, and through integration with <a href="https://aws.amazon.com/apigateway/" target="_blank" rel="noopener noreferrer">Amazon API Gateway</a>.</p> 
<p>In this post, I explain some new advanced security features (in beta) that were launched at AWS re:Invent 2017 for Amazon Cognito user pools and how to use them. Note that separate prices apply to these advanced security features, as described on our <a href="https://aws.amazon.com/cognito/pricing/" target="_blank" rel="noopener noreferrer">pricing page</a>.</p> 
<h3>The new advanced security features of Amazon Cognito</h3> 
<p>Security is the top priority for Amazon Cognito. We handle user authentication and authorization to control access to your web and mobile apps, so security is vital. The new advanced security features add additional protections for your users that you manage in Amazon Cognito user pools. In particular, we have added protection against compromised credentials and risk-based adaptive authentication.</p> 
<h4>Compromised credentials protection</h4> 
<p>Our compromised credentials feature protects your users’ accounts by preventing your users from reusing credentials (a user name and password pair) that have been exposed elsewhere. This new feature addresses the issue of users reusing the same credentials for multiple websites and apps. For example, a user might use the same email address and password to sign in to multiple websites.</p> 
<p>A security best practice is to never use the same user name password in different systems. If an attacker is able to obtain user credentials through a breach of one system, they could use those user credentials to access other systems. AWS has been able to form partnerships and programs so that Amazon Cognito is informed when a set of credentials has been compromised elsewhere. When you use compromised credentials protection in Amazon Cognito, you can prevent users of your application from signing up, signing in, and changing their password with credentials that are recognized as having been compromised. If a user attempts to use credentials that we detect have been compromised, that user is required to choose a different password.</p> 
<h4>Risk-based adaptive authentication</h4> 
<p>The other major advanced security feature we launched at AWS re:Invent 2017 is risk-based adaptive authentication. Adaptive authentication protects your users from attempts to compromise their accounts—and it does so intelligently to minimize any inconvenience for your customers. With adaptive authentication, Amazon Cognito examines each user pool sign-in attempt and generates a risk score for how likely the sign-in request is to be from a malicious attacker.</p> 
<p>Amazon Cognito examines a number of factors, including whether the user has used the same device before, or has signed in from the same location or IP address. A detected risk is rated as low, medium, or high, and you can determine what actions should be taken at each risk level. You can choose to block the request if the risk level is high, or you can choose to require a second factor of authentication, in addition to the password, for the user to sign in using multi-factor authentication (MFA). With adaptive authentication, users continue to sign in with just their password when the request has characteristics of successful sign-ins in the past. Users are prompted for a second factor only when some risk is detected with a sign-in request.</p> 
<p>To learn more about using MFA with adaptive authentication, see <a href="http://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-mfa.html" target="_blank" rel="noopener noreferrer">Multi-Factor (MFA) Authentication Settings</a>. Amazon Cognito also can now <a href="http://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-email-phone-verification.html" target="_blank" rel="noopener noreferrer">verify email addresses and mobile phone numbers</a> as part of the authentication process.</p> 
<h4><strong>Metrics and data with the advanced security features</strong></h4> 
<p>In addition, both the compromised credentials and adaptive authentication features provide metrics and data about the following:</p> 
<li>Sign-up, sign-in, and forgotten-password events</li> 
<li>The risk scores that are assigned to events</li> 
<li>The results of sign-in attempts and second-factor challenges</li> 
<p>You can view aggregate metrics by using the <a href="https://aws.amazon.com/cloudwatch/" target="_blank" rel="noopener noreferrer">Amazon CloudWatch</a> console. You also can view each user’s sign-in history in the <a href="https://console.aws.amazon.com/cognito/home" target="_blank" rel="noopener noreferrer">Amazon Cognito console</a>.</p> 
<h3>How to configure the advanced security features</h3> 
<p>Now that I’ve described the new advanced security features, I will show how to configure them for your mobile or web app. You have to create an Amazon Cognito user pool in the console and save it before you can see the advanced security settings.</p> 
<p>First you must create and configure an Amazon Cognito user pool:</p> 
<ol> 
<li>Go to the <a href="https://console.aws.amazon.com/cognito/home" target="_blank" rel="noopener noreferrer">Amazon Cognito console</a>, and choose <strong>Manage your User Pools</strong> to get started. If you already have a user pool that you can work with, choose that user pool. Otherwise, choose <strong>Create a user pool</strong> to create a new one.</li> 
<li>On the <strong>MFA and verifications</strong> tab (see the following screenshot), enable MFA as <strong>Optional</strong> so that your individual users can choose to configure second factors of authentication, which are needed for adaptive authentication. (If you were to choose <strong>Required</strong> as the MFA setting for your user pool instead, all sign-ins would require a second factor of authentication. This would effectively disable adaptive authentication because a second factor of authentication would always be required.)</li> 
</ol> 
<p style="padding-left: 40px">You should also enable at least one second factor of authentication. As shown in the following screenshot, I have enabled both <strong>SMS text message</strong> and <strong>Time-based One-time Password</strong> (TOTPs).<br /> <img width="100%" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2018/02/12/TH1a.png" /></p> 
<ol start="3"> 
<li>On the <strong>App clients</strong> tab, create an app client by choosing <strong>add an app client</strong>, entering a name, and choosing <strong>Create app client</strong>.</li> 
</ol> 
<p>Second, configure the advanced security features:</p> 
<ol> 
<li>After you’ve configured and saved your user pool, you will see the <strong>Advanced security</strong> tab, as shown in the following screenshot. You can choose one of three modes for enabling the advanced security features: <strong>Yes</strong>, <strong>Audit only</strong>, and <strong>No</strong>: 
<li>If you choose <strong>No</strong>, the advanced features are all turned off.</li> 
<li>If you choose <strong>Audit only</strong>, Amazon Cognito logs all related events to CloudWatch metrics so that you can see what risks are detected, but Amazon Cognito doesn’t take any explicit actions to protect your users. Use the <strong>Audit only</strong> mode to understand what events are happening before you fully turn on the advanced security features.</li> 
<li>If you choose <strong>Yes</strong>, you turn on the advanced security features. We recommend that you initially run the advanced security features in <strong>Audit only</strong> mode for two weeks before choosing <strong>Yes</strong>.<br /> <img width="100%" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2018/02/12/TH2a.png" /></li> 
</ul> </li> 
</ol> 
<ol start="2"> 
<li>When you choose <strong>Yes</strong> to turn on the advanced security features, configuration options appear, as shown in the following screenshot: 
<ol type="a"> 
<li>First, choose if you want to configure default settings for all of your app clients, or if you want to configure settings for a specific app client. As shown in the following screenshot, you can see that I’ve chosen global default settings for all my app clients.</li> 
<li>Next, choose the action you want to take when compromised credentials are detected. You can either <strong>Allow</strong> compromised credentials, or you can <strong>Block use </strong>of them. If you want to protect your users, you should choose <strong>Block use</strong>. However, you first can watch the metrics in CloudWatch without taking action by choosing <strong>Allow</strong>. You also can choose <strong>Customize when compromised credentials are blocked</strong>, which allows you to choose for which operations—sign up, sign in, and forgotten password—Amazon Cognito will detect and block use of compromised credentials.<br /> <img width="100%" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2018/02/12/TH3a.png" /></li> 
</ol> </li> 
</ol> 
<ol start="3"> 
<li>The next section on the <strong>Advanced security</strong> tab includes the configuration for adaptive authentication. For each risk level (<strong>Low</strong>, <strong>Medium</strong>, and <strong>High</strong>), you can require a second factor for MFA or you can block the request, and you can notify users about the events through email. You have two MFA choices for each risk level: 
<ol type="a"> 
<li><strong>Optional MFA</strong> – Requires a second factor at that risk level for all users who have configured either SMS or TOTP as a second factor of authentication. Users who haven’t configured a second factor are allowed to sign in without a second factor. For optional MFA, you should encourage your users to configure a second factor of authentication for added security, but users who haven’t configured a second factor aren’t blocked from signing in.</li> 
<li><strong>Require MFA</strong> – Requires a second factor of authentication from all users when a risk is detected, so any users who haven’t configured a second factor are blocked from signing in at any risk level that requires MFA.</li> 
<li><strong>Block –</strong> Blocks the sign-in attempt.</li> 
<li><strong>Notify users</strong> – Sends an email to the users to notify them about the sign-in attempt. You can customize the emails as described below.<br /> <img width="100%" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2018/02/12/TH4a.png" /></li> 
</ol> </li> 
<li>In the next section on the <strong>Advanced security</strong> tab, you can customize the email notifications that Amazon Cognito sends to your users if you have selected <strong>Notify users</strong>. Amazon Cognito sends these notification emails through <a href="https://aws.amazon.com/ses/" target="_blank" rel="noopener noreferrer">Amazon Simple Email Service</a> (Amazon SES). If you haven’t already, you should go to the <a href="https://console.aws.amazon.com/ses/home" target="_blank" rel="noopener noreferrer">Amazon SES console</a> to <a href="https://docs.aws.amazon.com/ses/latest/DeveloperGuide/verify-addresses-and-domains.html" target="_blank" rel="noopener noreferrer">configure and verify an email address or domain</a> so that you can use it as the <strong>FROM email address</strong> for the notification emails that Amazon Cognito sends.<br /> <img width="100%" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2018/02/12/TH5a.png" /></li> 
</ol> 
<p style="padding-left: 40px">You can customize the email subject and body for the email notifications with both HTML and plain text versions, as shown in the following screenshot.<br /> <img width="100%" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2018/02/12/TH6a.png" /></p> 
<ol start="5"> 
<li>Optionally, you can enter IP addresses that you either want to <strong>Always allow</strong> by bypassing the compromised credentials and adaptive authentication features, or to <strong>Always block</strong>. For example, if you have a site where you do testing and development, you might want to include the IP address range from that site in the <strong>Always allow</strong> list so that it doesn’t get mistaken as a risky sign-in attempt.<br /> <img width="100%" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2018/02/12/TH7a.png" /></li> 
</ol> 
<p>That’s all it takes to configure the advanced security features in the Amazon Cognito console.</p> 
<h3>Enabling the advanced security features from you app</h3> 
<p>After you have configured the advanced security features for your user pool, you need to enable them in your mobile or web app. First you need to include a version of our SDK that is recent enough to support the features, and second in some cases, you need to set some values for iOS, Android, and JavaScript.</p> 
<p><strong>iOS:</strong> If you’re building your own user interface to sign in users and integrating the <a href="https://github.com/aws/aws-sdk-ios/tree/master/AWSCognitoIdentityProvider" target="_blank" rel="noopener noreferrer">Amazon Cognito Identity Provider SDK</a>, use at least version 2.6.7 of the SDK. If you’re using the <a href="https://github.com/aws/aws-sdk-ios/tree/master/AWSCognitoAuth" target="_blank" rel="noopener noreferrer">Amazon Cognito Auth SDK</a> to incorporate the customizable, hosted user interface to sign in users, also use at least version 2.6.7. If you’re configuring the Auth SDK by using <code>Info.plist</code>, add the <code>PoolIdForEnablingASF</code> key to your Amazon Cognito user pool configuration, and set it to your user pool ID. If you’re configuring the Auth SDK by using <code>AWSCognitoAuthConfiguration</code>, use <a href="http://docs.aws.amazon.com/AWSiOSSDK/latest/Classes/AWSCognitoAuthConfiguration.html#//api/name/initWithAppClientId:appClientSecret:scopes:signInRedirectUri:signOutRedirectUri:webDomain:identityProvider:idpIdentifier:userPoolIdForEnablingASF:" target="_blank" rel="noopener noreferrer">this initializer</a> and specify your user pool ID as <code>userPoolIdForEnablingASF</code>. For more details, see the <a href="https://github.com/awslabs/aws-sdk-ios-samples/tree/master/CognitoAuth-Sample" target="_blank" rel="noopener noreferrer">CognitoAuth sample app</a>.</p> 
<p><strong>Android:</strong> If you’re using the <a href="https://github.com/aws/aws-sdk-android/tree/master/aws-android-sdk-cognitoauth" target="_blank" rel="noopener noreferrer">Amazon Cognito Auth SDK for Android</a> that incorporates the hosted UI to sign in users, or if you’re using the <a href="https://github.com/aws/aws-sdk-android/tree/master/aws-android-sdk-cognitoidentityprovider" target="_blank" rel="noopener noreferrer">Amazon Cognito Identity Provider SDK for Android</a> to integrate your own native user interface, use at least version 2.6.9 of the SDK.</p> 
<p><strong>JavaScript:</strong> If you’re using the <a href="https://github.com/aws/amazon-cognito-auth-js" target="_blank" rel="noopener noreferrer">Amazon Cognito Auth JS SDK</a> to incorporate the customizable, hosted UI to sign in users, use at least version 1.1.0 of the SDK. To configure the advanced security features, add the <code>AdvancedSecurityDataCollectionFlag</code> parameter and set it as <code>true</code>. Also add the <code>UserPoolId</code> parameter and set it to your user pool ID.&nbsp;In your application, you need to include <code>&quot;https://amazon-cognito-assets.&lt;region&gt;.amazoncognito.com/amazon-cognito-advanced-security-data.min.js&quot;</code> to collect data about requests. For more details, see the <a href="https://github.com/aws/amazon-cognito-auth-js/blob/master/README.md" target="_blank" rel="noopener noreferrer">README.md</a> of the Auth JavaScript SDK and the <a href="https://github.com/aws/amazon-cognito-auth-js/blob/master/sample/SAMPLEREADME.md" target="_blank" rel="noopener noreferrer">SAMPLEREADME.md</a> of the web app sample. If you’re using the <a href="https://github.com/aws/amazon-cognito-identity-js/" target="_blank" rel="noopener noreferrer">Amazon Cognito Identity SDK</a> to build your own UI, use at least version 1.28.0 of the SDK.</p> 
<h3>Some examples of the advanced security features in action</h3> 
<p>Now that I have configured these advanced security features, let’s look at them in action. I’m using the customizable, hosted sign-up and sign-in screens that are built into Amazon Cognito user pools. I’ve done some minimal customization, and my sign-up page is shown in the following screenshot.</p> 
<p><img width="100%" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2018/02/12/TH8.png" /></p> 
<p>With the compromised credentials feature, if a user tries to sign up with credentials that have been exposed at another site, the user is told they cannot use that password for security reasons.</p> 
<p><img width="100%" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2018/02/12/TH9.png" /></p> 
<p>If a user signs in, Amazon Cognito detects a risk, and you have configured adaptive authentication, the user is asked for a second factor of authentication. The following screenshot shows an example of an SMS text message used for MFA. After the user enters a valid code from their phone, they’re successfully signed in.</p> 
<p><img width="100%" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2018/02/12/TH10.png" /></p> 
<p>As I mentioned earlier in this post, Amazon Cognito also can notify your users whenever there’s a sign-in attempt that’s determined to have some risk. The following screenshot shows a basic example of a notification message, and you can customize these messages, as described previously.</p> 
<p><img width="100%" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2018/02/12/TH11.png" /></p> 
<p>The advanced security features also provide aggregate metrics and event histories for individual users. You can view the aggregate metrics in the <a href="https://console.aws.amazon.com/cloudwatch" target="_blank" rel="noopener noreferrer">CloudWatch console</a>. Navigate to the <strong>Metrics</strong> section under <strong>Cognito</strong>. When you’re graphing, choose the <strong>Graphed metrics</strong> tab and choose <strong>Sum</strong> as the <strong>Statistic</strong>.</p> 
<p><img width="100%" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2018/02/12/TH12a.png" /></p> 
<p>You can view the event histories for users in the Amazon Cognito console on the <strong>Users and groups</strong> tab. When you choose an individual user, you see that user’s event history listed under their profile information. As the following screenshot shows, you can see information about users’ events, including the date and time, the event type, the risk detected, and location. The event history includes the <strong>Risk level</strong> that indicates the <strong>Low</strong>, <strong>Medium</strong>, or <strong>High</strong> ratings described earlier and the <strong>Risk decision</strong> that indicates if a risk was detected and what type.</p> 
<p><img width="100%" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2018/02/12/TH13a.png" /></p> 
<p>When you choose an entry, you see the event details and the option to <strong>Mark event as</strong> <strong>valid</strong> if it was from the user, or <strong>Mark event as invalid</strong> if it wasn’t.</p> 
<p><img width="100%" src="https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2018/02/15/TH14a.png" /></p> 
<h3>Summary</h3> 
<p>You can use these advanced security features of Amazon Cognito user pools to protect your users from compromised credentials and attempts to compromise their user pool–based accounts in your app. You also can customize the actions taken in response to different risks, or you can use audit mode to gather metrics on detected risks without taking action. For more information about using these features, see the <a href="http://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pool-settings-advanced-security.html" target="_blank" rel="noopener noreferrer">Amazon Cognito Developer Guide</a>.</p> 
<p>If you have comments about this post, submit them in the “Comments” section below. If you have questions about how to configure or use these features, start a new thread on the <a href="https://forums.aws.amazon.com/forum.jspa?forumID=173" target="_blank" rel="noopener noreferrer">Amazon Cognito forum</a> or <a href="https://console.aws.amazon.com/support/home" target="_blank" rel="noopener noreferrer">contact AWS Support</a>.</p> 
<p>– Tim</p> 
<script>
require(['blog'], function() {
AWS.Blog.commenting('#aws-comment-trigger-7234');
});
</script> 
</article> 
<p>
© 2018 Amazon Web Services, Inc. or its affiliates. All rights reserved.
</p>

    </div>
  </div>
</div>


    <div id="footer" class="navigation hidden-print">
      <div class="container">
        <div class="row">
          <div class="col-xs-12">
            <ul class="footer-links nav navbar-nav">
              <li><a href="../aws.html">AWS</a></li>
              <li><a href="../linux.html">Linux</a></li>
              <li><a href="../docker.html">Docker</a></li>
              <li><a href="../ibmpower.html">IBM Power</a></li>
              <li><a href="blogsataws1.html">Blogs@AWS (Kindle Friendly)</a></li>
            </ul>
            <ul class="footer-links nav navbar-nav navbar-right">
              <li><a href="../comments.html">Comments?</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
